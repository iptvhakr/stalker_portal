"use strict";function getWindowKey(windowName){return"window."+windowName+".id"}function getWindowIdByName(windowName){return stbStorage.getItem(getWindowKey(windowName))}function openWindow(windowName,url){var windowInfo,windowKey=getWindowKey(windowName),windowID=stbStorage.getItem(windowKey);if(windowID)try{windowInfo=JSON.parse(stbWindowMgr.windowInfo(windowID)),-1===windowInfo.result.url.indexOf(url)&&stbWebWindow.messageSend(windowID,"window.load",url),windowName===WINDOWS.BROWSER?(windowID=stbWindowMgr.openWebFace(url),stbStorage.setItem(windowKey,windowID)):stbWindowMgr.windowShow(windowID)}catch(e){echo(e),stbWindowMgr.openWebFace(url)}else windowID=windowName===WINDOWS.BROWSER?stbWindowMgr.openWebFace(url):stbWindowMgr.windowInit(JSON.stringify({url:url,backgroundColor:"#000"})),stbStorage.setItem(windowKey,windowID);return windowID}function openWindowHelp(path){openWindow(WINDOWS.HELP,PATH_ROOT+"public/app/help/index.html?path="+path)}function elattr(obj,attr){if(obj&&obj.nodeType&&attr&&attr instanceof Object)for(var key in attr)attr.hasOwnProperty(key)&&(obj[key]=attr[key]);return obj}function element(name,attr,data){var tag=document.createElement(name);return elattr(tag,attr),elchild(tag,data),tag}function elchild(obj,value){if(obj&&value)if(value.nodeType)obj.appendChild(value);else if(Array.isArray(value))for(var i=0;i<value.length;i++)elchild(obj,value[i]);else obj.appendChild(document.createTextNode(value));return obj}function elclear(obj){if(null!==obj&&obj.nodeName&&obj.hasChildNodes())for(;obj.hasChildNodes();)obj.removeChild(obj.firstChild);return obj}function loadScript(src,onload,onerror){var elem=document.createElement("script");elem.type="text/javascript",elem.src=src,"function"==typeof onload&&(elem.onload=onload),"function"==typeof onerror&&(elem.onerror=onerror),document.head.appendChild(elem)}function getCurrentLanguage(langList){var langEnv=JSON.parse(gSTB.GetEnv('{"varList":["language"]}')),langVal="en";return langList=langList||["en","ru","uk","de","tr"],!langEnv.errMsg&&langEnv.result&&langEnv.result.language&&"string"==typeof langEnv.result.language&&(langEnv.result.language=langEnv.result.language.toLowerCase(),-1!==langList.indexOf(langEnv.result.language)&&(langVal=langEnv.result.language)),langVal}function getEnvList(list){var data;try{if(data=JSON.parse(gSTB.GetEnv(JSON.stringify({varList:list}))),""!==data.errMsg)throw new Error(data.errMsg);return data.result}catch(e){echo(e)}return!1}function getEnv(name){var data=getEnvList([name]);return data!==!1&&void 0!==data[name]?data[name]:data}function setEnv(key,value){var vars={};return vars[key]=value,setEnvList(vars)}function setEnvList(hash){try{return gSTB.SetEnv(JSON.stringify(hash))}catch(e){echo(e)}return!1}function eventPrepare(event,stopBubble,label){return void 0!==event.code?!0:(event.code=event.keyCode||event.which,0===event.code?!1:(event.shiftKey&&(event.code+=1e3),event.altKey&&(event.code+=2e3),event.code===KEYS.USB_MOUNTED||event.code===KEYS.USB_UNMOUNTED?!1:(stopBubble!==!1&&event.stopPropagation(),echo(event.code+"	"+event.shiftKey+"	"+event.ctrlKey+"	"+event.altKey+"	"+event.srcElement.id+"	"+event.target.id+"	"+(label||""),"keyDown [code/shift/ctrl/alt/src/target]"),!0)))}function ajax(method,url,callback,headers,type,async){var hname,jdata=null,timeout=null,xhr=new XMLHttpRequest,title="AJAX "+method.toUpperCase()+" "+url;if(async=async!==!1,xhr.onreadystatechange=function(){if(4===xhr.readyState)if(clearTimeout(timeout),ajax.stop)echo(xhr.status,title),"function"==typeof callback&&callback(null,null,null);else{if(echo("status:"+xhr.status+", length:"+xhr.responseText.length,title),echo(xhr.responseText,title),"json"===type&&200===xhr.status)try{jdata=JSON.parse(xhr.responseText)}catch(e){echo(e,"AJAX JSON.parse"),jdata=null}"function"==typeof callback&&callback("xml"===type?xhr.responseXML:"json"===type?jdata:xhr.responseText,xhr.status,xhr)}},xhr.open(method,url,async),headers)for(hname in headers)headers.hasOwnProperty(hname)&&xhr.setRequestHeader(hname,headers[hname]);return xhr.send(),echo("sent",title),timeout=setTimeout(function(){xhr.abort(),echo("ABORT on timeout",title)},6e4),xhr}function imageLoader(imgList,callback){var count=1,onload=function(){imgList.length===count&&"function"==typeof callback?callback():count++};Array.isArray(imgList)&&imgList.length>0?imgList.forEach(function(item){var img=new Image;img.src=item,img.onload=onload,img.onerror=function(){throw"Image "+item+" load fail"}}):0===imgList.length&&callback()}function getStorageInfo(){var snList={},info=JSON.parse(gSTB.GetStorageInfo("{}"));Array.isArray(info.result)&&""===info.errMsg&&info.result.length>0?(info.result.forEach(function(item){item.mediaType="000022272228"===item.sn?3:item.mediaType,item.label=item.label.trim(),snList[item.sn]?snList[item.sn]++:snList[item.sn]=1}),info.result.forEach(function(item){item.label||(item.label=item.vendor+" "+item.model.replace(/\//,""),snList[item.sn]>1&&(item.label+=" #"+item.partitionNum))}),info.result.sort(function(a,b){return a.mountPath<b.mountPath?-1:1}),window.STORAGE_INFO=info.result):window.STORAGE_INFO=[];try{window.HDD_INFO=JSON.parse(gSTB.RDir("get_hdd_info")||"[]")}catch(e){echo(e,"get_hdd_info"),window.HDD_INFO=[]}echo(STORAGE_INFO,"STORAGE_INFO"),echo(HDD_INFO,"HDD_INFO")}function parseUri(str){for(var o=parseUri.options,m=o.parser[o.strictMode?"strict":"loose"].exec(str),uri={},i=14;i--;)uri[o.key[i]]=m[i]||"";return uri[o.q.name]={},uri[o.key[12]].replace(o.q.parser,function($0,$1,$2){$1&&(uri[o.q.name][$1]=$2)}),uri}function validateUrl(url,sol){var solReg="((ffmpeg|auto|rtp|rtsp|mp3|mpegps|mpegts|mp4|ifm|fm|ffrt|ffrt2|ffrt3|ffrt4)(\\s))?";return new RegExp("^"+(sol?solReg:"")+"(((http|https|udp|rtp|rtsp|mms|mmsh|mmst|rtmp|igmp):\\/\\/)?@?(([a-zA-Z0-9а-яА-Я$\\-_.+!*'(),;:&=]|%[0-9a-fA-Fа-яА-Я]{2})+@)?(((25[0-5]|2[0-4][0-9]|[0-1][0-9][0-9]|[1-9][0-9]|[0-9])(\\.(25[0-5]|2[0-4][0-9]|[0-1][0-9][0-9]|[1-9][0-9]|[0-9])){3})|localhost|([a-zA-Zа-яА-Я0-9\\-\\u00C0-\\u017F]+\\.)+([a-zA-Zа-яА-Я]{2,}))(:[0-9]+)?|((file:///|/)[a-zA-Zа-яА-Я0-9\\-\\u00C0-\\u017F]+))(\\/(([a-zA-Zа-яА-Я0-9$\\-_.+!*'(),;:@&=\\s]|%[0-9a-fA-Fа-яА-Я]{2})*(\\/([a-zA-Zа-яА-Я0-9$\\-_.+!*'(),;:@&=\\s]|%[0-9a-fA-Fа-яА-Я]{2})*)*)?(\\?([a-zA-Zа-яА-Я0-9$\\-_.+!*'(),;:@&=\\/?]|%[0-9a-fA-Fа-яА-Я]{2})*)?(\\#([a-zA-Zа-яА-Я0-9$\\-_.+!*'(),;:@&=\\/?]|%[0-9a-fA-Fа-яА-Я]{2})*)?)?$").test(url)}function extend(target,source,override){var _target=override===!1?extend({},target):target||{};for(var prop in source)"object"!=typeof _target[prop]||"object"!=typeof source[prop]||Array.isArray(_target[prop])||Array.isArray(source[prop])?_target[prop]=source[prop]:_target[prop]=extend(_target[prop],source[prop],override);return _target}function base64Encode(data){return btoa(unescape(encodeURIComponent(data)))}function base64Decode(data){try{return decodeURIComponent(escape(atob(data)))}catch(error){echo(error,"base64Decode Error")}}function cutTextWithEllipsis(text,length){return text.length>length?text.toString().slice(0,length)+"...":text}function parseDate(dateStr){if(!dateStr)return new Date(NaN);var date=new Date(dateStr.match(/\w{3}\s\w{3}\s\d{1,2}\s\d{1,2}:\d{1,2}:\d{1,2}/)+" "+dateStr.match(/\d{4}/)),timeZone=dateStr.match(/(\w{1,4})\s+\d{4}/)[1],offset=timeZoneOffsets[timeZone];return 0!==offset.index&&date.setMinutes(date.getMinutes()+(offset.minutes||0)*offset.index-date.getTimezoneOffset()),date}function getMediaType(file){var extension=file.split(".").pop().toLowerCase();if(extension&&-1!==configuration.registersTypes.indexOf(extension))for(var type,i=0;i<MEDIA_TYPES.length,type=MEDIA_TYPES[i];i++)if(-1!==MEDIA_EXTENSION[type].indexOf(extension))return type;return MEDIA_TYPE_NONE}function readJSON(path,fileName){var result,xmlhttp=new XMLHttpRequest;path=path+"/"+fileName;try{xmlhttp.open("GET",path,!1),xmlhttp.send(null),result=xmlhttp.responseText}catch(e){echo(e,"some xmlhttp error"),result=""}return echo(result,"file "+path),result}function CBase(parent){this.name="CBase",this.handle=null,this.parent=null,this.handleInner=null,this.showAttr="block",this.baseClass="",this.prevFocus=null,this.isActive=!1,this.activeChild=null,this.isVisible=!0,this.SetParent(parent)}function CPage(parent){CBase.call(this,parent||null),this.name="CPage",this.previous=null,this.isVisible=!1}function CScrollList(parent){CBase.call(this,parent),this.name="CScrollList",this.baseClass="cslist-main",this.multipleSelection=!0,this.activeItem=null,this.states={},this.manageFocus=!0,this.defaultParams={hidden:!1,marked:!1,disabled:!1,focused:!1,href:"#",self:this,manageFocus:!0,oncontextmenu:EMULATION?null:function(){return!1},onclick:function(){return this.self.Focused(this,!0),!1},onmouseover:function(){return this.self.Focused(this,!0),!1}},this.defaultFilter={hidden:!1,disabled:!1},this.scrollMode=2,this.RENDER_MODE_SINGLE=1,this.RENDER_MODE_BULK=2,this.renderMode=this.RENDER_MODE_SINGLE,this.fragment=document.createDocumentFragment()}function CGroupMenu(parent){CBase.call(this,parent),this.name="CGroupMenu",this.baseClass="cgmenu-main",this.activeGroup=null,this.active=!1,this.autoFocus=!0}function CModal(parent){CPage.call(this,parent),this.name="CModal",this.baseClass="cmodal-main",this.showAttr="table",this.focusList=[],this.focusPos=0}function CModalBox(parent){CModal.call(this,parent),this.name="CModalBox",this.header=element("div",{className:"cmodal-header"}),this.content=element("div",{className:"cmodal-content"}),this.footer=element("div",{className:"cmodal-footer"})}function CModalHint(parent,data,time,isForced){if(data){CModalBox.call(this,parent),this.name="CModalHint";var self=this;this.SetHeader(),this.SetContent(data),this.SetFooter(),this.onHide=function(){self.Free()},this.onClick=function(){self.Show(!1)},this.Init(),this.Show(!0),isForced!==!0&&(this.EventHandler=function(event){self.Show(!1),self.timer&&clearTimeout(self.timer),event.preventDefault()}),time&&(this.timer=setTimeout(function(){self.Show(!1)},time||5e3))}}function CModalAlert(parent,title,data,btnExitTitle,btnExitClick){if(data){CModalBox.call(this,parent),this.name="CModalAlert";var self=this;this.bpanel=new CButtonPanel,this.bpanel.Init(CMODAL_IMG_PATH),this.bpanel.Add(KEYS.EXIT,"exit.png",btnExitTitle||"",function(){"function"==typeof btnExitClick&&btnExitClick.call(self),self.Show(!1)}),this.SetHeader(title),this.SetContent(data),this.SetFooter(this.bpanel.handle),this.onHide=function(){elclear(self.bpanel.handle),delete self.bpanel,self.Free()},this.EventHandler=function(e){eventPrepare(e,!0,this.name)&&self.bpanel.EventHandler(e)},this.Init(),this.Show(!0)}}function CModalConfirm(parent,title,data,btnExitTitle,btnExitClick,btnOKTitle,btnOKClick){CModalAlert.call(this,parent,title,data,btnExitTitle,btnExitClick),this.name="CModalConfirm";var self=this;this.bpanel.Add(KEYS.OK,"ok.png",btnOKTitle,function(){self.Show(!1),"function"==typeof btnOKClick&&(btnOKClick.call(self),btnOKClick=null)})}function CButtonPanel(parent){CBase.call(this,parent),this.name="CButtonPanel",this.baseClass="cbpanel-main",this.path="",this.isActive=!0}function CBreadCrumb(parent){CBase.call(this,parent),this.name="CBreadCrumb",this.baseClass="cbcrumb-main",this.path="",this.leftItems=3,this.rightItems=2}function CSearchBar(parent){CBase.call(this,parent),this.name="CSearchBar",this.baseClass="csbar-main",this.filter="",this.path="",this.items={},this.timer=0,this.hint=0,this.icoSearch="ico_search2.png",this.icoFilter="ico_filter.png"}function CCheckBox(parent,parameters){var parentNode,_default=!!parameters.checked,self=this;if(CBase.call(this,parent||null),this.parameters=parameters||{},this.parameters.attributes=parameters.attributes||{},this.name=parameters.name||"input",this.type=this.tagName="checkbox",this.style=parameters.style||"",this.events=parameters.events||{},void 0===(parentNode=parameters.parent)){if(void 0===parameters.element)throw"parentNode or element parameter must be specified";parentNode=parameters.element.parentNode}this.bind(this.events),this.IsChanged=function(){return _default!==self.IsChecked()},this.Init(parentNode)}function CSimpleSelect(parent,parameters){this.parameters=parameters||{},this.tagName="SELECT",this.attributes={content:{className:"csimple-select-content"},left_arrow:{className:"csimple-select-arrow left"},right_arrow:{className:"csimple-select-arrow right"},wrapper:{className:"csimple-select-wrapper",tabIndex:"1"},content_wrapper:{className:"csimple-content-wrapper"},hint:{className:"csimple-select-hint csimple-select-content"}},this.style=parameters.style||"",this.type="select",void 0!==parameters.attributes&&extend(this.attributes,parameters.attributes),this.bind(parameters.events||{}),CBase.call(this,parent||null),(this.parentNode=parameters.parent)||(void 0===parameters.content?this.parentNode=element("div"):this.parentNode=parameters.content.parentNode)}function CSelectBox(parent,parameters){CSimpleSelect.call(this,parent||null,parameters),this.attributes.wrapper.className+=" cselect-box",this.Init(this.GenerateHandle());var _selectedIndex,_default,_data=parameters.data||[],idField=parameters.idField||"id",nameField=parameters.nameField||"name",_autocomplete="",self=this,placeholder=parameters.placeholder||_("No data");this.name=parameters.name||"CSelectBox",this.dropdown=new CSelectDropdown(this,{select:this,scrollMode:2,container:parameters.container}),this.SetData=function(data){if(0===data.length)throw"data cannot be empty";_data=data||[],data.length-1<_selectedIndex&&(_selectedIndex=data.length-1),self.RefreshContent(),self.trigger("dataChanged")},this.GetNameField=function(){return nameField},this.GetIdField=function(){return idField},this.GetData=function(){return _data},this.Autocomplete=function(keyCode){var find=!1,text="";if(text=keyCode===KEYS.BACK?_autocomplete.slice(0,-1):_autocomplete+String.fromCharCode(keyCode).toLowerCase(),""!==text){for(var el,i=0;i<_data.length,el=_data[i];i++)if("object"==typeof el&&(el=el[nameField]),0===el.toLowerCase().indexOf(text)){this.SetIndex(i),find=!0;break}find===!0&&(self.handle.classList.add("autocomplete"),_autocomplete=text),text=this.GetLabel(),text&&(text=text.substr(0,_autocomplete.length)),self.SetHint(text)}else self.ClearAutocomplete()},this.ClearAutocomplete=function(){self.handle.classList.remove("autocomplete"),self.SetHint(_autocomplete="")},this.GetSelected=function(){return _data[_selectedIndex]},this.Next=function(){_selectedIndex<_data.length-1&&this.SetIndex(++_selectedIndex)},this.Previous=function(){0!==_selectedIndex&&this.SetIndex(--_selectedIndex)},this.GetValue=function(){var selected=self.GetSelected();return"object"==typeof selected?selected[idField]:selected},this.GetLabel=function(){var selected=self.GetSelected();return"object"==typeof selected?selected[nameField]:selected},this.RefreshContent=function(){return self.SetContent(self.GetLabel(),placeholder),self.value=self.GetValue(),1===self.GetData().length?(self.DisableElement(self.leftArrow,!0),void self.DisableElement(self.rightArrow,!0)):void(0===self.GetIndex()?(self.DisableElement(self.leftArrow,!0),self.DisableElement(self.rightArrow,!1)):self.GetIndex()===self.GetData().length-1?(self.DisableElement(self.rightArrow,!0),self.DisableElement(self.leftArrow,!1)):(self.DisableElement(self.leftArrow,!1),self.DisableElement(self.rightArrow,!1)))},this.SelectById=function(id,quiet){for(var i=0;i<_data.length;i++)if(_data[i][idField]===id)return self.SetIndex(i,quiet),i},this.IsChanged=function(){return _selectedIndex!==_default},this.GetIndex=function(){return _selectedIndex},this.SetIndex=function(index,quiet){var old=this.GetSelected();self.ClearAutocomplete(),_selectedIndex=void 0===index||index>=_data.length?0:index,self.RefreshContent(),quiet!==!0&&self.trigger("onChange",{"new":self.GetSelected(),old:old})},this.SetIndex(parameters.selected,!0),void 0!==parameters.selectedId&&this.SelectById(parameters.selectedId,!0),_default=_selectedIndex,this.EventHandler=function(event){switch(eventPrepare(event),event.stopped=!0,event.code){case KEYS.FRAME:this.dropdown.Show(!this.dropdown.isVisible,!1);break;case KEYS.LEFT:case KEYS.RIGHT:this.dropdown.isVisible||(CSimpleSelect.prototype.EventHandler.call(this,event),this.dropdown.EventHandler(event));break;case KEYS.OK:case KEYS.UP:case KEYS.DOWN:case KEYS.PAGE_UP:case KEYS.PAGE_DOWN:event.stopped=!1,this.dropdown.isVisible&&(this.dropdown.EventHandler(event,null,!1),event.stopped=!0);break;case KEYS.EXIT:this.dropdown.isVisible?this.dropdown.Show(!1,!1):event.stopped=!1;break;default:event.stopped=!1}},this.handle.onkeypress=function(event){event.ctrlKey!==!0&&event.altKey!==!0&&self.Autocomplete(event.charCode)},this.dropdown.Refresh(),this.bind("onBlur",function(){self.ClearAutocomplete()})}function CSelectDropdown(parent,options){CScrollList.call(this,parent||null,options);var self=this;this.isVisible=!1,this.manageFocus=!1,this.multipleSelection=!1,this.attributes={wrapper:{className:"csimple-select-dropdown"},element:{className:"dropdown-element"}},this.select=null,this.baseClass="csimple-dropdown-main",CSelectDropdown.parameters.forEach(function(key){void 0!==options[key]&&(self[key]=options[key])}),this.base=this.select.handle,this.Init(element("div",this.attributes.wrapper)),this.base.parentNode.appendChild(this.handle),this.select.bind("dataChanged",function(){self.Refresh()}),this.select.bind("onChange",function(){if(self.isVisible){var item=self.handleInner.children[this.GetIndex()];self.SetPosition(item,!0,!1),self.Focused(item,!0),self.Marked(item,!0)}}),this.select.bind("onBlur",function(){setTimeout(function(){self.Show(!1,self.manageFocus)},100)}),this.select.handle.addEventListener("click",function(event){self.Show(!self.isVisible,self.manageFocus),event.stopPropagation(),event.stopImmediatePropagation(),event.preventDefault()}),this.Show(!1,self.manageFocus)}function CIntervalBox(parent,parameters){var _default,_oldValue,self=this,_value=0,_inputValue="";CSimpleSelect.call(this,parent||null,parameters),this.inputTimer={},this.attributes.wrapper.className+=" cinterval-box",void 0===parameters.align&&(this.attributes.content.className+=" center"),void 0!==parameters.contentStyle&&(this.attributes.content.className+=" "+parameters.contentStyle),this.Init(this.GenerateHandle()),this.name=parameters.name||"input",this.type="interval",this.parameters=parameters,void 0!==parameters.align&&(this.content.className+=" "+parameters.align,this.content.style.textAlign=parameters.align),this.max=parameters.max,this.min=parameters.min,this.interval=parameters.interval||1,void 0!==parameters.value?_value=void 0!==this.max&&parameters.value>this.max?this.max:void 0!==this.min&&parameters.value<this.min?this.min:parameters.value:void 0!==this.min?_value=this.min:void 0!==this.max&&(_value=this.max),_default=_value=parseInt(_value),this.SetValue=function(value){_value=parseInt(value),self.SetContent(_value),self.trigger("onChange",_value)},this.GetValue=function(){return _value},this.Next=function(){if(_inputValue.length&&(clearInterval(this.inputTimer),this.inputDone()),CSimpleSelect.prototype.Next.call(),void 0!==self.max){if(!(_value+self.interval<=self.max))return;_value+=self.interval}else _value+=self.interval;self.RefreshContent(),self.trigger("onNext",self.GetValue()),self.trigger("onChange",self.GetValue())},this.Previous=function(){if(_inputValue.length&&(clearInterval(this.inputTimer),this.inputDone()),CSimpleSelect.prototype.Next.call(),void 0!==self.min){if(!(_value-self.interval>=self.min))return;_value-=self.interval}else _value-=self.interval;self.RefreshContent(),self.trigger("onPrevious",self.GetValue()),self.trigger("onChange",self.GetValue())},this.RefreshContent=function(){this.SetContent(self.GetValue()),self.value=self.GetValue(),self.DisableElement(self.leftArrow,!1),self.DisableElement(self.rightArrow,!1),void 0!==self.min&&_value-self.interval<self.min&&self.DisableElement(self.leftArrow,!0),void 0!==self.max&&_value+self.interval>self.max&&self.DisableElement(self.rightArrow,!0)},this.onInput=function(str){_inputValue.length||(_oldValue=_value,this.DisableElement(this.leftArrow,!0),this.DisableElement(this.rightArrow,!0)),_inputValue+=str,this.SetValue(_inputValue),clearInterval(this.inputTimer),this.inputTimer=window.setTimeout(function(){self.inputDone()},1e3)},this.inputClear=function(){_inputValue="",_oldValue=null,this.actionBack()},this.inputDone=function(){_inputValue="",_oldValue=null,_value=Math.floor(_value/this.interval)*this.interval,_value>this.max&&(_value=this.max),_value<this.min&&(_value=this.min),this.SetValue(_value),this.RefreshContent()},this.actionBack=function(){clearInterval(this.inputTimer),_inputValue.length>1?(_inputValue=_inputValue.slice(0,-1),this.SetValue(_inputValue),this.inputTimer=window.setTimeout(function(){self.inputDone()},2e3)):(_oldValue||0===_oldValue)&&this.SetValue(_oldValue)},this.EventHandler=function(event){if(eventPrepare(event,!0,"CSimpleSelect"),this.disabled!==!0)switch(event.stopped=!0,event.code){case KEYS.LEFT:this.Previous();break;case KEYS.RIGHT:this.Next();break;case KEYS.BACK:this.actionBack();break;case KEYS.NUM0:case KEYS.NUM1:case KEYS.NUM2:case KEYS.NUM3:case KEYS.NUM4:case KEYS.NUM5:case KEYS.NUM6:case KEYS.NUM7:case KEYS.NUM8:case KEYS.NUM9:this.parameters.noInput||this.onInput(event.code-KEYS.NUM0);break;default:event.stopped=!1}},this.IsChanged=function(){return _value!==_default},this.RefreshContent()}function CInput(parent,parameters){var _default="",self=this;if(this.parameters=parameters,this.attributes={input:{className:"cinput-input"},hint:{className:"cinput-hint cinput-input"},icon:{className:"cinput-icon"},wrapper:{className:"cinput-wrapper"},"text-wrapper":{className:"cinput-text-wrapper"}},this.SetAutocomplete(parameters.autocomplete),this.FoldedClass="folded",void 0!==parameters.attributes&&extend(this.attributes,parameters.attributes),parameters.folded===!0&&(this.attributes.wrapper.className+=" "+this.FoldedClass),void 0!==parameters.style&&(this.attributes.wrapper.className+=" "+parameters.style),this.events=parameters.events||{},CBase.call(this,parent||null),this.bind(this.events),this.type="input",this.name=parameters.name||"input",!(this.parentNode=parameters.parent)){if(void 0===parameters.input)throw"parent or input parameter must be specified";this.parentNode=parameters.input.parentNode}this.parameters.icons=this.parameters.icons||[],this.icons={},self.IsChanged=function(){return _default!==self.GetValue()},self.GetDefault=function(){return _default},self.SetDefault=function(def){_default=def},this.Init(this.GenerateHandle()),elchild(this.parentNode,this.handle)}function CFilterInput(parent,parameters){parameters=extend({style:"main-filter-input",icons:[{name:"ico_search",type:"left",style:"black_search"},{name:"ico_search2",type:"left",style:"white_search"},{name:"f4",click:function(){this.Fold(!this.IsFolded(),!0),this.trigger("onKey")}}]},parameters),CInput.call(this,parent||null,parameters)}function CPVRList(parent){CScrollList.call(this,parent),this.renderMode=this.RENDER_MODE_BULK,this.MEDIA_ACTION_SORT_NONE=16,this.MEDIA_ACTION_SORT_TYPE=MEDIA_ACTION_SORT_TYPE,this.MEDIA_ACTION_SORT_TIME=MEDIA_ACTION_SORT_TIME,this.MEDIA_ACTION_SORT_NAME=MEDIA_ACTION_SORT_NAME,this.MEDIA_ACTION_SORT_SIZE=MEDIA_ACTION_SORT_SIZE,this.name="CPVRList",this.bcrumb=null,this.sbar=null,this.filterType=MEDIA_TYPE_NONE,this.filterText="",this.sortType=MEDIA_ACTION_SORT_NAME,this.mtypes=[],this.path=[],this.mode=MEDIA_TYPE_ROOT_PVR,this.parentItem=null,this.LEVEL_CHANGE_NONE=0,this.LEVEL_CHANGE_UP=-1,this.LEVEL_CHANGE_DOWN=1,this.hideF2=!0,this.data=null,this.hideFrameBtn=!1,this.indexTable={},this.openAction={},this.openAction[MEDIA_TYPE_BACK]=this.OpenBack,this.openAction[MEDIA_TYPE_ROOT_PVR]=this.OpenRoot,this.openAction[MEDIA_TYPE_PVR_SHED]=function(){return!1},this.openAction[MEDIA_TYPE_PVR_REC]=function(){return!1},this.openAction[MEDIA_TYPE_PVR_ERR]=function(){return!1},this.openAction[MEDIA_TYPE_PVR_DONE]=this.OpenRecord}function CModalEditRecord(parent,label,text,data){CModalBox.call(this,parent),this.name="CModalEditRecord";var recLengthHours,recLengthMinutes,self=this,time=new Date,min=time.getMinutes(),hour=time.getHours(),day=time.getDate(),month=time.getMonth()+1;min=10>min?"0"+min:min,hour=10>hour?"0"+hour:hour,day=10>day?"0"+day:day,month=10>month?"0"+month:month,time=new Date(1e3*data.endTime);var min1=time.getMinutes(),hour1=time.getHours(),day1=time.getDate(),month1=time.getMonth()+1,year1=time.getFullYear();min1=10>min1?"0"+min1:min1,hour1=10>hour1?"0"+hour1:hour1,day1=10>day1?"0"+day1:day1,month1=10>month1?"0"+month1:month1,data.duration>0?(recLengthHours=Math.floor(data.duration/3600),recLengthMinutes=Math.floor((data.duration-3600*recLengthHours)/60),recLengthHours>24&&(recLengthHours=23,recLengthMinutes=59),recLengthHours=recLengthHours>9?recLengthHours:"0"+recLengthHours,recLengthMinutes=recLengthMinutes>9?recLengthMinutes:"0"+recLengthMinutes):(recLengthHours="00",recLengthMinutes="00"),this.parseTime=function(){var tt=/^([0-9]+)$/;return echo("parseTime : "+this.value+" | "+tt.test(this.value)),tt.test(this.value)?(this.value>this.maxValue&&(this.value=this.maxValue),this.value.length===this.maxLength&&setTimeout(function(){self.FocusRight()},50)):this.value.length>0&&(this.value=this.value.substring(0,this.value.length-2)),!1},this.checkTime=function(){var h,m,hourE=self.endTimeHour.value,minE=self.endTimeMin.value,dayE=self.endTimeDay.value,monE=self.endTimeMonth.value-1,yearE=self.endTimeYear.value,endTime=new Date(yearE,monE,dayE,hourE,minE),delta=(endTime.getTime()-1e3*data.startTime)/1e3;return echo("task time (ms) end:"+endTime.getTime()+"+ start:"+1e3*data.startTime),delta>0?(h=Math.floor(delta/3600),m=Math.floor((delta-3600*h)/60),h>24&&(h=23,m=59,self.checkEndTime()),self.timeHour.value=h>9?h:"0"+h,self.timeMin.value=m>9?m:"0"+m):(self.timeHour.value="00",self.timeMin.value="00"),!1},this.checkEndTime=function(){var endTime=new Date(1e3*data.startTime+1e3*(3600*self.timeHour.value+60*self.timeMin.value));min=endTime.getMinutes(),min=10>min?"0"+min:min,hour=endTime.getHours(),hour=10>hour?"0"+hour:hour,day=endTime.getDate(),day=10>day?"0"+day:day,month=endTime.getMonth()+1,month=10>month?"0"+month:month,self.endTimeHour.value=hour,self.endTimeMin.value=min,self.endTimeDay.value=day,self.endTimeMonth.value=month,self.endTimeYear.value=endTime.getFullYear()};var html=element("table",{className:"main maxw"},[element("tr",{},[element("td",{className:"name"},_("End recording:")),element("td",{className:"data"},[element("div",{className:"box"},[this.endTimeHour=element("input",{className:"time",type:"text",value:hour1,maxLength:2,minValue:0,maxValue:23,oninput:this.parseTime,onchange:this.checkTime}),element("div",{className:"colon"},":"),this.endTimeMin=element("input",{className:"time",type:"text",value:min1,maxLength:2,minValue:0,maxValue:59,oninput:this.parseTime,onchange:this.checkTime})]),element("div",{className:"box"},[this.endTimeDay=element("input",{className:"time",type:"text",value:day1,maxLength:2,minValue:1,maxValue:31,oninput:this.parseTime,onchange:this.checkTime}),element("div",{className:"colon"},"."),this.endTimeMonth=element("input",{className:"time",type:"text",value:month1,maxLength:2,minValue:1,maxValue:12,oninput:this.parseTime,onchange:this.checkTime}),element("div",{className:"colon"},"."),this.endTimeYear=element("input",{className:"data_time",type:"text",value:year1,maxLength:4,minValue:1,maxValue:9999,oninput:this.parseTime,onchange:this.checkTime})])])]),element("tr",{},[element("td",{className:"name"},_("Record length:")),element("td",{className:"data"},[element("div",{className:"box"},[this.timeHour=element("input",{className:"time",type:"text",value:recLengthHours,maxLength:2,minValue:0,maxValue:23,oninput:this.parseTime,onchange:this.checkEndTime}),element("div",{className:"colon"},":"),this.timeMin=element("input",{className:"time",type:"text",value:recLengthMinutes,maxLength:2,minValue:0,maxValue:59,oninput:this.parseTime,onchange:this.checkEndTime})])])])]);this.focusList=[[this.endTimeHour,this.endTimeMin,this.endTimeDay,this.endTimeMonth,this.endTimeYear],[this.timeHour,this.timeMin]],this.focusPos=0,this.subFocusPos=0,this.FocusNext=function(event,manageVK){if(this.focusList.length>0){++this.focusPos>=this.focusList.length&&(this.focusPos=0);var el=this.focusList[this.focusPos][0];manageVK!==!1&&gSTB.HideVirtualKeyboard(),el.focus(),this.subFocusPos=0,event&&"SELECT"!==el.nodeName&&(event.preventDefault(),el.select())}},this.FocusPrev=function(event,manageVK){if(this.focusList.length>0){--this.focusPos<0&&(this.focusPos=this.focusList.length-1);var el=this.focusList[this.focusPos][0];manageVK!==!1&&gSTB.HideVirtualKeyboard(),el.focus(),this.subFocusPos=0,"SELECT"!==el.nodeName&&(el.select(),event.preventDefault())}},this.FocusRight=function(event){if(this.focusList[this.focusPos].length>1){++this.subFocusPos>=this.focusList[this.focusPos].length&&(this.subFocusPos=0);var el=this.focusList[this.focusPos][this.subFocusPos];el.focus(),"SELECT"!==el.nodeName&&(el.select(),event&&event.preventDefault())}},this.FocusLeft=function(event){if(this.focusList[this.focusPos].length>1){--this.subFocusPos<0&&(this.subFocusPos=this.focusList[this.focusPos].length-1);var el=this.focusList[this.focusPos][this.subFocusPos];el.focus(),"SELECT"!==el.nodeName&&(el.select(),event&&event.preventDefault())}},this.startPVR=function(){var endTime=new Date(self.endTimeYear.value,self.endTimeMonth.value-1,self.endTimeDay.value,self.endTimeHour.value,self.endTimeMin.value);pvrManager.ChangeEndTime(data.id,String(endTime.getTime()/1e3)),self.Show(!1),app.views.main.updatePVRData()},this.bpanel=new CButtonPanel,this.bpanel.Init(CMODAL_IMG_PATH),this.bpanel.Add(KEYS.EXIT,"exit.png",_("Cancel"),function(){self.Show(!1)}),this.bpanel.Add(KEYS.OK,"ok.png",_("Edit"),function(){self.startPVR()}),this.SetHeader(label),this.SetContent(html),this.SetFooter(this.bpanel.handle),this.onShow=function(){self.focusList[self.focusPos][0].focus(),self.focusList[self.focusPos][0].select()},this.onHide=function(){elclear(self.bpanel.handle),delete self.bpanel,self.Free()},this.EventHandler=function(event){if(eventPrepare(event,!0,"CModalAlert"))switch(event.code){case KEYS.CHANNEL_NEXT:case KEYS.CHANNEL_PREV:event.preventDefault();break;case KEYS.UP:self.FocusPrev(event,!1),event.preventDefault();break;case KEYS.DOWN:self.FocusNext(event,!1),event.preventDefault();break;case KEYS.LEFT:self.FocusLeft(event);break;case KEYS.RIGHT:self.FocusRight(event);break;case KEYS.PAGE_UP:document.activeElement.value>=document.activeElement.minValue&&document.activeElement.value<document.activeElement.maxValue&&(document.activeElement.value++,document.activeElement.onchange(),document.activeElement.value<10&&(document.activeElement.value="0"+document.activeElement.value));break;case KEYS.PAGE_DOWN:document.activeElement.value>document.activeElement.minValue&&document.activeElement.value<=document.activeElement.maxValue&&(document.activeElement.value--,document.activeElement.onchange(),document.activeElement.value<10&&(document.activeElement.value="0"+document.activeElement.value));break;default:self.bpanel.EventHandler(event)}},this.Init(),this.Show(!0)}function CModalDelete(parent,data){var self=this,html=element("table",{className:"main maxw"},[element("tr",{},[element("td",{className:"name"},_("Delete related file")),self.switchHandle=element("td",{className:"data"})])]);self.input=new CCheckBox(parent,{parent:self.switchHandle}),this.onShow=function(){setTimeout(function(){self.input.focus()},0)},CModalAlert.call(this,parent,_("Delete record"),html,_("Cancel"),"btnExitClick"),self.EventHandler=function(event){switch(event.code){case KEYS.LEFT:case KEYS.RIGHT:self.input.EventHandler(event);break;default:self.bpanel.EventHandler(event)}},this.name="CModalDelete",this.bpanel.Add(KEYS.OK,"ok.png",_("Delete"),function(){data.forEach(function(item){
echo("deleting (file too? "+self.input.IsChecked()+") by id="+item.data.id);var files,dirs,garbage,currentFolder,recordName,alreadyDeleted=!1,structure=item.data.fileName.split("/");recordName=structure.pop(),garbage=structure.join("/");try{eval(gSTB.ListDir(garbage,!1))}catch(e){echo(e),dirs=[],files=[]}if(self.input.IsChecked()&&1===files.length&&(void 0===files[0].name||files[0].name===recordName||files[0].name===recordName+".tmp.ts")){alreadyDeleted=!0,currentFolder=structure.pop(),garbage=structure.join("/");try{eval(gSTB.ListDir(garbage,!1))}catch(e){echo(e),dirs=[],files=[]}2===dirs.length&&dirs[0]===currentFolder+"/"?(echo("delete channel folder:"+garbage),gSTB.RDir('RemoveDirFull "'+garbage+'"')):(echo("delete time folder:"+garbage),gSTB.RDir('RemoveDirFull "'+garbage+"/"+currentFolder+'"'))}pvrManager.RemoveTask(item.data.id,self.input.IsChecked()&&!alreadyDeleted?3:0)}),parent.lister.DeleteAll(data),self.Show(!1),app.views.main.updatePVRData(),parent.lister.Activate(!0)})}function CModalAddRecord(parent,label,text){CModalBox.call(this,parent),this.name="CModalAddRecord",this.tvChannelsList=[];var self=this,autoCorrection=!0,time=new Date,sec=time.getSeconds(),min=time.getMinutes(),hour=time.getHours(),day=time.getDate(),month=time.getMonth()+1,year=time.getFullYear();time=new Date(time.getTime()+36e5);var min1=time.getMinutes(),hour1=time.getHours(),day1=time.getDate(),month1=time.getMonth()+1,year1=time.getFullYear();sec=sec>9?sec:"0"+sec,min=10>min?"0"+min:min,hour=10>hour?"0"+hour:hour,day=10>day?"0"+day:day,month=10>month?"0"+month:month,min1=10>min1?"0"+min1:min1,hour1=10>hour1?"0"+hour1:hour1,day1=10>day1?"0"+day1:day1,month1=10>month1?"0"+month1:month1,this.parseTime=function(){var tt=/^([0-9]+)$/;return echo("parseTime : "+this.value+" | "+tt.test(this.value)),tt.test(this.value)?(this.value>this.maxValue&&(this.value=this.maxValue),this.value.length===this.maxLength&&setTimeout(function(){self.FocusRight()},50)):this.value.length>0&&(this.value=this.value.substring(0,this.value.length-2)),!1},this.checkTime=function(){self.startTimeYear.value=self.startTimeYear.value||(new Date).getFullYear(),self.startTimeMonth.value=self.startTimeMonth.value||"01",self.startTimeDay.value=self.startTimeDay.value||"00",self.startTimeHour.value=self.startTimeHour.value||"00",self.startTimeMin.value=self.startTimeMin.value||"00",self.endTimeYear.value=self.endTimeYear.value||(new Date).getFullYear(),self.endTimeMonth.value=self.endTimeMonth.value||"01",self.endTimeDay.value=self.endTimeDay.value||"00",self.endTimeHour.value=self.endTimeHour.value||"00",self.endTimeMin.value=self.endTimeMin.value||"00";var startTime=new Date(self.startTimeYear.value,self.startTimeMonth.value-1,self.startTimeDay.value,self.startTimeHour.value,self.startTimeMin.value),endTime=new Date(self.endTimeYear.value,self.endTimeMonth.value-1,self.endTimeDay.value,self.endTimeHour.value,self.endTimeMin.value),delta=(endTime.getTime()-startTime.getTime())/1e3;if(delta>0){var h=Math.floor(delta/3600),m=Math.floor((delta-3600*h)/60);h>24&&(h=23,m=59,self.checkEndTime()),self.timeHour.value=h>9?h:"0"+h,self.timeMin.value=m>9?m:"0"+m}else self.timeHour.value="00",self.timeMin.value="00";return autoCorrection&&(self.itemName.value=(self.startTimeHour.value<10&&"00"!==self.startTimeHour.value?"0"+Number(self.startTimeHour.value):self.startTimeHour.value)+":",self.itemName.value+=(self.startTimeMin.value<10&&"00"!==self.startTimeMin.value?"0"+Number(self.startTimeMin.value):self.startTimeMin.value)+":00"),!1},this.checkEndTime=function(){var hour=self.startTimeHour.value,min=self.startTimeMin.value,day=self.startTimeDay.value;self.timeHour.value=self.timeHour.value||"00",self.timeMin.value=self.timeMin.value||"00";var startTime=new Date(self.startTimeYear.value,self.startTimeMonth.value-1,day,hour,min),endTime=new Date(startTime.getTime()+1e3*(3600*self.timeHour.value+60*self.timeMin.value));min=endTime.getMinutes(),min=10>min?"0"+min:min,hour=endTime.getHours(),hour=10>hour?"0"+hour:hour,day=endTime.getDate(),day=10>day?"0"+day:day,month=endTime.getMonth()+1,month=10>month?"0"+month:month,self.endTimeHour.value=hour,self.endTimeMin.value=min,self.endTimeDay.value=day,self.endTimeMonth.value=month,self.endTimeYear.value=endTime.getFullYear()},this.unEscapeChannels=function recursive(arr){for(var data=JSON.parse(JSON.stringify(arr)),i=0;i<data.length;i++)data[i].id=i,data[i].data?(data[i].name=unescape(data[i].name),data[i].data=recursive(data[i].data)):(data[i].name=unescape(data[i].name),data[i].url=unescape(data[i].url),data[i].label=data[i].name);return data},this.loadChannels=function(){echo("loadChannels");try{var text=gSTB.LoadUserData("iptv.json");if(""!==text){var data=JSON.parse(text);data=self.unEscapeChannels(data);var arr=[_("IPTV")];data.forEach(function recursive(item){item.data?(arr.push(item.name),item.data.forEach(recursive),arr.pop()):(item.path=arr.slice(0).join("/"),item.path.length>33&&(item.path=item.path.substring(0,15)+"..."+item.path.substring(item.path.length-15,item.path.length)),self.tvChannelsList.push(item))})}else self.tvChannelsList=[]}catch(e){echo(e,"TVChannels parse error")}},this.loadChannels(),app.refreshStorageInfo(),echo(app.storage,"app.storage"),this.device=new CSelectBox(this,{data:app.storage.length>0?app.storage:[{id:-1,label:_("No storage device")}],nameField:"label",style:"cselect-box-wide",events:{onChange:function(){self.$freeSize.innerHTML=this.GetSelected().freeSizeGb||"0",self.$totlaSize.innerHTML=this.GetSelected().sizeGb||"0"}}}),this.$channels=new CSelectBox(this,{data:this.tvChannelsList.length>0?this.tvChannelsList:[{id:-1,label:_("No channels")}],nameField:"label",style:"cselect-box-wide",events:{onChange:function(){var path=self.$channels.GetSelected().path;path.length>34&&(path=path.substring(0,15)+"..."+path.substring(path.length-15,path.length)),self.$chanPath.innerHTML=path}}});var html=element("table",{className:"main maxw"},[element("tr",{},[element("td",{className:"name"},_("Start recording:")),element("td",{className:"data"},[element("div",{className:"box"},[this.startTimeHour=element("input",{className:"time",type:"text",value:hour,maxLength:2,minValue:0,maxValue:23,oninput:this.parseTime,onchange:this.checkTime}),element("div",{className:"colon"},":"),this.startTimeMin=element("input",{className:"time",type:"text",value:min,maxLength:2,minValue:0,maxValue:59,oninput:this.parseTime,onchange:this.checkTime})]),element("div",{className:"box"},[this.startTimeDay=element("input",{className:"time",type:"text",value:day,maxLength:2,minValue:1,maxValue:31,oninput:this.parseTime,onchange:this.checkTime}),element("div",{className:"colon"},"."),this.startTimeMonth=element("input",{className:"time",type:"text",value:month,maxLength:2,minValue:1,maxValue:12,oninput:this.parseTime,onchange:this.checkTime}),element("div",{className:"colon"},"."),this.startTimeYear=element("input",{className:"data_time",type:"text",value:year,maxLength:4,minValue:1,maxValue:9999,oninput:this.parseTime,onchange:this.checkTime})])])]),element("tr",{},[element("td",{className:"name"},_("End recording:")),element("td",{className:"data"},[element("div",{className:"box"},[this.endTimeHour=element("input",{className:"time",type:"text",value:hour1,maxLength:2,minValue:0,maxValue:23,oninput:this.parseTime,onchange:this.checkTime}),element("div",{className:"colon"},":"),this.endTimeMin=element("input",{className:"time",type:"text",value:min1,maxLength:2,minValue:0,maxValue:59,oninput:this.parseTime,onchange:this.checkTime})]),element("div",{className:"box"},[this.endTimeDay=element("input",{className:"time",type:"text",value:day1,maxLength:2,minValue:1,maxValue:31,oninput:this.parseTime,onchange:this.checkTime}),element("div",{className:"colon"},"."),this.endTimeMonth=element("input",{className:"time",type:"text",value:month1,maxLength:2,minValue:1,maxValue:12,oninput:this.parseTime,onchange:this.checkTime}),element("div",{className:"colon"},"."),this.endTimeYear=element("input",{className:"data_time",type:"text",value:year1,maxLength:4,minValue:1,maxValue:9999,oninput:this.parseTime,onchange:this.checkTime})])])]),element("tr",{},[element("td",{className:"name"},_("Record length:")),element("td",{className:"data"},[element("div",{className:"box"},[this.timeHour=element("input",{className:"time",type:"text",value:"01",maxLength:2,minValue:0,maxValue:23,oninput:this.parseTime,onchange:this.checkEndTime}),element("div",{className:"colon"},":"),this.timeMin=element("input",{className:"time",type:"text",value:"00",maxLength:2,minValue:0,maxValue:59,oninput:this.parseTime,onchange:this.checkEndTime})])])]),element("tr",{},[element("td",{className:"name"},_("Path:")),element("td",{className:"data"},this.$chanPath=element("span",{className:"size"},this.$channels.GetSelected().path))]),element("tr",{},[element("td",{className:"name"},_("Channel:")),element("td",{className:"data"},this.$channels.parentNode)]),element("tr",{},[element("td",{className:"name"},_("Record name:")),element("td",{className:"data"},[this.itemName=element("input",{className:"wide",type:"text",value:hour+":"+min+":"+sec,change:!1,onchange:function(){},oninput:function(){this.change=!0,autoCorrection=!1}})])]),element("tr",{},[element("td",{className:"name"},_("Record in:")),element("td",{className:"data"},this.device.parentNode)]),element("tr",{},[element("td"),element("td",{className:"data"},[_("Free space:")+" ",this.$freeSize=element("span",{className:"size"},this.device.GetSelected().freeSizeGb||"0")," "+_("GB")+"   "+_("of")+" ",this.$totlaSize=element("span",{className:"size"},this.device.GetSelected().sizeGb||"0")," "+_("GB")])])]);this.focusList=[[this.startTimeHour,this.startTimeMin,this.startTimeDay,this.startTimeMonth,this.startTimeYear],[this.endTimeHour,this.endTimeMin,this.endTimeDay,this.endTimeMonth,this.endTimeYear],[this.timeHour,this.timeMin],[this.$channels],[this.itemName],[this.device]],this.startTimeHour.oninput=this.parseTime,this.focusPos=0,this.subFocusPos=0,this.FocusNext=function(event,manageVK){if(this.focusList.length>0){++this.focusPos>=this.focusList.length&&(this.focusPos=0);var el=this.focusList[this.focusPos][0];manageVK!==!1&&gSTB.HideVirtualKeyboard(),el.focus(),this.subFocusPos=0,event&&"SELECT"!==el.nodeName&&(event.preventDefault(),el.select&&el.select())}},this.FocusPrev=function(event,manageVK){if(this.focusList.length>0){--this.focusPos<0&&(this.focusPos=this.focusList.length-1);var el=this.focusList[this.focusPos][0];manageVK!==!1&&gSTB.HideVirtualKeyboard(),el.focus(),this.subFocusPos=0,"SELECT"!==el.nodeName&&(el.select&&el.select(),event.preventDefault())}},this.FocusRight=function(event){if(this.focusList[this.focusPos].length>1){++this.subFocusPos>=this.focusList[this.focusPos].length&&(this.subFocusPos=0);var el=this.focusList[this.focusPos][this.subFocusPos];el.focus(),"SELECT"!==el.nodeName&&(el.select&&el.select(),event&&event.preventDefault())}},this.FocusLeft=function(event){if(this.focusList[this.focusPos].length>1){--this.subFocusPos<0&&(this.subFocusPos=this.focusList[this.focusPos].length-1);var el=this.focusList[this.focusPos][this.subFocusPos];el.focus(),"SELECT"!==el.nodeName&&(el.select&&el.select(),event&&event.preventDefault())}},this.startPVR=function(){if(self.$channels.GetSelected().id<0)return void new CModalHint(currCPage,_("Channel list is empty"),3e3);var arr,inProgress=0;try{arr=JSON.parse(pvrManager.GetAllTasks())}catch(e){arr=[]}if(arr.forEach(function(item){2===item.state&&inProgress++}),inProgress>=5)return void new CModalHint(currCPage,_("Error. Too many active records."),3e3);if(-1===self.device.GetSelected().id)return void new CModalHint(currCPage,_("No storage device"),3e3);if(0===self.device.GetSelected().freeSize)return void new CModalHint(currCPage,_("Not enough disk space"),3e3);var url=self.$channels.GetSelected().url.replace(/@/gim,""),devPath=self.device.GetSelected().mountPath,chanName=self.$channels.GetSelected().name.replace(/\/|\*|:|\\|\?|\||'|&|"|\^|%|<|>/gim,"");echo(url,"SELECTED CHANNEL IS"),gSTB.ExecAction('make_dir "'+devPath+'/records"'),gSTB.ExecAction('make_dir "'+devPath+"/records/"+chanName+'"'),gSTB.ExecAction('make_dir "'+devPath+"/records/"+chanName+"/"+this.startTimeYear.value+"-"+this.startTimeMonth.value+"-"+this.startTimeDay.value+'"');var text,name=devPath+"/records/"+chanName+"/"+this.startTimeYear.value+"-"+this.startTimeMonth.value+"-"+this.startTimeDay.value+"/"+this.itemName.value.split(":").join("-").replace(/\/|\*|:|\\|\?|\||'|&|"|\^|%|<|>/gim,"")+".ts",hour=self.startTimeHour.value,min=self.startTimeMin.value,day=self.startTimeDay.value,mon=self.startTimeMonth.value-1,year=self.startTimeYear.value,startTime=new Date(year,mon,day,hour,min),hourE=self.endTimeHour.value,minE=self.endTimeMin.value,dayE=self.endTimeDay.value,monE=self.endTimeMonth.value-1,yearE=self.endTimeYear.value,endTime=new Date(yearE,monE,dayE,hourE,minE),done=pvrManager.CreateTask(url,name,startTime.getTime()/1e3,endTime.getTime()/1e3);if(echo(">DONE:"+done),0>done){switch(done){case"-2":text=_("Not enough disk space");break;case"-3":text=_("Incorrect time");break;case"-5":text=_("Wrong name or path");break;case"-6":text=_("Duplicated file");break;case"-7":text=_("Wrong URL");break;case"-9":text=_("Too many active records processed");break;case"-11":text=_("Not enough disk space");break;default:text=_("Error...")}new CModalHint(currCPage,text,3e3)}else self.Show(!1),app.views.main.updatePVRData()},this.bpanel=new CButtonPanel,this.bpanel.Init(CMODAL_IMG_PATH),this.bpanel.Add(KEYS.EXIT,"exit.png",_("Cancel"),function(){self.Show(!1)}),this.bpanel.Add(KEYS.OK,"ok.png",_("Start recording"),function(){self.startPVR()}),this.SetHeader(label),this.SetContent(html),this.SetFooter(this.bpanel.handle),this.onShow=function(){self.focusList[self.focusPos][0].focus(),self.focusList[self.focusPos][0].select()},this.onHide=function(){elclear(self.bpanel.handle),delete self.bpanel,self.Free()},this.EventHandler=function(event){if(eventPrepare(event,!0,"CModalAlert")&&(document.activeElement.component&&document.activeElement.component.constructor===CSelectBox&&document.activeElement.component.EventHandler(event),event.stopped!==!0))switch(event.code){case KEYS.CHANNEL_NEXT:case KEYS.CHANNEL_PREV:event.preventDefault();break;case KEYS.UP:self.FocusPrev(event,!1),event.preventDefault();break;case KEYS.DOWN:self.FocusNext(event,!1),event.preventDefault();break;case KEYS.LEFT:self.FocusLeft(event);break;case KEYS.RIGHT:self.FocusRight(event);break;case KEYS.PAGE_UP:document.activeElement.value>=document.activeElement.minValue&&document.activeElement.value<document.activeElement.maxValue&&(document.activeElement.value++,document.activeElement.onchange(),document.activeElement.value<10&&(document.activeElement.value="0"+document.activeElement.value));break;case KEYS.PAGE_DOWN:document.activeElement.value>document.activeElement.minValue&&document.activeElement.value<=document.activeElement.maxValue&&(document.activeElement.value--,document.activeElement.onchange(),document.activeElement.value<10&&(document.activeElement.value="0"+document.activeElement.value));break;default:self.bpanel.EventHandler(event)}},this.Init(),this.Show(!0)}var DEBUG=!0,DEBUG_NAME="",DEBUG_SERVER="",EMULATION=!1,PATH_MODE_WEB=!1,PATH_ROOT=null,PATH_SYSTEM=null,PATH_PUBLIC="public/",PATH_MEDIA="/media/",WINDOW_WIDTH=screen.width,WINDOW_HEIGHT=screen.height,URL_PARAMS={},initFound=!1,proxy;window.parent&&window.parent.gSTB&&(window.dvbManager=window.parent.dvbManager,window.epgManager=window.parent.epgManager,window.gSTB=window.parent.gSTB,window.pvrManager=window.parent.pvrManager,window.stbDownloadManager=window.parent.stbDownloadManager,window.stbStorage=window.parent.stbStorage,window.stbUpdate=window.parent.stbUpdate,window.stbUPnP=window.parent.stbUPnP,window.stbWebWindow=window.parent.stbWebWindow,window.stbWindowMgr=window.parent.stbWindowMgr,window.timeShift=window.parent.timeShift),PATH_ROOT=location.pathname.split("/"),PATH_ROOT[PATH_ROOT.length-1]="",PATH_ROOT=PATH_ROOT.join("/"),PATH_ROOT=location.protocol+"//"+location.host+PATH_ROOT+PATH_BASE,PATH_SYSTEM=PATH_ROOT+"system/",document.location.search&&document.location.search.substring(1).split("&").forEach(function(part){part=part.split("="),2===part.length&&(URL_PARAMS[part[0]]=decodeURIComponent(part[1]))}),void 0===window.gSTB&&void 0===window.parent.gSTB?(DEBUG=EMULATION=!0,DEBUG_SERVER=DEBUG_SERVER||localStorage.getItem("DEBUG_SERVER"),DEBUG_NAME=DEBUG_NAME||localStorage.getItem("DEBUG_NAME"),WINDOW_WIDTH=parseInt(URL_PARAMS.width,10)||window.outerWidth,WINDOW_HEIGHT=parseInt(URL_PARAMS.height,10)||window.outerHeight,document.write('<script type="text/javascript" src="'+PATH_SYSTEM+'gstb.js"></script>\n'),document.write('<script type="text/javascript" src="'+PATH_SYSTEM+'debug.js"></script>\n'),document.write('<script type="text/javascript" src="http://'+DEBUG_SERVER+':8800/file/client.js"></script>\n'),document.write('<script type="text/javascript">if ( window.proxyClient ) {proxy = new proxyClient();if ( DEBUG_NAME && DEBUG_SERVER ) proxy.init({name:"'+DEBUG_NAME+'", host:"'+DEBUG_SERVER+'"}); }</script>\n'),window.addEventListener("load",function(){document.body.style.backgroundColor="black"})):(gSTB.SetNativeStringMode(!0),function(){var vars=JSON.parse(gSTB.GetEnv(JSON.stringify({varList:["debug","debug_name","debug_server"]})));!vars.errMsg&&vars.result&&(DEBUG="1"===vars.result.debug,DEBUG&&!URL_PARAMS.nodebug&&(document.write('<script type="text/javascript" src="'+PATH_SYSTEM+'debug.js"></script>\n'),DEBUG_NAME=DEBUG_NAME||vars.result.debug_name,DEBUG_SERVER=DEBUG_SERVER||vars.result.debug_server,DEBUG_NAME&&DEBUG_SERVER&&"1"!==stbStorage.getItem("spyjs.active")&&document.write('<script type="text/javascript" src="http://'+DEBUG_SERVER+":8000/target/target-script-min.js#"+DEBUG_NAME+'"></script>\n')))}());var PATH_IMG_SYSTEM=PATH_SYSTEM+"img/"+WINDOW_WIDTH+"/",PATH_IMG_PUBLIC=PATH_ROOT+"public/img/"+WINDOW_WIDTH+"/",configuration=function(){var config={newRemoteControl:!1,allowMulticastUpdate:!1};return config.newRemoteControl=-1!==["AuraHD2","AuraHD3","AuraHD8","MAG275","MAG276","WR320","MAG254"].indexOf(gSTB.GetDeviceModelExt()),config}(),WINDOWS={PORTAL:"portal",HELP:"help",DOWNLOAD_MANAGER:"dlman",PVR:"recordsManager",BROWSER:"ibman",BROWSER_VIEW:"ibmanView",PORTALS_LOADER:"portalsLoader",SYSTEM_SETTINGS:"systemSettings"},KEYS={BACK:8,NUM1:49,NUM2:50,NUM3:51,NUM4:52,NUM5:53,NUM6:54,NUM7:55,NUM8:56,NUM9:57,NUM0:48,DELETE:46,CHANNEL_PREV:1009,CHANNEL_NEXT:9,OK:13,EXIT:27,UP:38,DOWN:40,LEFT:37,RIGHT:39,PAGE_UP:33,PAGE_DOWN:34,END:35,HOME:36,VOLUME_UP:107,VOLUME_DOWN:109,F1:112,F2:113,F3:114,F4:115,REFRESH:116,FRAME:117,PHONE:119,EPG:119,SET:120,TV:121,MENU:122,WEB:123,MIC:2032,REWIND:2066,FORWARD:2070,APP:2076,USB_MOUNTED:2080,USB_UNMOUNTED:2081,PLAY_PAUSE:2082,STOP:2083,POWER:2085,RECORD:2087,INFO:2089,MUTE:2192,CLOCK:2032,AUDIO:2071,KEYBOARD:2076},gettext=function(){var module={},data=null;return module.init=function(options,onReady){options.name=options.name||"en",options.ext=options.ext||"js",options.path=options.path||"lang",data=null,"en"!==options.name?loadScript(options.path+"/"+options.name+"."+options.ext,onReady,onReady):"function"==typeof onReady&&onReady()},module.load=function(input){data=input},module.data=function(key){return null===data?key:void 0!==data[key]?data[key]:key},module}(),_=gettext.data;if(void 0===window.echo&&(window.echo=function(data,title){}),ajax.stop=!1,parseUri.options={strictMode:!1,key:["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],q:{name:"queryKey",parser:/(?:^|&)([^&=]*)=?([^&]*)/g},parser:{strict:/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/,loose:/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/}},!("classList"in document.documentElement)){var prototype=Array.prototype,indexOf=prototype.indexOf,slice=prototype.slice,push=prototype.push,splice=prototype.splice,join=prototype.join;window.DOMTokenList=function(el){if(this._element=el,el.className!==this._classCache){if(this._classCache=el.className,!this._classCache)return;var i,classes=this._classCache.replace(/^\s+|\s+$/g,"").split(/\s+/);for(i=0;i<classes.length;i++)push.call(this,classes[i])}},window.DOMTokenList.prototype={add:function(token){this.contains(token)||(push.call(this,token),this._element.className=slice.call(this,0).join(" "))},contains:function(token){return-1!==indexOf.call(this,token)},item:function(index){return this[index]||null},remove:function(token){var i=indexOf.call(this,token);-1!==i&&(splice.call(this,i,1),this._element.className=slice.call(this,0).join(" "))},toString:function(){return join.call(this," ")},toggle:function(token){return this.contains(token)?this.remove(token):this.add(token),this.contains(token)}},Object.defineProperty(Element.prototype,"classList",{get:function(){return new window.DOMTokenList(this)}})}var Events={bind:function(event,callback){if(this._events||(this._events={}),"object"==typeof event)for(var name in event)this.bind(name,event[name]);else"string"==typeof event&&"function"==typeof callback&&(void 0===this._events[event]&&(this._events[event]=[]),this._events[event].push(callback))},trigger:function(event,data){var result,results=[],self=this;return void 0!==event&&void 0!==this._events&&void 0!==this._events[event]&&this._events[event].forEach(function(ev){result=ev.call(self,data),void 0!==result&&results.push(result)}),results},unbind:function(event){delete this._events[event]},inject:function(obj){"function"==typeof obj?extend(obj.prototype,this):"object"==typeof obj&&extend(obj,this)}},timeZoneOffsets={A:{index:-1,minutes:60},ACDT:{index:-1,minutes:60},ACST:{index:-1,minutes:570},ACT:{index:1,minutes:300},ACWST:{index:-1,minutes:525},ADT:{index:1,minutes:180},AEDT:{index:-1,minutes:61},AEST:{index:-1,minutes:60},AFT:{index:-1,minutes:270},AKDT:{index:1,minutes:480},AKST:{index:1,minutes:540},ALMT:{index:-1,minutes:360},AMST:{index:1,minutes:180},AMT:{index:1,minutes:240},ANAST:{index:-1,minutes:62},ANAT:{index:-1,minutes:62},AQTT:{index:-1,minutes:300},ART:{index:1,minutes:180},AST:{index:1,minutes:240},AWDT:{index:-1,minutes:540},AWST:{index:-1,minutes:480},AZOST:{index:0,minutes:0},AZOT:{index:1,minutes:60},AZST:{index:-1,minutes:300},AZT:{index:-1,minutes:240},B:{index:-1,minutes:120},BNT:{index:-1,minutes:480},BOT:{index:1,minutes:240},BRST:{index:1,minutes:120},BRT:{index:1,minutes:180},BST:{index:-1,minutes:60},BTT:{index:-1,minutes:360},C:{index:-1,minutes:180},CAST:{index:-1,minutes:480},CAT:{index:-1,minutes:120},CCT:{index:-1,minutes:390},CDT:{index:1,minutes:300},CEST:{index:-1,minutes:120},CET:{index:-1,minutes:60},CHADT:{index:-1,minutes:63},CHAST:{index:-1,minutes:62},CHOT:{index:-1,minutes:480},CHUT:{index:-1,minutes:600},CKT:{index:1,minutes:60},CLST:{index:1,minutes:180},CLT:{index:1,minutes:240},COT:{index:1,minutes:300},CST:{index:1,minutes:360},CVT:{index:1,minutes:60},CXT:{index:-1,minutes:420},ChST:{index:-1,minutes:60},D:{index:-1,minutes:240},DAVT:{index:-1,minutes:420},E:{index:-1,minutes:300},EASST:{index:1,minutes:300},EAST:{index:1,minutes:360},EAT:{index:-1,minutes:180},ECT:{index:1,minutes:300},EDT:{index:-1,minutes:61},EEST:{index:-1,minutes:180},EET:{index:-1,minutes:120},EGST:{index:0,minutes:0},EGT:{index:1,minutes:60},EST:{index:1,minutes:300},ET:{index:1,minutes:300},F:{index:-1,minutes:360},FET:{index:-1,minutes:180},FJST:{index:-1,minutes:63},FJT:{index:-1,minutes:62},FKST:{index:1,minutes:180},FKT:{index:1,minutes:240},FNT:{index:1,minutes:120},G:{index:-1,minutes:420},GALT:{index:1,minutes:360},GAMT:{index:1,minutes:540},GET:{index:-1,minutes:240},GFT:{index:1,minutes:180},GILT:{index:-1,minutes:62},GMT:{index:0,minutes:0},GST:{index:-1,minutes:240},GYT:{index:1,minutes:240},H:{index:-1,minutes:480},HAA:{index:1,minutes:180},HAC:{index:1,minutes:300},HADT:{index:1,minutes:540},HAE:{index:1,minutes:240},HAP:{index:1,minutes:420},HAR:{index:1,minutes:360},HAST:{index:1,minutes:60},HAT:{index:1,minutes:150},HAY:{index:1,minutes:480},HKT:{index:-1,minutes:480},HLV:{index:1,minutes:270},HNA:{index:1,minutes:240},HNC:{index:1,minutes:360},HNE:{index:1,minutes:300},HNP:{index:1,minutes:480},HNR:{index:1,minutes:420},HNT:{index:1,minutes:210},HNY:{index:1,minutes:540},HOVT:{index:-1,minutes:420},I:{index:-1,minutes:540},ICT:{index:-1,minutes:420},IDT:{index:-1,minutes:180},IOT:{index:-1,minutes:360},IRDT:{index:-1,minutes:270},IRKST:{index:-1,minutes:540},IRKT:{index:-1,minutes:540},IRST:{index:-1,minutes:210},IST:{index:-1,minutes:60},JST:{index:-1,minutes:540},K:{index:-1,minutes:60},KGT:{index:-1,minutes:360},KOST:{index:-1,minutes:660},KRAST:{index:-1,minutes:480},KRAT:{index:-1,minutes:480},KST:{index:-1,minutes:540},KUYT:{index:-1,minutes:240},L:{index:-1,minutes:61},LHDT:{index:-1,minutes:61},LHST:{index:-1,minutes:60},LINT:{index:-1,minutes:64},M:{index:-1,minutes:62},MAGST:{index:-1,minutes:62},MAGT:{index:-1,minutes:62},MART:{index:1,minutes:570},MAWT:{index:-1,minutes:300},MDT:{index:1,minutes:360},MESZ:{index:-1,minutes:120},MEZ:{index:-1,minutes:60},MHT:{index:-1,minutes:62},MMT:{index:-1,minutes:390},MSD:{index:-1,minutes:240},MSK:{index:-1,minutes:240},MST:{index:1,minutes:420},MUT:{index:-1,minutes:240},MVT:{index:-1,minutes:300},MYT:{index:-1,minutes:480},N:{index:1,minutes:60},NCT:{index:-1,minutes:61},NDT:{index:1,minutes:150},NFT:{index:-1,minutes:61},NOVST:{index:-1,minutes:420},NOVT:{index:-1,minutes:360},NPT:{index:-1,minutes:345},NRT:{index:-1,minutes:720},NST:{index:1,minutes:210},NUT:{index:1,minutes:61},NZDT:{index:-1,minutes:63},NZST:{index:-1,minutes:62},O:{index:1,minutes:120},OMSST:{index:-1,minutes:420},OMST:{index:-1,minutes:420},ORAT:{index:-1,minutes:300},P:{index:1,minutes:180},PDT:{index:1,minutes:420},PET:{index:1,minutes:300},PETST:{index:-1,minutes:62},PETT:{index:-1,minutes:62},PGT:{index:-1,minutes:60},PHOT:{index:-1,minutes:63},PHT:{index:-1,minutes:480},PKT:{index:-1,minutes:300},PMDT:{index:1,minutes:120},PMST:{index:1,minutes:180},PONT:{index:-1,minutes:61},PST:{index:1,minutes:480},PT:{index:1,minutes:480},PWT:{index:-1,minutes:540},PYST:{index:1,minutes:180},PYT:{index:1,minutes:240},Q:{index:1,minutes:240},QYZT:{index:1,minutes:360},R:{index:1,minutes:300},RET:{index:-1,minutes:240},S:{index:1,minutes:360},SAKT:{index:1,minutes:600},SAMT:{index:-1,minutes:240},SAST:{index:-1,minutes:120},SBT:{index:-1,minutes:61},SCT:{index:-1,minutes:240},SGT:{index:-1,minutes:480},SRET:{index:-1,minutes:660},SRT:{index:1,minutes:180},SST:{index:1,minutes:61},T:{index:1,minutes:420},TAHT:{index:1,minutes:60},TFT:{index:-1,minutes:300},TJT:{index:-1,minutes:300},TKT:{index:-1,minutes:63},TLT:{index:-1,minutes:540},TMT:{index:-1,minutes:300},TOT:{index:-1,minutes:780},TVT:{index:-1,minutes:62},U:{index:1,minutes:480},ULAT:{index:-1,minutes:480},UTC:{index:0,minutes:0},UYST:{index:1,minutes:120},UYT:{index:1,minutes:180},UZT:{index:-1,minutes:300},V:{index:1,minutes:540},VET:{index:1,minutes:270},VLAST:{index:-1,minutes:61},VLAT:{index:-1,minutes:61},VUT:{index:-1,minutes:61},W:{index:1,minutes:60},WARST:{index:1,minutes:180},WAST:{index:-1,minutes:120},WAT:{index:-1,minutes:60},WEST:{index:-1,minutes:60},WESZ:{index:-1,minutes:60},WET:{index:0,minutes:0},WEZ:{index:0,minutes:0},WFT:{index:-1,minutes:62},WGST:{index:1,minutes:120},WGT:{index:1,minutes:180},WIB:{index:-1,minutes:420},WIT:{index:-1,minutes:540},WITA:{index:-1,minutes:480},WST:{index:-1,minutes:63},WT:{index:0,minutes:0},X:{index:1,minutes:61},Y:{index:1,minutes:62},YAKST:{index:-1,minutes:60},YAKT:{index:-1,minutes:60},YAPT:{index:-1,minutes:60},YEKST:{index:-1,minutes:360},YEKT:{index:-1,minutes:360},Z:{index:0,minutes:0}};Array.prototype.shuffle=function(){for(var i,tmp,n=this.length;n--;)i=Math.floor(n*Math.random()),tmp=this[i],this[i]=this[n],this[n]=tmp;return this},CBase.prototype.SetParent=function(parent){parent instanceof CBase&&(this.parent=parent)},CBase.prototype.Init=function(handle){if(handle&&handle.nodeName){this.handle=handle,this.baseClass&&-1===handle.className.indexOf(this.baseClass)?this.handleInner=this.handle.appendChild(element("div",{className:this.baseClass})):this.handleInner=this.handle;var self=this;this.handle.addEventListener("click",function(event){"function"==typeof self.onClick&&self.onClick()===!1&&event.stopPropagation()}),"function"==typeof this.onInit&&this.onInit()}},CBase.prototype.Activate=function(active){this.isActive=active!==!1,this.isActive?("function"==typeof this.onActivate&&this.onActivate(),this.parent&&(this.parent.activeChild&&this.parent.activeChild!==this&&this.parent.activeChild.Activate(!1),this.parent.activeChild=this)):("function"==typeof this.onDeactivate&&this.onDeactivate(),this.parent&&(this.parent.activeChild=null))},CBase.prototype.Show=function(visible,manageFocus){var success=!1;return this.handle&&(this.isVisible=visible!==!1,this.isVisible?this.handle.style.display!==this.showAttr&&(this.prevFocus=document.activeElement,manageFocus!==!1&&document.activeElement&&document.activeElement.blur(),this.handle.style.display=this.showAttr,manageFocus!==!1&&this.handle.focus(),"function"==typeof this.onShow&&this.onShow(),success=!0):"none"!==this.handle.style.display&&(manageFocus!==!1&&document.activeElement&&document.activeElement.blur(),this.handle.style.display="none",manageFocus!==!1&&this.prevFocus&&this.prevFocus.focus(),"function"==typeof this.onHide&&this.onHide(),this.isActive&&this.Activate(!1),success=!0)),success},CBase.prototype.Visible=function(mode){this.handle.style.visibility=Boolean(mode)?"visible":"hidden"},CBase.prototype.EventHandler=null,CBase.prototype.onInit=null,CBase.prototype.onShow=null,CBase.prototype.onHide=null,CBase.prototype.onActivate=null,CBase.prototype.onDeactivate=null,CBase.prototype.onClick=function(){return this.Activate(!0),!0},CPage.prototype=Object.create(CBase.prototype),CPage.prototype.constructor=CPage,CPage.prototype.Show=function(visible,previous){visible===!1?(this.activeChild&&this.activeChild.Activate(!1),CBase.prototype.Show.call(this,!1,!0,!0),window.currCPage=this.previous||window.baseCPage,this.previous=null,window.currCPage&&window.currCPage!==this&&CBase.prototype.Show.call(window.currCPage,!0,!0,!0)):(window.currCPage&&window.currCPage!==this&&(window.currCPage.activeChild&&window.currCPage.activeChild.Activate(!1),CBase.prototype.Show.call(window.currCPage,!1,!0,!0)),CBase.prototype.Show.call(this,!0,!0,!0),this.previous=previous||null,window.currCPage=this)},CPage.prototype.onClick=function(){return!1},CPage.prototype.EventHandler=function(){},CScrollList.prototype=Object.create(CBase.prototype),CScrollList.prototype.constructor=CScrollList,CScrollList.prototype.Init=function(handle){CBase.prototype.Init.call(this,handle);var self=this;this.handleInner.onmousewheel=function(event){var direction=event.wheelDeltaY>0,found=self.Next(null,direction);return found&&(self.MoveNext(direction?-1:1),self.Focused(found,!0)),event.stopPropagation(),!1}},CScrollList.prototype.Add=function(body,attrs){attrs=attrs||{};var item=element("a",this.defaultParams,body);this.renderMode===this.RENDER_MODE_BULK?this.fragment.appendChild(item):this.handleInner.appendChild(item),attrs.hidden&&this.Hidden(item,!0),attrs.marked&&this.Marked(item,!0),attrs.disabled&&this.Disabled(item,!0),attrs.focused&&this.Focused(item,!0,attrs.manageFocus);for(var name in attrs)attrs.hasOwnProperty(name)&&(item[name]=attrs[name]);return item},CScrollList.prototype.Render=function(){this.fragment.childNodes.length>0&&this.handleInner.appendChild(this.fragment)},CScrollList.prototype.Clear=function(){this.handleInner.innerHTML=null,this.activeItem=null,
this.states={}},CScrollList.prototype.Reset=function(item){item&&item.nodeName&&(this.Hidden(item,this.defaultParams.hidden),this.Marked(item,this.defaultParams.marked),this.Disabled(item,this.defaultParams.disabled),this.Focused(item,this.defaultParams.focused),item!==this.activeItem||item.focused||(this.activeItem=null))},CScrollList.prototype.DeleteAll=function(items){var self=this,curPos=null;Array.isArray(items)&&items.length>0&&(null!==document.activeElement&&document.activeElement.parentNode===this.handleInner&&document.activeElement.blur(),-1===items.indexOf(this.Current())?curPos=this.Current():(curPos=this.Next({marked:!1,hidden:!1,disabled:!1}),(null===curPos||curPos===this.Current())&&(curPos=this.Next({marked:!1,hidden:!1,disabled:!1},!0))),items.forEach(function(item){self.Delete(item)}),null!==curPos&&(this.Focused(curPos,!0),this.SetPosition(curPos,!0)))},CScrollList.prototype.Delete=function(item){if(item&&item.nodeName&&item.parentNode===this.handleInner){for(var name in this.states)if(this.states.hasOwnProperty(name)){var index=this.states[name].indexOf(item);-1!==index&&this.states[name].splice(index,1)}item===this.activeItem&&(this.activeItem=null),this.handleInner.removeChild(item)}},CScrollList.prototype.Current=function(){return this.activeItem},CScrollList.prototype.Length=function(){return this.handleInner.children.length+this.fragment.childNodes.length},CScrollList.prototype.SetState=function(item,option,state){if(state=Boolean(state),item[option]!==state){this.states[option]||(this.states[option]=[]);var index=this.states[option].indexOf(item);state?-1===index&&this.states[option].push(item):-1!==index&&this.states[option].splice(index,1);var oldVal=item[option];return item[option]=state,state?item.classList.add(option):item.classList.remove(option),"function"==typeof this.onStateChange&&this.onStateChange(item,option,oldVal,state),!0}return!1},CScrollList.prototype.Hidden=function(item,state){if(state=Boolean(state),item&&item.nodeName){var changed=this.SetState(item,"hidden",state);return changed&&state&&(item.focused&&(this.activeItem=null),this.SetState(item,"marked",!1),this.SetState(item,"focused",!1)),changed}return!1},CScrollList.prototype.Marked=function(item,state){var self=this;return state=Boolean(state),item&&item.nodeName&&!item.disabled&&!item.hidden?(this.multipleSelection===!1&&(this.states.marked||[]).forEach(function(marked){self.SetState(marked,"marked",!1)}),this.SetState(item,"marked",state)):!1},CScrollList.prototype.Disabled=function(item,state){if(state=Boolean(state),item&&item.nodeName){var changed=this.SetState(item,"disabled",state);return changed&&state&&(item.focused&&(this.activeItem=null),this.SetState(item,"marked",!1),this.SetState(item,"focused",!1)),changed}return!1},CScrollList.prototype.Focused=function(item,state,manageFocus){var changed=!1,prevent=!1;return state=state!==!1,void 0===manageFocus&&(manageFocus=this.manageFocus),item&&item.nodeName&&!item.disabled&&!item.hidden&&state!==item.focused&&(state?item!==this.activeItem&&("function"==typeof this.onFocus&&(prevent=this.onFocus(item,this.activeItem)),prevent||(changed=this.SetState(item,"focused",state),this.Focused(this.activeItem,!1,manageFocus),this.activeItem=item,manageFocus!==!1&&this.activeItem.focus())):(changed=this.SetState(item,"focused",state),manageFocus!==!1&&this.activeItem.blur(),this.activeItem=null)),changed},CScrollList.prototype.Activate=function(state,manageFocus){if(void 0===manageFocus&&(manageFocus=this.manageFocus),CBase.prototype.Activate.call(this,state),this.isActive){if(this.activeItem=this.activeItem||this.FindOne(),null===this.activeItem)return!1;this.SetState(this.activeItem,"focused",!0),this.SetPosition(this.activeItem),manageFocus!==!1&&this.activeItem.focus()}else this.activeItem&&this.activeItem.blur();return!0},CScrollList.prototype.Each=function(callback){Array.prototype.forEach.call(this.handleInner.children,callback)},CScrollList.prototype.Find=function(filter,limit,reverse){var match,found=[],items=this.handleInner.children,itlen=items.length,citem=null;filter=filter||this.defaultFilter;for(var i=0;itlen>i;i++){citem=items[reverse?itlen-i-1:i],match=!0;for(var attr in filter)filter.hasOwnProperty(attr)&&(match=match&&citem[attr]===filter[attr]);if(match&&(found.push(citem),limit&&found.length>=limit))break}return found},CScrollList.prototype.FindOne=function(filter,reverse){return this.Find(filter,1,reverse).pop()||null},CScrollList.prototype.Next=function(filter,reverse,nskip,toend){var match,suitable=this.activeItem,pointer=this.activeItem,skipcount=0;if(nskip=nskip||0,pointer)for(filter=filter||this.defaultFilter;pointer=reverse?pointer.previousSibling:pointer.nextSibling;){match=!0;for(var attr in filter)filter.hasOwnProperty(attr)&&(match=match&&pointer[attr]===filter[attr]);if(pointer.hidden||skipcount++,match&&(toend!==!1&&(suitable=pointer),0===nskip||nskip>0&&skipcount>=nskip))return pointer}return suitable},CScrollList.prototype.SetPosition=function(item,makeFocused,manageFocus){var index,page;makeFocused&&(void 0===manageFocus&&(manageFocus=this.manageFocus),this.Focused(item||this.FindOne(),!0,manageFocus)),null!==this.activeItem&&(index=this.activeItem.offsetTop/this.itemHeight,page=Math.floor(index/this.itemsPerPage),1===this.scrollMode?this.handleInner.scrollTop=(index-Math.floor((this.itemsPerPage-1)/2))*this.itemHeight:2===this.scrollMode&&(this.handleInner.scrollTop=this.itemsPerPage*this.itemHeight*page))},CScrollList.prototype.EventHandler=function(event,filter,manageFocus){var found=null;if(void 0===manageFocus&&(manageFocus=this.manageFocus),event.stopped!==!0){switch(event.code){case KEYS.PAGE_UP:case KEYS.PAGE_DOWN:found=this.Next(filter,event.code!==KEYS.PAGE_DOWN,this.itemsPerPage),this.handleInner.scrollTop=this.handleInner.scrollTop+(event.code===KEYS.PAGE_UP?-1:1)*this.itemsPerPage*this.itemHeight;break;case KEYS.LEFT:case KEYS.RIGHT:case KEYS.HOME:case KEYS.END:found=this.FindOne(filter,event.code===KEYS.RIGHT||event.code===KEYS.END);break;case KEYS.UP:case KEYS.DOWN:found=this.Next(filter,event.code===KEYS.UP),this.MoveNext(event.code===KEYS.UP?-1:1);break;case KEYS.OK:return this.activeItem&&this.activeItem.onclick(),void event.preventDefault();default:return}event.preventDefault(),this.Focused(found||this.FindOne(filter),!0,manageFocus)}},CScrollList.prototype.MoveNext=function(direction){null!==this.activeItem&&(1===this.scrollMode?this.handleInner.scrollTop=this.activeItem.offsetTop-Math.floor((this.itemsPerPage-1)/2)*this.itemHeight+direction*this.itemHeight:2===this.scrollMode&&(-1===direction?this.activeItem.offsetTop===this.handleInner.scrollTop&&(this.handleInner.scrollTop=this.handleInner.scrollTop-this.itemsPerPage*this.itemHeight):this.activeItem.offsetTop-this.handleInner.scrollTop===(this.itemsPerPage-1)*this.itemHeight&&(this.handleInner.scrollTop=this.handleInner.scrollTop+this.itemsPerPage*this.itemHeight)))},CScrollList.prototype.onFocus=null,CScrollList.prototype.onStateChange=null,Object.defineProperty(CScrollList.prototype,"itemsPerPage",{get:function(){return this._itemsPerPage?this._itemsPerPage:this._itemsPerPage=Math.round(this.handleInner.offsetHeight/this.handleInner.firstChild.offsetHeight)}}),Object.defineProperty(CScrollList.prototype,"itemHeight",{get:function(){return this.handleInner.firstChild?this.handleInner.firstChild.offsetHeight:0}}),CGroupMenu.prototype=Object.create(CBase.prototype),CGroupMenu.prototype.constructor=CGroupMenu,CGroupMenu.prototype.Init=function(handle){CBase.prototype.Init.call(this,handle),this.handle.onclick=function(event){event.stopPropagation()}},CGroupMenu.prototype.GetGroup=function(gid){for(var i=0,items=this.handleInner.children,length=items.length;length>i;i++)if(items[i].gid===gid)return items[i];return!1},CGroupMenu.prototype.AddGroup=function(gid,title,options){var self=this;if(gid&&!this.GetGroup(gid)){var aleft,aright,hlist=element("div",{className:"cslist-main"}),group=element("table",{gid:gid,slist:new CScrollList,options:options||{}},[element("tr",{className:"title"},[element("td",{className:"side",onclick:function(){self.Switch(self.Next({hidden:!1},!0),!0)}},aleft=element("p")),element("td",null,title),element("td",{className:"side",onclick:function(){self.Switch(self.Next({hidden:!1}),!0)}},aright=element("p"))]),element("tr",{className:"ilist"},element("td",{colSpan:3},hlist))]);return group.options.hidden=group.options.hidden?!0:!1,group.slist.Init(hlist),group.aleft=aleft,group.aright=aright,elchild(this.handleInner,group),group}return!1},CGroupMenu.prototype.Hidden=function(group,state){group&&group.nodeName&&(group.options.hidden=state)},CGroupMenu.prototype.AddItem=function(group,iid,body,options){return options=options||{},options.iid=iid,group.options.onclick&&!options.onclick&&(options.onclick=group.options.onclick),options.icon&&(body=element("div",{className:"short"},body),body.style.backgroundImage='url("'+options.icon+'")',body.style.backgroundPosition="right",body.style.backgroundRepeat="no-repeat"),group.slist.Add(body,options)},CGroupMenu.prototype.ApplyArrows=function(){this.activeGroup.aright.className=this.Next({hidden:!1})?"active":"",this.activeGroup.aleft.className=this.Next({hidden:!1},!0)?"active":""},CGroupMenu.prototype.Switch=function(group,activate){return group&&group.gid&&group.nodeName?(this.activeGroup&&(this.activeGroup.slist.Activate(!1),this.activeGroup.style.display="none"),this.activeGroup=group,this.activeGroup.style.display="table",activate&&(this.activeGroup.slist.Activate(),this.autoFocus&&Array.isArray(this.activeGroup.slist.states.marked)&&this.activeGroup.slist.Focused(this.activeGroup.slist.states.marked[0],!0)),this.ApplyArrows(),!0):!1},CGroupMenu.prototype.Activate=function(active,setFocus){var status=!1;return null!==this.activeGroup&&(status=this.activeGroup.slist.Activate(active,setFocus)),this.autoFocus&&Array.isArray(this.activeGroup.slist.states.marked)&&this.activeGroup.slist.Focused(this.activeGroup.slist.states.marked[0],!0),status},CGroupMenu.prototype.Next=function(filter,reverse){var match,pointer=this.activeGroup;if(pointer)for(;pointer=reverse?pointer.previousSibling:pointer.nextSibling;){match=!0;for(var attr in filter)filter.hasOwnProperty(attr)&&(match=match&&pointer.options[attr]===filter[attr]);if(match)return pointer}return null},CGroupMenu.prototype.EventHandler=function(event){switch(event.code){case KEYS.LEFT:this.Switch(this.Next({hidden:!1},!0),!0);break;case KEYS.RIGHT:this.Switch(this.Next({hidden:!1}),!0);break;default:this.activeGroup.slist.EventHandler(event)}};var CMODAL_IMG_PATH=configuration.newRemoteControl?PATH_IMG_SYSTEM+"buttons/new/":PATH_IMG_SYSTEM+"buttons/old/";CModal.prototype=Object.create(CPage.prototype),CModal.prototype.constructor=CModal,CModal.prototype.Init=function(body){CPage.prototype.Init.call(this,element("div",{className:this.baseClass},element("div",{className:"cmodal-cell"},body)));var owner=this.parent&&this.parent.handle&&this.parent.handle.nodeName?this.parent.handle:document.body;this.parent instanceof CModal&&this.parent.parent&&(owner=this.parent.parent.handle),owner.appendChild(this.handle)},CModal.prototype.Free=function(){this.handle&&this.handle.parentNode&&this.handle.parentNode.removeChild(this.handle),elclear(this.handle)},CModal.prototype.Show=function(visible,manageFocus){CBase.prototype.Show.call(this,visible,manageFocus!==!1),visible===!1?currCPage=this.parent:currCPage=this},CModal.prototype.FocusPrev=function(event,manageVK){if(this.focusList.length>0){--this.focusPos<0&&(this.focusPos=this.focusList.length-1);var el=this.focusList[this.focusPos];manageVK!==!1&&gSTB.HideVirtualKeyboard(),el.focus(),event&&"INPUT"===el.tagName&&"text"===el.type&&(event.preventDefault(),manageVK!==!1&&gSTB.ShowVirtualKeyboard())}},CModal.prototype.FocusNext=function(event,manageVK){if(this.focusList.length>0){++this.focusPos>=this.focusList.length&&(this.focusPos=0);var el=this.focusList[this.focusPos];manageVK!==!1&&gSTB.HideVirtualKeyboard(),el.focus(),event&&"INPUT"===el.tagName&&"text"===el.type&&(event.preventDefault(),manageVK!==!1&&gSTB.ShowVirtualKeyboard())}},CModalBox.prototype=Object.create(CModal.prototype),CModalBox.prototype.constructor=CModalBox,CModalBox.prototype.SetData=function(place,data){return elclear(place),data instanceof Node||Array.isArray(data)?elchild(place,data):place.innerHTML=data,data&&data.nodeName&&(data.style.display="block"),place.style.display=data?"block":"none",place},CModalBox.prototype.SetHeader=function(data){return this.SetData(this.header,data||"")},CModalBox.prototype.SetContent=function(data){return this.SetData(this.content,data||"")},CModalBox.prototype.SetFooter=function(data){return this.SetData(this.footer,data||"")},CModalBox.prototype.Init=function(){CModal.prototype.Init.call(this,element("div",{className:"cmodal-body"},[this.header,this.content,this.footer]))},CModalHint.prototype=Object.create(CModalBox.prototype),CModalHint.prototype.constructor=CModalHint,CModalAlert.prototype=Object.create(CModalBox.prototype),CModalAlert.prototype.constructor=CModalAlert,CModalConfirm.prototype=Object.create(CModalAlert.prototype),CModalConfirm.prototype.constructor=CModalConfirm,CButtonPanel.prototype=Object.create(CBase.prototype),CButtonPanel.prototype.constructor=CButtonPanel,CButtonPanel.prototype.Init=function(path,handle){this.path=path,handle&&handle.nodeName?CBase.prototype.Init.call(this,handle):CBase.prototype.Init.call(this,element("div",{className:"cbpanel-main"}))},CButtonPanel.prototype.Add=function(code,icon,text,callback,hidden){var html=null,self=this,func=function(){self.isActive&&"function"==typeof callback&&(gSTB.HideVirtualKeyboard(),callback(code))};text&&(html=element("div",{className:"cbpanel-text",onclick:func}),html.innerHTML=text);var item=element("div",{className:"cbpanel-item",data:{code:code,onclick:func}},[element("img",{className:"cbpanel-icon",onclick:func,src:this.path+"/"+icon}),html]);return item.$name=html,this.Hidden(item,hidden||!1),elchild(this.handleInner,item),item},CButtonPanel.prototype.Hidden=function(item,state){item&&item.nodeName&&item.data.hidden!==state&&(item.data.hidden=state,item.style.display=state?"none":"table-cell")},CButtonPanel.prototype.SetName=function(item,name){var html=null;item&&item.nodeName&&name&&(item.$name?this.Rename(item,name):(html=element("div",{className:"cbpanel-text",onclick:item.data.onclick}),html.innerHTML=name,item.$name=html,item.appendChild(html)))},CButtonPanel.prototype.Rename=function(item,name){item&&item.nodeName&&(item.$name.innerHTML=name)},CButtonPanel.prototype.Activate=function(active){this.isActive=active!==!1},CButtonPanel.prototype.EventHandler=function(event){if(event.stopped!==!0&&this.isActive)for(var data,i=0,items=this.handleInner.children,length=items.length;length>i;i++)if(data=items[i].data,!data.hidden&&data.code===event.code&&"function"==typeof data.onclick)return void(data.onclick()&&event.preventDefault())},CButtonPanel.prototype.onClick=function(){return!1},CBreadCrumb.prototype=Object.create(CBase.prototype),CBreadCrumb.prototype.constructor=CBreadCrumb,CBreadCrumb.prototype.Init=function(path,handle,leftItems,rightItems){this.path=path,CBase.prototype.Init.call(this,handle),this.dom={},elchild(this.handleInner,[this.dom.list=element("div",{className:"cbcrumb-list"}),this.dom.name=element("div",{className:"cbcrumb-name"})]),this.leftItems=leftItems||this.leftItems,this.rightItems=rightItems||this.rightItems},CBreadCrumb.prototype.SetName=function(text){elclear(this.dom.name),elchild(this.dom.name,element("div",{innerHTML:text,className:"cbcrumb-name-text"})),this.DrawName()},CBreadCrumb.prototype.DrawName=function(){this.dom.name.style.display=1===this.dom.list.children.length?"table-cell":"none"},CBreadCrumb.prototype.Push=function(path,icon,text,iid){var last=this.dom.list.lastChild;last&&(last.className="cbcrumb-item");var item=element("div",{className:"cbcrumb-item active",onclick:null,path:path},[icon?element("img",{className:"cbcrumb-icon",onclick:null,src:this.path+icon}):null,text?element("div",{className:"cbcrumb-text",onclick:null},text):null]);return iid&&(item.iid=iid),this.dom.list.children.length===this.leftItems&&elchild(this.dom.list,element("div",{className:"cbcrumb-item divider"},". . .")),elchild(this.dom.list,item),this.dom.list.children.length>this.leftItems+this.rightItems+1&&(this.dom.list.children[this.leftItems].style.display="table-cell",this.dom.list.children[this.dom.list.children.length-this.rightItems-1].style.display="none"),this.DrawName(),item},CBreadCrumb.prototype.Pop=function(){var item=this.dom.list.lastChild;return item&&(this.dom.list.removeChild(item),this.dom.list.children.length===this.leftItems+1?this.dom.list.removeChild(this.dom.list.lastChild):this.dom.list.children.length>this.leftItems+this.rightItems&&(this.dom.list.children[this.dom.list.children.length-this.rightItems].style.display="table-cell"),this.dom.list.children.length===this.leftItems+this.rightItems+1&&(this.dom.list.children[this.leftItems].style.display="none"),this.dom.list.lastChild&&(this.dom.list.lastChild.className="cbcrumb-item active"),this.DrawName()),item},CBreadCrumb.prototype.Tip=function(){return this.dom.list.lastChild},CBreadCrumb.prototype.Reset=function(){elclear(this.dom.list),this.DrawName()},CBreadCrumb.prototype.onClick=function(){return!1},CSearchBar.prototype=Object.create(CBase.prototype),CSearchBar.prototype.constructor=CSearchBar,CSearchBar.prototype.Init=function(path,handle,hint){this.path=path,this.hint=hint||"";var self=this,func=function(){self.Activate(!self.isActive),event.stopPropagation()};CBase.prototype.Init.call(this,handle),this.items.hint=element("input",{type:"text",className:"hint maxw",value:this.hint}),this.items.text=element("input",{type:"text",className:"text maxw",oninput:function(){self.onChange&&self.onChange(this.value)},onkeydown:function(event){self.EventHandler(event)}}),this.items.span=element("div",{className:"csbar-item span"}),this.items.icon=element("div",{className:"csbar-item icon",onclick:func},element("img",{className:"",src:this.path+this.icoSearch})),this.items.button=element("div",{className:"csbar-item icon",onclick:func},element("img",{className:"",src:this.path+"f2.png"})),this.items.input=element("div",{className:"csbar-item stext"},[this.items.hint,this.items.text]),elchild(this.handleInner,[this.items.input,this.items.span,this.items.icon,this.items.button])},CSearchBar.prototype.ShowInput=function(visible,manageFocus){visible=visible!==!1,visible||(this.items.text.blur(),gSTB.HideVirtualKeyboard(),manageFocus!==!1&&this.prevFocus&&this.prevFocus.focus()),this.items.input.style.display=visible?"table-cell":"none",this.items.span.style.display=visible?"none":"table-cell",visible&&(this.prevFocus=document.activeElement,this.items.text.focus(),gSTB.ShowVirtualKeyboard())},CSearchBar.prototype.Reset=function(){this.Activate(!1),this.items.text.value=this.items.hint.value=this.hint=this.filter="",this.items.icon.lastChild.src=this.path+"/"+this.icoSearch},CSearchBar.prototype.onSearch=null,CSearchBar.prototype.onHint=null,CSearchBar.prototype.onChange=null,CSearchBar.prototype.SetHint=function(hint){hint=hint||this.items.text.value||this.hint,hint&&(this.items.hint.value=hint)},CSearchBar.prototype.SetValue=function(text){this.filter=text,this.items.text.value=this.filter},CSearchBar.prototype.EventHandler=function(event){switch(event.code){case KEYS.LEFT:case KEYS.RIGHT:case KEYS.UP:case KEYS.DOWN:return;case KEYS.EXIT:this.Activate(!1),event.stopPropagation();break;case KEYS.F2:this.Activate(!this.isActive),event.stopPropagation();break;case KEYS.OK:this.Activate(!1),"function"==typeof this.onSearch&&this.onSearch(this.items.text.value),this.items.icon.firstChild.src=this.items.text.value?this.path+"/"+this.icoFilter:this.path+"/"+this.icoSearch,event.stopPropagation();break;default:if(this.items.hint.value=""===this.items.text.value?this.hint:"","function"==typeof this.onHint){this.items.hint.value===this.hint&&this.SetHint(" "),this.timer&&clearTimeout(this.timer);var self=this;this.timer=setTimeout(function(){self.onHint.call(self,self.items.text.value)},300)}}},CSearchBar.prototype.Activate=function(active,manageFocus){active||this.ShowInput(!1,manageFocus),CBase.prototype.Activate.call(this,active),active&&this.ShowInput(!0,manageFocus)};var globalBuffer=function(){var data=[],mode=1,place={};return{MODE_COPY:1,MODE_CUT:2,onPaste:null,add:function(item){return-1===data.indexOf(item)?(data.push(item),!0):!1},paste:function(func){var self=this;data.forEach(function(item){func(item)&&"function"==typeof self.onPaste&&self.onPaste(item)}),this.clear()},mode:function(newMode){return void 0!==newMode&&(mode=newMode),mode},place:function(newPlace){return void 0!==newPlace&&(place=newPlace),place},size:function(){return data.length},remove:function(item){if(void 0!==item){var index=data.indexOf(item);if(-1!==index)return 1===data.splice(index,1).length}return!1},clear:function(){data=[],place={},this.onPaste=null}}}();CCheckBox.prototype=Object.create(CBase.prototype),CCheckBox.prototype.constructor=CCheckBox,CCheckBox.DefaultAttributes={checkbox:{type:"checkbox",className:"ccheck-box-input"},label:{className:"ccheck-box-label"},wrapper:{className:"ccheck-box-wrapper",tabIndex:"1"}},CCheckBox.prototype.onInit=function(){void 0!==this.parameters.element&&"INPUT"===this.parameters.element.nodeName&&"checkbox"===this.parameters.element.type&&(this.parameters.element.parentNode.removeChild(this.parameters.element),this.checkbox=this.parameters.element,elattr(this.checkbox,extend(CCheckBox.DefaultAttributes.checkbox,this.parameters.attributes.checkbox,!0))),void 0===this.checkbox&&(this.checkbox=this.generateCheckbox()),this.wrapper=this.generateWrapper(this.checkbox),this.wrapper.className+=" "+this.style,this.parameters.checked===!0&&this.Check(!0,!0),elchild(this.handleInner,this.wrapper)},CCheckBox.prototype.generateCheckbox=function(){var self=this,attrs=extend(CCheckBox.DefaultAttributes.checkbox,this.parameters.attributes.checkbox,!0);return void 0===attrs.id&&(attrs.id=CCheckBox.GenerateId()),attrs.onchange=function(){self.checked=this.checked,self.trigger("onChange",arguments)},attrs.onclick=function(){self.Check(!self.IsChecked())},element("input",attrs)},CCheckBox.prototype.generateWrapper=function(checkbox,label){var self=this;if(void 0===this.checkbox)throw"Checkbox must be created before label";return this.label=element("label",extend({htmlFor:this.checkbox.id},CCheckBox.DefaultAttributes.label)),this.label.onclick=function(){self.Check(!self.IsChecked())},element("div",CCheckBox.DefaultAttributes.wrapper,[checkbox,label||this.label])},CCheckBox.GenerateId=function(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)},CCheckBox.prototype.Check=function(checked,block_event){this.checked=this.checkbox.checked=checked===!0,block_event!==!0&&this.trigger("onChange")},CCheckBox.prototype.IsChecked=function(){return this.checkbox.checked===!0},CCheckBox.prototype.EventHandler=function(event){switch(event.code){case KEYS.LEFT:case KEYS.RIGHT:this.Check(event.code===KEYS.LEFT),event.stopped=!0}},CCheckBox.prototype.focus=function(){this.wrapper.focus()},Events.inject(CCheckBox),CSimpleSelect.prototype=Object.create(CBase.prototype),CSimpleSelect.prototype.constructor=CSimpleSelect,CSimpleSelect.prototype.GenerateHandle=function(){var wrapper,content_wrapper,self=this;return void 0!==this.parameters.content&&"DIV"===this.parameters.content.tagName?(this.content=this.parameters.content,this.content.parentNode.removeChild(this.content),void 0!==this.content.className&&(this.attributes.content.className+=" "+this.content.className),this.content=element("div",this.attributes.content,this.content||"")):(void 0!==this.parameters.content&&"DIV"!==this.parameters.content.tagName&&(this.content=this.parameters.content),this.content=element("div",this.attributes.content,this.content||"")),content_wrapper=element("div",this.attributes.content_wrapper,[this.content,this.hint=element("div",this.attributes.hint)]),this.parameters.leftArrow?(this.leftArrow=this.parameters.leftArrow,this.leftArrow.parentNode.removeChild(this.leftArrow),this.leftArrow=element("div",this.attributes.left_arrow,this.leftArrow)):this.leftArrow=element("div",this.attributes.left_arrow,this.leftArrow||element("p")),this.parameters.rightArrow?(this.rightArrow=this.parameters.rightArrow,this.rightArrow.parentNode.removeChild(this.rightArrow),this.rightArrow=element("div",this.attributes.right_arrow,this.rightArrow)):this.rightArrow=element("div",this.attributes.right_arrow,this.rightArrow||element("p")),wrapper=element("div",this.attributes.wrapper,element("div",{className:"content-wrapper",onfocus:function(){}},[this.leftArrow,content_wrapper,this.rightArrow])),wrapper.className+=" "+this.style,void 0!==this.parameters.width&&(wrapper.style.width=this.parameters.width),this.leftArrow.onclick=function(event){self.disabled||(self.Previous(),event.stopPropagation(),event.preventDefault())},this.rightArrow.onclick=function(event){self.disabled||(self.Next(),event.stopPropagation(),event.preventDefault())},wrapper},CSimpleSelect.prototype.onInit=function(){var self=this;elchild(this.parentNode,this.handle),this.handle.component=this,this.handle.onblur=function(){self.trigger("onBlur")},this.handle.onfocus=function(){self.trigger("onFocus")}},CSimpleSelect.prototype.EventHandler=function(event){if(eventPrepare(event,!0,"CSimpleSelect"),this.disabled!==!0)switch(event.stopped=!0,event.code){case KEYS.LEFT:this.Previous();break;case KEYS.RIGHT:this.Next();break;default:event.stopped=!1}},CSimpleSelect.prototype.SetContent=function(content,placeholder){void 0===content&&placeholder&&(content=placeholder,this.content.classList.add("placeholder")),this.content.innerHTML="",this.content.innerHTML=content},CSimpleSelect.prototype.DisableElement=function(element,disable){disable===!0?-1===element.className.indexOf("disabled")&&(element.className+=" disabled"):element.className=element.className.replace(" disabled","")},CSimpleSelect.prototype.SetHint=function(hint){this.hint.innerHTML=hint},CSimpleSelect.prototype.Next=function(){},CSimpleSelect.prototype.Previous=function(){this.autocomplete=""},CSimpleSelect.prototype.focus=function(){this.handle.focus()},CSimpleSelect.prototype.blur=function(){this.handle.blur()},CSimpleSelect.prototype.IsFocused=function(){return document.activeElement===this.handle},CSimpleSelect.prototype.Disable=function(disable){this.DisableElement(this.handle,this.disabled=disable===!0)},Events.inject(CSimpleSelect),CSelectBox.prototype=Object.create(CSimpleSelect.prototype),CSelectBox.prototype.constructor=CSelectBox,CSelectDropdown.prototype=Object.create(CScrollList.prototype),CSelectDropdown.prototype.constructor=CSelectDropdown,CSelectDropdown.parameters=["scrollMode","select","container"],CSelectDropdown.prototype.Refresh=function(){var el,i,self=this,data=this.select.GetData();for(this.Clear(),i=0;i<data.length,el=data[i];i++)"object"==typeof el&&(el=el[this.select.GetNameField()]),this.Add(element("div",extend(this.attributes.element,{innerHTML:el})),{onclick:function(){self.select.SetIndex(self.activeItem.index),self.Marked(self.activeItem,!0),self.Show(!1,self.manageFocus)},index:i})},CSelectDropdown.prototype.onShow=function(){this.UpdateGeometry();var item=this.handleInner.children[this.select.GetIndex()];this.SetPosition(item,!0,!1),this.Focused(item,!0),this.Marked(item,!0)},CSelectDropdown.prototype.UpdateGeometry=function(){var containerRect,inputRect=this.base.getBoundingClientRect(),top=this.base.offsetTop+inputRect.height,height=WINDOW_HEIGHT;void 0!==this.container&&(containerRect=this.container.getBoundingClientRect(),height=containerRect.top+containerRect.height),inputRect.top+inputRect.height+this.itemHeight*this.itemsPerPage>height&&(top=this.base.offsetTop-this.itemHeight*this.itemsPerPage),1===this.scrollMode&&(top-=this.itemHeight*Math.abs(Math.floor(this.itemsPerPage/2*-1))),this.handle.style.top=top+"px",this.handle.style.left=this.base.offsetLeft+"px",this.handle.style.width=inputRect.width-2*parseInt(document.defaultView.getComputedStyle(this.handle,"")["border-left-width"])+"px"},Events.inject(CSelectDropdown),CIntervalBox.prototype=Object.create(CSimpleSelect.prototype),CIntervalBox.prototype.constructor=CIntervalBox;var CINPUT_IMG_PATH=PATH_IMG_PUBLIC;CInput.prototype=Object.create(CBase.prototype),CInput.prototype.constructor=CInput,CInput.prototype.GenerateHandle=function(){var i,icon,attrs,changed,self=this;if(this.row=element("tr"),void 0!==this.parameters.hint&&(this.DefaultHint=this.attributes.hint.value=this.parameters.hint,this.hint=element("input",extend(this.attributes.input,this.attributes.hint,!1))),void 0===this.parameters.input?(void 0!==this.parameters.value&&(this.attributes.input.value=this.parameters.value,this.SetDefault(this.parameters.value)),elchild(this.row,element("td",this.attributes["text-wrapper"],[this.input=element("input",this.attributes.input),this.hint||""]))):(this.input=this.parameters.input,this.input.parentNode.removeChild(this.input),this.input.className+=this.attributes.input.className,elchild(this.row,element("td",{},element("div",this.attributes["text-wrapper"],[this.input,this.hint||""]))),""!==this.input.value&&(this.ShowHint(!1),this.SetDefault(this.input.value))),this.input.oninput=function(e){changed=!1,self.trigger("onChange",e),""!==self.GetValue()?self.ShowHint(!1):(self.SetHint(self.DefaultHint),self.ShowHint(!0))},this.input.onblur=function(){""!==self.GetValue()?self.ShowHint(changed):(self.SetHint(self.DefaultHint),self.ShowHint(!0))},void 0!==this.parameters.icons)for(i=0;i<this.parameters.icons.length;i++)icon=this.parameters.icons[i],attrs=extend({},this.attributes.icon),attrs.className+=" "+(icon.style||""),this.AddIcon(icon,attrs);return element("table",this.attributes.wrapper,this.row)},CInput.prototype.SetAutocomplete=function(autocomplete){this.autocomplete=autocomplete},CInput.prototype.onInit=function(){},CInput.prototype.ShowIcon=function(name,show){void 0!==this.icons[name]&&(this.icons[name].parentNode.style.display=show===!0?"table-cell":"none")},CInput.prototype.ApplyHint=function(){this.SetValue(this.GetHint())},CInput.prototype.AddIcon=function(icon,attrs){var self=this,iconFile=null,attributes=extend(icon.attributes,{}),remoteControlButtonsImagesPath=configuration.newRemoteControl?PATH_IMG_SYSTEM+"buttons/new/":PATH_IMG_SYSTEM+"buttons/old/";iconFile=void 0!==icon.src?icon.src:icon.name?icon.name+".png":null,"f4.png"===iconFile?iconFile&&(attributes.src=(this.parameters.icons_path||remoteControlButtonsImagesPath)+iconFile):iconFile&&(attributes.src=(this.parameters.icons_path||CINPUT_IMG_PATH)+iconFile),element("td",attrs||this.attributes.icon,this.icons[icon.name]=element("img",attributes)),"left"===icon.type?this.row.insertBefore(this.icons[icon.name].parentNode,this.row.firstChild):this.row.appendChild(this.icons[icon.name].parentNode),"function"==typeof icon.click&&(this.icons[icon.name].onclick=function(event){icon.click.call(self,event)})},CInput.prototype.RemoveIcon=function(icon_name){void 0!==this.icons[icon_name]&&this.row.removeChild(this.icons[icon_name].parentNode)},CInput.prototype.SetValue=function(value,siltent){this.input.value=value,this.ShowHint(""===value),siltent!==!0&&(this.trigger("onChange"),this.input.oninput())},CInput.prototype.GetValue=function(){return this.input.value},CInput.prototype.SetHint=function(hint){return void 0!==this.hint?(this.hint.value=hint,this.hint.value):void 0},CInput.prototype.GetHint=function(){return void 0!==this.hint?this.hint.value:void 0},CInput.prototype.ShowHint=function(show){void 0!==this.hint&&(this.hint.style.display=show===!0?"block":"none")},CInput.prototype.Fold=function(fold,manage_focus,stop_event){fold===!0?(-1===this.handle.className.indexOf("folded")&&(this.handle.className+=" "+this.FoldedClass,
stop_event!==!0&&this.trigger("onFold"),manage_focus===!0&&this.blur()),gSTB.HideVirtualKeyboard()):(this.handle.className=this.handle.className.replace(this.FoldedClass,""),stop_event!==!0&&this.trigger("onUnfold"),manage_focus===!0&&(this.focus(),gSTB.ShowVirtualKeyboard()))},CInput.prototype.Reset=function(){this.Fold(this.parameters.folded===!0,!0),this.SetValue(this.GetDefault(),!0)},CInput.prototype.focus=function(){this.input.focus()},CInput.prototype.blur=function(){this.input.blur()},CInput.prototype.select=function(){this.input.select()},CInput.prototype.IsFolded=function(){return-1!==this.handle.className.indexOf(this.FoldedClass)},CInput.prototype.IsFocused=function(){return this.input===document.activeElement},CInput.prototype.EventHandler=function(){},Events.inject(CInput),CFilterInput.prototype=Object.create(CInput.prototype),CFilterInput.prototype.constructor=CFilterInput,CFilterInput.prototype.EventHandler=function(event){eventPrepare(event,!0,"CFilterInput");var event_res=!1;if(this.trigger("onEvent",event)[0]===!0)return!0;switch(event.code){case KEYS.F4:this.Fold(!this.IsFolded(),!0),event_res=this.trigger("onKey")[0];break;case KEYS.EXIT:if(!this.IsFolded())return this.Fold(!0,!0),this.trigger("onExit"),!0;break;case KEYS.OK:this.IsFolded()||(event_res=this.trigger("onEnter")[0],event.preventDefault());break;case KEYS.CHANNEL_NEXT:case KEYS.CHANNEL_PREV:event.preventDefault()}return this.IsFolded()!==!0||event_res===!0?!0:void 0},configuration=function(configuration){var menu={mediabrowser:{ico:"/icons/mb.png",name:"mediaBrowser",script:function(){MediaBrowser.Reset(),MediaBrowser.Show(!0)},help:"menu/home_media",stat_name:"mediabrowser"},tvchannels:{ico:"/icons/tv.png",name:"TVChanels",help:"menu/iptv_channels",script:function(){IPTVChannels.Show(!0),IPTVChannels.Reset()},stat_name:"tvchannels"},wildweb:{ico:"/icons/web.png",name:"wideWeb",help:"menu/internet_browser",script:function(){setTimeout(function(){openWindow(WINDOWS.BROWSER,PATH_ROOT+"public/app/ibman/index.html?mode=2")},0)},stat_name:"wildweb"},weatherSettings:{ico:"/icons/weather.png",name:"weatherSettings",help:"menu/weather",script:function(){WeatherPage.Show()},stat_name:"weather"},dlman:{ico:"/icons/dm.png",name:"dlman",help:"menu/download_manager",script:function(){openWindow(WINDOWS.DOWNLOAD_MANAGER,PATH_ROOT+"public/app/dlman/index.html")},stat_name:"downloadmanager"},pvr:{ico:"/icons/pvr.png",name:"pvr",help:"menu/pvr_manager",script:function(){openWindow(WINDOWS.PVR,PATH_ROOT+"public/app/pvr/index.html")},stat_name:"recordmanager"},wideWebBookmarks:{ico:"/icons/favs.png",name:"wideWebBookmarks",help:"menu/internet_bookmarks",script:function(){setTimeout(function(){openWindow(WINDOWS.BROWSER,PATH_ROOT+"public/app/ibman/index.html?mode=1")},0)},stat_name:"wildweb"},settings:{ico:"/icons/settings.png",name:"settings",help:"menu/settings",script:function(){SettingsPage.Show()},stat_name:"settings"},manual:{ico:"/icons/manual.png",name:"Manual",help:"root",script:function(){openWindowHelp("root")},stat_name:"manual"},gameLines:{ico:"/icons/lines.png",name:"gameLines",help:"menu/lines",url:"public/app/games/lines/index.html",stat_name:"lines"},gameSudoku:{ico:"/icons/sudoku.png",name:"gameSudoku",help:"menu/sudoku",url:"public/app/games/sudoku/index.html",stat_name:"sudoku"},gameMemory:{ico:"/icons/memory.png",name:"gameMemory",help:"menu/memory",url:"public/app/games/memory/index.html",stat_name:"memory"},youtube:{ico:"/icons/youtube.png",name:"youtube",help:"menu/internet_services/youtube",url:"http://youtube.infomir.com.ua/",stat_name:"youtube"},picasa:{ico:"/icons/picasa.png",name:"picasa",help:"menu/internet_services/picasa",url:"http://picasa.infomir.com.ua/",stat_name:"picasa"},apps:{ico:"/icons/apps.png",name:"applications",help:"menu/applications",url:"http://apps.infomir.com.ua/?language="+getCurrentLanguage(),stat_name:"apps"},DVBChanels:{ico:"/icons/dvb.png",name:"DVBChanels",script:function(){DVBChannels.Show(!0),DVBChannels.Reset()},stat_name:"tvchannels"},masterSettings:{ico:"/icons/master.png",name:"masterSettings",script:function(){var currentPage=currCPage;loadMasterSettings(function(){MasterSettings.origin=currentPage})},stat_name:"mastersettings"}},config=extend({screensaversPath:PATH_SYSTEM+"pages/screensaver",url:{ping:["http://echo-de01.calyptra-soft.net/","http://echo-de02.calyptra-soft.net/","http://echo-de03.calyptra-soft.net/","http://echo-de04.calyptra-soft.net/","http://echo-de05.calyptra-soft.net/","http://echo-de06.calyptra-soft.net/","http://echo-nl01.calyptra-soft.net/","http://echo-nl02.calyptra-soft.net/","http://echo-nl03.calyptra-soft.net/","http://echo-nl04.calyptra-soft.net/","http://echo-nl05.calyptra-soft.net/","http://echo-nl06.calyptra-soft.net/"].shuffle(),pingAttempts:3,updateList:"http://dl.dropbox.com/u/16515769/update_list.txt",operatorsTVList:"http://playlist.iptv.infomir.com.ua/api/",speedTest:{baseURL:".leaseweb.net/speedtest/10mb.bin",dataCenters:[{name:"San Jose",lat:37.33939,"long":-121.89496,code:"us"},{name:"Washington D.C",lat:38.89511,"long":-77.03637,code:"us"},{name:"Amsterdam",lat:52.37403,"long":4.88969,code:"nl"},{name:"Frankfurt",lat:50.11667,"long":8.68333,code:"de"}]}},frontPanelIndicator:0,desktop:{x:5,y:3,count:0,number:0},mayTimeShift:!0,mayDVB:!1,volume:{def:100,mute:0,step:5,timer:null,hideTimeOut:3e3},defaultAudioLang:null,defaultSubtitleLang:null,fileSystemTypes:["<unknown>","fat16","fat32","ext2","ext3","ntfs"],registersTypes:["mpg","mpeg","mkv","avi","3gp","ts","tspinf","m4a","mp3","mp4","ac3","mov","vob","wav","ape","mts","m2t","m2v","ogg","oga","divx","aiff","m2ts","wv","m2p","tp","flv","tta","mod","tod","asf","wma","wmv","flac","ape","cue","m3u","m3u8","jpg","jpeg","png","bmp","tif","tiff","iso","aac","txt","srt","sub","ass","m4v","tts"],menu:[menu.mediabrowser,menu.tvchannels,menu.wideWebBookmarks,menu.youtube,menu.picasa,menu.weatherSettings,menu.gameLines,menu.gameSudoku,menu.gameMemory,menu.settings,menu.pvr,menu.dlman,menu.manual],masterSettingOnStart:!1,setting:{settingsList:["playback","interface","update","timeShift","speedTest","settings"]},startPage:null},configuration,!1),models={MAG250:{url:{updateList:"http://mag.infomir.com.ua/250/r2/update_list.txt",speedTest:""}},MAG245:{url:{updateList:"http://mag.infomir.com.ua/245/r2/update_list.txt",speedTest:""}},MAG255:{url:{updateList:"http://mag.infomir.com.ua/255/r2/update_list.txt",speedTest:""}},IP_STB_HD:{},AuraHD0:{menu:[menu.apps,menu.mediabrowser,menu.tvchannels,menu.wildweb,menu.weatherSettings,menu.dlman,menu.pvr,menu.wideWebBookmarks,menu.settings,menu.manual,menu.gameLines,menu.gameSudoku,menu.gameMemory],masterSettingOnStart:!0,url:{updateList:"http://aurahd.infomir.com.ua/update_list.txt"},blockAdditionalUpdate:!0,setting:{settingsList:["playback","interface","update","timeShift","speedTest","settings","masterSettings"]},logoImagePath:PATH_IMG_PUBLIC+"menu/aura_logo.png"},MAG270:{menu:[menu.mediabrowser,menu.tvchannels,menu.wildweb,menu.weatherSettings,menu.dlman,menu.pvr,menu.wideWebBookmarks,menu.settings,menu.manual,menu.gameLines,menu.DVBChanels,menu.gameSudoku,menu.gameMemory],mayDVB:!0,url:{updateList:"http://mag.infomir.com.ua/270/r2/update_list.txt",speedTest:""},setting:{settingsList:["playback","interface","update","timeShift","speedTest","DVB","settings"]}}};return models.AuraHD1=extend(models.AuraHD0,{},!1),models.AuraHD9=extend(models.AuraHD0,{logoImagePath:PATH_IMG_PUBLIC+"menu/aura_logo_9.png"},!1),models.AuraHD2=extend(models.AuraHD0,{menu:[menu.apps,menu.mediabrowser,menu.tvchannels,menu.wildweb,menu.weatherSettings,menu.dlman,menu.pvr,menu.wideWebBookmarks,menu.settings,menu.manual,menu.gameLines,menu.gameSudoku,menu.gameMemory,menu.masterSettings],url:{updateList:"http://aurahd.infomir.com.ua/hd2/update_list.txt"},setting:{settingsList:["playback","interface","update","timeShift","speedTest","settings"]},logoImagePath:PATH_IMG_PUBLIC+"menu/aura_plus_logo.png"},!1),models.AuraHD8=extend(models.AuraHD9,{url:{updateList:"http://aurahd.infomir.com.ua/hd8/update_list.txt"},logoImagePath:PATH_IMG_PUBLIC+"menu/aura_logo_8.png"},!1),models.MAG254=extend(models.MAG255,{url:{updateList:"http://mag.infomir.com.ua/254/r2/update_list.txt"}},!1),models.MAG322=extend(models.MAG254,{UPnP2:!0},!1),models.MAG330=extend(models.MAG254,{UPnP2:!0},!1),models.MAG350=extend(models.AuraHD0,{UPnP2:!0},!1),models.MAG356=extend(models.MAG254,{UPnP2:!0},!1),models.WR320=extend(models.MAG254,{url:{updateList:"http://support.wrtech.ru/update/WR-320/update_list.txt"}},!1),models.MAG275=extend(models.MAG270,{url:{updateList:"http://mag.infomir.com.ua/275/r2/update_list.txt"}},!1),models.MAG245D=extend(models.MAG245,{url:{updateList:"http://mag.infomir.com.ua/245d/r2/update_list.txt"}},!1),models.MAG356=extend(models.MAG270,{url:{updateList:"http://mag.infomir.com.ua/356/r2/update_list.txt"}},!1),config=extend(config,models[gSTB.GetDeviceModelExt()]),function(){var i,deskCount,index,menu=[];if(config.desktop.count=config.desktop.x*config.desktop.y,!Array.isArray(config.menu[0])){for(deskCount=Math.ceil(config.menu.length/config.desktop.count),i=0;deskCount>i;i++)menu[i]=config.menu.slice(i*config.desktop.count,(i+1)*config.desktop.count);config.menu=menu}config.url.speedTest||(index=config.setting.settingsList.indexOf("speedTest"),-1!==index&&config.setting.settingsList.splice(index,1)),config.mayDVB&&(config.inputsAmount=dvbManager.GetInputsAmount())}(),config}(configuration);var MEDIA_TYPE_NONE=0,MEDIA_TYPE_STORAGE_SATA=1,MEDIA_TYPE_STORAGE_USB=2,MEDIA_TYPE_STORAGE_SD=3,MEDIA_TYPE_ROOT_DVB=4,MEDIA_TYPE_ROOT_IB=5,MEDIA_TYPE_ROOT_MB=6,MEDIA_TYPE_ROOT_TV=7,MEDIA_TYPE_ROOT_HELP=8,MEDIA_TYPE_ROOT_PVR=9,MEDIA_TYPE_SAMBA_ROOT=10,MEDIA_TYPE_SAMBA_GROUP=11,MEDIA_TYPE_SAMBA_HOST=12,MEDIA_TYPE_SAMBA_SHARE=13,MEDIA_TYPE_ROOT_EPG=14,MEDIA_TYPE_UPNP=20,MEDIA_TYPE_NFS_ROOT=30,MEDIA_TYPE_NFS_HOST=31,MEDIA_TYPE_NFS_SHARE=32,MEDIA_TYPE_FAVORITES=40,MEDIA_TYPE_RECORDS_ROOT=50,MEDIA_TYPE_RECORDS_CHAN=51,MEDIA_TYPE_RECORDS_DATE=52,MEDIA_TYPE_RECORDS_ITEM=53,MEDIA_TYPE_BACK=60,MEDIA_TYPE_FOLDER=61,MEDIA_TYPE_VIDEO=62,MEDIA_TYPE_AUDIO=63,MEDIA_TYPE_IMAGE=64,MEDIA_TYPE_TEXT=65,MEDIA_TYPE_ISO=66,MEDIA_TYPE_PLAYLIST=67,MEDIA_TYPE_CUE=68,MEDIA_TYPE_CUE_ITEM=69,MEDIA_TYPE_URL=70,MEDIA_TYPE_GROUP=80,MEDIA_TYPE_STREAM=81,MEDIA_TYPE_STREAM_TS=82,MEDIA_TYPE_DVB=83,MEDIA_TYPE_PVR_SHED=91,MEDIA_TYPE_PVR_REC=92,MEDIA_TYPE_PVR_ERR=93,MEDIA_TYPE_PVR_DONE=94,MEDIA_TYPE_UPNP_ROOT=95,MEDIA_TYPE_UPNP_HOST=96,MEDIA_TYPE_UPNP_FOLDER=97,MEDIA_TYPE_HELP_FOLDER=201,MEDIA_TYPE_HELP_ARTICLE=202,MEDIA_TYPE_HELP_BACK=203,MEDIA_ACTION_OPEN=1,MEDIA_ACTION_OPEN_SELECTED=2,MEDIA_ACTION_ITEM_MOUNT=3,MEDIA_ACTION_ITEM_UNMOUNT=4,MEDIA_ACTION_MOUNT_EDIT=5,MEDIA_ACTION_SELECT_ONE=6,MEDIA_ACTION_SELECT_ALL=7,MEDIA_ACTION_DESELECT=8,MEDIA_ACTION_INVERT=9,MEDIA_ACTION_CUT=10,MEDIA_ACTION_COPY=11,MEDIA_ACTION_PASTE=12,MEDIA_ACTION_DELETE=13,MEDIA_ACTION_EDIT=14,MEDIA_ACTION_SAVE=15,MEDIA_ACTION_CREATE_GROUP=16,MEDIA_ACTION_SORT_NONE=17,MEDIA_ACTION_SORT_TYPE=18,MEDIA_ACTION_SORT_EXT=19,MEDIA_ACTION_SORT_NAME=20,MEDIA_ACTION_SORT_SIZE=21,MEDIA_ACTION_SORT_TIME=22,MEDIA_ACTION_NEW_GROUP=23,MEDIA_ACTION_TOOLS_MOUNT=24,MEDIA_ACTION_TOOLS_UNMOUNT=25,MEDIA_ACTION_TOOLS_FORMAT=26,MEDIA_ACTION_TSEND_CICLICK=27,MEDIA_ACTION_TSEND_STOP=28,MEDIA_ACTION_TS_ON=29,MEDIA_ACTION_TS_OFF=30,MEDIA_ACTION_SUBTITLE_MOUNT=31,MEDIA_ACTION_CREATE_RECORD=32,MEDIA_ACTION_ADD_ITEM=33,MEDIA_ACTION_ADD_OPER_TVLIST=34,MEDIA_ACTION_ADD_TVLIST=35,MEDIA_ACTION_ADD_TVCHANNEL=36,MEDIA_ACTION_ADD_FOLDER=37,MEDIA_ACTION_AUTO_SCAN_DVB=38,MEDIA_ACTION_MANUAL_SCAN_DVB=39,MEDIA_ACTION_DVB_EPG=40,MEDIA_ACTION_CLEAR_DVB=41,MEDIA_ACTION_STOP_RECORD=43,MEDIA_ACTION_ADD_FAV=44,MEDIA_ACTION_REMOVE_FAV=45,MEDIA_ACTION_EXPAND_ALL=46,MEDIA_ACTION_COLLAPSE_ALL=47,MEDIA_ACTION_DVB_EPG_GRID=48,MEDIA_EXTENSION={},MEDIA_TYPES=[MEDIA_TYPE_VIDEO,MEDIA_TYPE_AUDIO,MEDIA_TYPE_IMAGE,MEDIA_TYPE_TEXT,MEDIA_TYPE_ISO,MEDIA_TYPE_PLAYLIST,MEDIA_TYPE_CUE,MEDIA_TYPE_RECORDS_ITEM];MEDIA_EXTENSION[MEDIA_TYPE_VIDEO]=["mpg","mpeg","mov","mp4","avi","mkv","3gp","ts","vob","wmv","mts","m2t","m2v","divx","m2ts","m2p","tp","flv","mod","tod","asf","m4a","tts","m4v"],MEDIA_EXTENSION[MEDIA_TYPE_AUDIO]=["mp3","wav","ac3","ogg","oga","aiff","wv","tta","wma","aac","dts","flac","ape"],MEDIA_EXTENSION[MEDIA_TYPE_IMAGE]=["jpg","jpeg","png","bmp","tif","tiff"],MEDIA_EXTENSION[MEDIA_TYPE_TEXT]=["txt","srt","sub","ass"],MEDIA_EXTENSION[MEDIA_TYPE_ISO]=["iso"],MEDIA_EXTENSION[MEDIA_TYPE_PLAYLIST]=["m3u","m3u8"],MEDIA_EXTENSION[MEDIA_TYPE_CUE]=["cue"],MEDIA_EXTENSION[MEDIA_TYPE_RECORDS_ITEM]=["tspinf"];var app=function(global){var module={models:{},views:{}};return module.storage=[],module.init=function(){global.CMODAL_IMG_PATH=configuration.newRemoteControl?PATH_IMG_SYSTEM+"buttons/new/":PATH_IMG_SYSTEM+"buttons/old/",global.baseCPage=module.views.main.page,module.views.main.init(),stbEvent.bind("show",function(){stbWindowMgr.windowShow(stbWebWindow.windowId())}),stbEvent.bind("exit",function(){stbWebWindow.close()})},module.onKeyDown=function(event){if(eventPrepare(event,!1,global.currCPage&&global.currCPage.name)){if(global.currCPage&&global.currCPage.EventHandler(event))return event.preventDefault(),void event.stopPropagation();switch(event.code){case KEYS.POWER:stbWebWindow.messageSend(getWindowIdByName(WINDOWS.PORTAL),"portal.standbyMode","");break;case KEYS.TV:module.views.main.actions.tv();break;case KEYS.WEB:}}},module.refreshStorageInfo=function(){module.storage=[],getStorageInfo();var usb,i;for(i=0;i<STORAGE_INFO.length;i++)usb=STORAGE_INFO[i],0===usb.isReadOnly&&(usb.freeSizeGb=Math.floor(usb.freeSize/1024/1024/1024*100)/100,usb.sizeGb=Math.floor(usb.size/1024/1024/1024*100)/100,usb.id=i,module.storage.push(usb))},global.onload=module.init,global.moveTo(0,0),global.resizeTo(EMULATION?window.outerWidth:screen.width,EMULATION?window.outerHeight:screen.height),global.oncontextmenu=EMULATION?null:function(){return!1},document.addEventListener("keydown",module.onKeyDown),gSTB.EnableServiceButton(!0),gSTB.EnableVKButton(!0),stbWindowMgr.SetVirtualKeyboardCoord("none"),global.parent&&global.parent.gSTB&&(global.dvbManager=global.parent.dvbManager,global.epgManager=global.parent.epgManager,global.gSTB=global.parent.gSTB,global.pvrManager=global.parent.pvrManager,global.stbDownloadManager=global.parent.stbDownloadManager,global.stbStorage=global.parent.stbStorage,global.stbUpdate=global.parent.stbUpdate,global.stbUPnP=global.parent.stbUPnP,global.stbWebWindow=global.parent.stbWebWindow,global.stbWindowMgr=global.parent.stbWindowMgr,global.timeShift=global.parent.timeShift),module}(window),stbEvent={onEvent:function(data){},onMessage:function(from,message,data){this.trigger(message,{from:from,data:data})},onBroadcastMessage:function(from,message,data){echo(message,"onBroadcastMessage"),this.trigger("broadcast."+message,{from:from,data:data})},event:0};Events.inject(stbEvent),app.models.main=function(app){var module={environmentData:null},data=[];return module.load=function(){var name,arr=[];try{arr=JSON.parse(pvrManager.GetAllTasks())}catch(e){echo(e),arr=[]}return arr.forEach(function(item){if(name=item.fileName.split("/"),item.name=name[name.length-3]+" "+name[name.length-1].split("_").join(":"),item.duration=item.startTime&&item.endTime?item.endTime-item.startTime:0,0===Number(item.errorCode))switch(item.state){case 1:item.status=_("Scheduled"),item.type=MEDIA_TYPE_PVR_SHED;break;case 2:item.status=_("Recording"),item.type=MEDIA_TYPE_PVR_REC;break;case 3:item.status=_("Recording error"),item.type=MEDIA_TYPE_PVR_ERR;break;case 4:item.status=_("Completed"),item.type=MEDIA_TYPE_PVR_DONE}else switch(item.state=3,item.type=MEDIA_TYPE_PVR_ERR,item.errorCode){case-2:item.status=_("Not enough disk space");break;case-3:item.status=_("Incorrect time");break;case-5:item.status=_("Wrong name or path");break;case-6:item.status=_("Duplicated file");break;case-7:item.status=_("Wrong URL");break;case-9:item.status=_("Too many active records processed");break;case-11:item.status=_("Not enough disk space");break;default:item.status=_("Recording error")}}),module.environmentData=JSON.parse(gSTB.GetEnv(JSON.stringify({varList:["mount_media_ro"]}))),arr},module.get=function(){return data},module}(app),app.views.main=function(global,app){function initPage(){var component=new CPage;return component.name="CPageMain",component.Init(document.body.querySelector("div.page.main")),component.EventHandler=function(event){if(module.page.input.IsFolded())switch(event.code){case KEYS.F4:module.actions.f4();break;case KEYS.OK:case KEYS.PAGE_UP:case KEYS.PAGE_DOWN:case KEYS.UP:case KEYS.DOWN:case KEYS.LEFT:case KEYS.RIGHT:case KEYS.HOME:case KEYS.END:module.page.lister.EventHandler(event);break;case 32:module.actions.f2(!0),event.preventDefault();break;case KEYS.MENU:case KEYS.INFO:case KEYS.F1:case KEYS.F2:module.page.buttonPanel.EventHandler(event);break;case KEYS.EXIT:module.page.exitButtonPanel.EventHandler(event);break;case KEYS.BACK:break;case KEYS.STOP:var itemsFound=!1,date=new Date;if(component.lister.states.marked&&component.lister.states.marked.length>0){var itemsForUnmark=component.lister.states.marked.slice(0);component.lister.states.marked.forEach(function(item){2===item.data.state&&(pvrManager.ChangeEndTime(item.data.id,String(date.getTime()/1e3)),itemsFound=!0)}),itemsForUnmark.forEach(function(item){component.lister.Marked(item,!1)})}itemsFound||2!==component.lister.Current().data.state||pvrManager.ChangeEndTime(component.lister.Current().data.id,String(date.getTime()/1e3))}else echo("send key press to search handler"),module.page.input.EventHandler(event)},component}function initBreadCrumb(page){var component=new CBreadCrumb(page);return component.showAttr="table-cell",component.Init(PATH_IMG_PUBLIC,page.handle.querySelector(".body .header .cbcrumb")),component.SetName(_("Record manager")),component}function initCFilterInput(){var timeout,component=new CFilterInput(this,{input:document.getElementById("place"),folded:!0,hint:_("Enter record name..."),events:{onFold:function(){module.page.breadCrumb.Show(!0)},onUnfold:function(){module.page.breadCrumb.Show(!1),gSTB.ShowVirtualKeyboard(),module.page.input.focus()},onChange:function(){var self=this;clearTimeout(timeout),timeout=setTimeout(function(){module.page.lister.Focused(module.page.lister.FirstMatch(self.GetValue()),!0,!1)},400)},onExit:function(){this.Reset(),app.views.main.updatePVRData()},onEnter:function(){var last,clone={};if(0===module.page.lister.Length())return void this.Fold(!0);if(module.page.lister.path[module.page.lister.path.length-1].filterText&&(module.page.lister.path.pop(),module.page.breadCrumb.Pop()),this.GetValue()){last=module.page.lister.path[module.page.lister.path.length-1];for(var attr in last)last.hasOwnProperty(attr)&&(clone[attr]=last[attr]);clone.filterText=this.GetValue(),clone.name="Filter",echo("clone.filterText 0="+clone.filterText),module.page.lister.Open(clone)}else module.page.lister.path[module.page.lister.path.length-1].filterText=module.page.lister.filterText=module.page.lister.parentItem.filterText="",module.page.lister.Refresh();module.page.breadCrumb.Show(!0),module.page.lister.onFocus(module.page.lister.Current(),null),this.Fold(!0,!0,!0)}}});return component}function initLister(page){function refreshStorageData(){echo("PVR->onMountAction"),app.refreshStorageInfo(),currCPage&&currCPage instanceof CModalBox&&(currCPage.device.SetData(app.storage.length>0?app.storage:[{id:-1,label:_("No storage device")}]),currCPage.$freeSize.innerHTML=currCPage.device.GetSelected().freeSizeGb||"0",currCPage.$totlaSize.innerHTML=currCPage.device.GetSelected().sizeGb||"0")}var component=new CPVRList(page);return component.Init(page.handle.querySelector(".body .content .cslist-main")),component.SetBreadCrumb(page.breadCrumb),stbEvent.bind("player.end",function(){stbWindowMgr.windowShow(stbWebWindow.windowId())}),stbEvent.bind("broadcast.storage.mount",function(){refreshStorageData(),setTimeout(function(){new CModalHint(currCPage,_("USB storage is connected"),3e3)},0)}),stbEvent.bind("broadcast.storage.unmount",function(){refreshStorageData()}),component}function initExitButtonPanel(page){var component=new CButtonPanel(page);return component.Init(remoteControlButtonsImagesPath,page.handle.querySelector(".body .footer .exit div.cbpanel-main")),component.btnExit=component.Add(KEYS.EXIT,"exit.png",configuration.newRemoteControl?_("Exit"):"",function(){module.actions.exit()}),component}function initButtonPanel(page){var component=new CButtonPanel(page);return component.Init(remoteControlButtonsImagesPath,page.handle.querySelector(".body .footer .main div.cbpanel-main")),component.btnMenu=component.Add(KEYS.MENU,"menu.png",configuration.newRemoteControl?_("Menu"):"",function(){module.actions.menu()}),component.btnFrame=component.Add(KEYS.INFO,"info.png",_("Show<br>info panel"),function(){module.actions.frame()}),component.btnF1=component.Add(KEYS.F1,"f1.png",_("Add<br>record"),function(){"true"===app.models.main.environmentData.result.mount_media_ro?new CModalAlert(currCPage,_("Warning!"),_('"Storage read only access mode" is enabled in System Settings'),_("Close")):module.actions.f1()}),component.btnF2=component.Add(KEYS.F2,"f2.png",_("Select"),function(){module.actions.f2(!0)}),component}function initPreview(page){function actionRecordInfo(data){var size=120,name=data.name.substr(0,size-1)+(data.name.length>size?"...":""),startTime=parseDate(new Date(1e3*data.startTime)),endTime=parseDate(new Date(1e3*data.endTime)),durTime={hours:Math.floor(data.duration/3600),minute:Math.ceil(data.duration/60%60)},channel=data.fileName.split("records/")[1].split("/")[0],info=[element("div",{},[component.infoIcon,element("div",{className:"text"},_("Detailed information about the selected record"))]),element("br"),element("div",{className:"lbl"},[_("Name:"),element("span",{className:"txt"},name)]),element("div",{className:"lbl"},[_("Status:"),element("span",{className:"txt"},data.status)]),element("div",{className:"lbl"},[_("Start:"),element("span",{className:"txt"},startTime)]),element("div",{className:"lbl"},[_("End:"),element("span",{className:"txt"},endTime)]),element("div",{className:"lbl"},[_("Duration:"),element("span",{className:"txt"},durTime.hours?durTime.hours+" "+_("h.")+" "+durTime.minute+" "+_("m."):durTime.minute+" "+_("m."))]),element("div",{className:"lbl"},[_("Channel:"),element("span",{className:"txt"},channel)])];elchild(elclear(this.body),this.body.info=element("div",{},info))}function parseDate(from){var month=[_("Jan"),_("Feb"),_("Mar"),_("Apr"),_("May"),_("Jun"),_("Jul"),_("Aug"),_("Sep"),_("Oct"),_("Nov"),_("Dec")],dayF=from.getDate(),monF=from.getMonth(),mF=from.getMinutes(),hF=from.getHours();return dayF+" "+month[monF]+" "+(hF>9?hF:"0"+hF)+":"+(mF>9?mF:"0"+mF)}var component=new CBase(page);return component.Init(page.handle.querySelector(".content .sbar")),component.Show(!1,!1),component.body=component.handle.querySelector("td.view"),component.blkAll=component.handle.querySelector("div.block.all"),component.blkSel=component.handle.querySelector("div.block.sel"),component.valAll=component.blkAll.querySelector("span.value"),component.valSel=component.blkSel.querySelector("span.value"),component.blkAll.querySelector("span.title").innerHTML=_("Items:"),component.blkSel.querySelector("span.title").innerHTML=_("Selected:"),component.showAttr="table-cell",component.infoIcon=element("img",{align:"left",src:PATH_IMG_PUBLIC+"media/ico_info.png"}),component.actionInfo={},component.actionInfo[MEDIA_TYPE_BACK]=function(data){elchild(elclear(this.body),element("div",{},[component.infoIcon,element("div",{className:"text",innerHTML:_("Contains a list of items corresponding to the given filter request")})]))},component.actionInfo[MEDIA_TYPE_PVR_SHED]=actionRecordInfo,component.actionInfo[MEDIA_TYPE_PVR_REC]=actionRecordInfo,component.actionInfo[MEDIA_TYPE_PVR_ERR]=actionRecordInfo,component.actionInfo[MEDIA_TYPE_PVR_DONE]=actionRecordInfo,component.onShow=function(){module.page.lister.activeItem&&this.info(module.page.lister.activeItem.data)},component.SetItemsCount=function(){var itemsAmount=page.lister.states.hidden?page.lister.Length()-page.lister.states.hidden.length:page.lister.Length();this.valAll.innerHTML=page.lister.path.length>1?itemsAmount-1:itemsAmount},component.infoBack=function(data){elchild(elclear(this.body),this.info(page.lister.parentItem))},component.info=function(data){data&&data.type&&"function"==typeof this.actionInfo[data.type]&&this.actionInfo[data.type].call(this,data),elchild(this.body,element("div",{className:"fade"}))},component}function initModalMenu(page){var component=new CModal(page);return component.onShow=function(){var isStopBtnVisible,self=this,currentItem=page.lister.Current(),activeItems=page.lister.ActiveItems(),itemsAmount=page.lister.states.hidden?page.lister.Length()-page.lister.states.hidden.length:page.lister.Length(),hasMarkable=itemsAmount>1||1===itemsAmount&&currentItem.data.type!==MEDIA_TYPE_BACK,realRecordsAmount=itemsAmount;currentItem&&currentItem.data.type===MEDIA_TYPE_BACK&&(currentItem=null),page.lister.handle.children.length&&page.lister.handle.children[0].data.type===MEDIA_TYPE_BACK&&realRecordsAmount--,isStopBtnVisible=null!==currentItem&&currentItem.data.type===MEDIA_TYPE_PVR_REC,isStopBtnVisible||(isStopBtnVisible=page.lister.states.marked&&page.lister.states.marked.some(function(item){return 2===item.data.state?!0:void 0})),component.menu.gedit.slist.Hidden(component.menu.gedit.iopen,null===currentItem||currentItem.data.type!==MEDIA_TYPE_PVR_DONE),component.menu.gedit.slist.Hidden(component.menu.gedit.iselone,null===currentItem),component.menu.gedit.slist.Hidden(component.menu.gedit.iselall,!(realRecordsAmount>1)),component.menu.gedit.slist.Hidden(component.menu.gedit.istop,!isStopBtnVisible),component.menu.gedit.slist.Hidden(component.menu.gedit.iedit,null===currentItem||currentItem.data.type!==MEDIA_TYPE_PVR_REC&&currentItem.data.type!==MEDIA_TYPE_PVR_SHED),component.menu.gedit.slist.Hidden(component.menu.gedit.ideselect,0===(page.lister.states.marked||[]).length),component.menu.gedit.slist.Hidden(component.menu.gedit.iinvert,component.menu.gedit.ideselect.hidden),component.menu.gedit.slist.Hidden(component.menu.gedit.idelete,0===activeItems.length),(component.menu.gsort.slist.states.marked||[]).forEach(function(item){item.self.Marked(item,!1)}),component.menu.gsort.slist.Marked(component.menu.gsort.slist.FindOne({iid:page.lister.sortType}),!0),page.lister.mtypes=[],page.lister.data.forEach(function(item){echo(item.type,"item.data.type"),self.filterText?item.name&&-1!==item.name.toLowerCase().indexOf(self.filterText)&&-1===page.lister.mtypes.indexOf(item.type)&&page.lister.mtypes.push(item.type):-1===page.lister.mtypes.indexOf(item.type)&&page.lister.mtypes.push(item.type)}),component.menu.gview.slist.Each(function(item){page.modalMenu.menu.gview.slist.Hidden(item,item.iid!==MEDIA_TYPE_NONE&&-1===page.lister.mtypes.indexOf(item.iid))}),component.menu.Hidden(component.menu.gsort,!(realRecordsAmount>1)),page.modalMenu.menu.gview.slist.states.hidden&&page.modalMenu.menu.gview.slist.states.hidden.length>=page.modalMenu.menu.gview.slist.Length()-2?component.menu.Hidden(component.menu.gview,!0):component.menu.Hidden(component.menu.gview,!hasMarkable),component.menu.Switch(component.menu.gedit),component.menu.Activate()},component.menu=new CGroupMenu(component),component.menu.Init(page.handle.querySelector("div.cgmenu-main")),component.Init(element("div",{className:"cmodal-menu"},component.menu.handle)),component.handle.onclick=function(){component.Show(!1)},component.EventHandler=function(event){switch(event.code){case KEYS.EXIT:module.actions.exit();break;case KEYS.MENU:case KEYS.BACK:page.modalMenu.Show(!1);break;default:page.modalMenu.menu.EventHandler(event)}},component.menu.gedit=component.menu.AddGroup("gedit",_("Operations"),{onclick:function(){var iid=this.iid;switch(page.modalMenu.Show(!1),iid){case MEDIA_ACTION_OPEN:page.lister.Current().onclick();break;case MEDIA_ACTION_ADD_ITEM:"true"===app.models.main.environmentData.result.mount_media_ro?new CModalAlert(currCPage,_("Warning!"),_('"Storage read only access mode" is enabled in System Settings'),_("Close")):new CModalAddRecord(module.page,_("Add record"),"");break;case MEDIA_ACTION_EDIT:var item=page.lister.Current();new CModalEditRecord(module.page,_("Edit record"),"",item.data);break;case MEDIA_ACTION_SELECT_ONE:module.actions.f2(!0);break;case MEDIA_ACTION_SELECT_ALL:page.lister.Each(function(item){item.self.Marked(item,!0)});break;case MEDIA_ACTION_DESELECT:page.lister.Each(function(item){item.self.Marked(item,!1)});break;case MEDIA_ACTION_INVERT:page.lister.Each(function(item){item.self.Marked(item,!item.marked)});break;case MEDIA_ACTION_STOP_RECORD:var itemsForUnmark,itemsFound=!1,date=new Date;page.lister.states.marked&&page.lister.states.marked.length>0&&(itemsForUnmark=page.lister.states.marked.slice(0),page.lister.states.marked.forEach(function(item){2===item.data.state&&(pvrManager.ChangeEndTime(item.data.id,String(date.getTime()/1e3)),itemsFound=!0)}),itemsForUnmark.forEach(function(item){page.lister.Marked(item,!1)})),itemsFound||2!==page.lister.Current().data.state||pvrManager.ChangeEndTime(page.lister.Current().data.id,String(date.getTime()/1e3));break;case MEDIA_ACTION_DELETE:var items=page.lister.ActiveItems();new CModalDelete(module.page,items)}return!1}}),component.menu.gedit.iopen=component.menu.AddItem(component.menu.gedit,MEDIA_ACTION_OPEN,_("Open"),{icon:remoteControlButtonsImagesPath+"ok.png"}),component.menu.gedit.iadditem=component.menu.AddItem(component.menu.gedit,MEDIA_ACTION_ADD_ITEM,_("Add record"),{icon:remoteControlButtonsImagesPath+"f1.png"}),component.menu.gedit.iedit=component.menu.AddItem(component.menu.gedit,MEDIA_ACTION_EDIT,_("Edit")),component.menu.gedit.istop=component.menu.AddItem(component.menu.gedit,MEDIA_ACTION_STOP_RECORD,_("Stop")),component.menu.gedit.iselone=component.menu.AddItem(component.menu.gedit,MEDIA_ACTION_SELECT_ONE,_("Select"),{icon:remoteControlButtonsImagesPath+"f2.png"}),component.menu.gedit.iselall=component.menu.AddItem(component.menu.gedit,MEDIA_ACTION_SELECT_ALL,_("Select all")),component.menu.gedit.ideselect=component.menu.AddItem(component.menu.gedit,MEDIA_ACTION_DESELECT,_("Deselect all")),component.menu.gedit.iinvert=component.menu.AddItem(component.menu.gedit,MEDIA_ACTION_INVERT,_("Invert selection")),component.menu.gedit.idelete=component.menu.AddItem(component.menu.gedit,MEDIA_ACTION_DELETE,_("Delete")),component.menu.gview=component.menu.AddGroup("gview",_("View"),{onclick:function(){return this.self.Marked(this.self.FindOne({marked:!0}),!1),this.self.Marked(this,!0),this.self.Focused(this,!0),page.modalMenu.Show(!1),page.lister.SetFilterType(this.iid),page.lister.Activate(!0),!1}}),component.menu.AddItem(component.menu.gview,MEDIA_TYPE_NONE,_("All"),{marked:!0,focused:!0}),component.menu.AddItem(component.menu.gview,MEDIA_TYPE_PVR_SHED,_("Scheduled")),component.menu.AddItem(component.menu.gview,MEDIA_TYPE_PVR_REC,_("In progress")),component.menu.AddItem(component.menu.gview,MEDIA_TYPE_PVR_ERR,_("Errors")),component.menu.AddItem(component.menu.gview,MEDIA_TYPE_PVR_DONE,_("Completed")),component.menu.gsort=component.menu.AddGroup("gsort",_("Sort"),{onclick:function(){return page.modalMenu.Show(!1),page.lister.sortType!==this.iid&&(page.lister.sortType=this.iid),page.lister.Refresh(),module.page.lister.Focused(module.page.lister.FindOne(),!0),!1}}),component.menu.gsort.iname=component.menu.AddItem(component.menu.gsort,MEDIA_ACTION_SORT_NAME,_("By name"),{focused:!0}),component.menu.gsort.itime=component.menu.AddItem(component.menu.gsort,MEDIA_ACTION_SORT_TIME,_("By time")),component.menu.gsort.itype=component.menu.AddItem(component.menu.gsort,MEDIA_ACTION_SORT_TYPE,_("By state")),component.menu.gsort.iduration=component.menu.AddItem(component.menu.gsort,MEDIA_ACTION_SORT_SIZE,_("By duration")),
component.menu.Switch(component.menu.gedit),component}var module={},remoteControlButtonsImagesPath=configuration.newRemoteControl?PATH_IMG_SYSTEM+"buttons/new/":PATH_IMG_SYSTEM+"buttons/old/";return module.init=function(){gettext.init({name:getCurrentLanguage(),path:"./public/lang"},function(){window.parent.postMessage("show","*"),module.fill();var imageList=["exit.png","f1.png","f2.png","f4.png"].map(function(image){return remoteControlButtonsImagesPath+image});imageList=imageList.concat(["topmenu_bg.png","bottommenu_bg.png"].map(function(image){return PATH_IMG_PUBLIC+"backgrounds/"+image})),imageList=imageList.concat(["type_5.png"].map(function(image){return PATH_IMG_PUBLIC+"media/"+image})),imageLoader(imageList,function(){module.show()})})},module.fill=function(){module.page=initPage(),module.page.breadCrumb=initBreadCrumb(module.page),module.page.lister=initLister(module.page),module.page.preview=initPreview(module.page),module.page.exitButtonPanel=initExitButtonPanel(module.page),module.page.buttonPanel=initButtonPanel(module.page),module.page.modalMenu=initModalMenu(module.page),module.page.input=initCFilterInput(),module.page.lister.SetData(app.models.main.load()),module.page.lister.Open({type:MEDIA_TYPE_ROOT_PVR}),module.page.lister.Activate(!0),module.page.lister.onFocus=function(current,previous){null===current&&(current=module.page.lister.FindOne(),module.page.lister.Focused(current,!0,!0)),module.page.buttonPanel.Hidden(module.page.buttonPanel.btnF2,!current.data.markable),module.page.preview.info(current.data)},module.updatePVRData=function(){module.page.lister.UpdateList(app.models.main.load()),module.page.preview.SetItemsCount(),module.page.lister.Length()>0===module.page.lister.hideF2&&(module.page.lister.hideF2=!module.page.lister.hideF2,module.page.buttonPanel.Hidden(module.page.buttonPanel.btnF2,module.page.lister.hideF2)),module.page.lister.Length()>0===module.page.lister.hideFrameBtn&&(module.page.lister.hideFrameBtn=!module.page.lister.hideFrameBtn,module.page.buttonPanel.Hidden(module.page.buttonPanel.btnFrame,module.page.lister.hideFrameBtn),module.page.lister.hideFrameBtn&&module.page.preview.isVisible&&module.page.preview.Show(!1)),module.page.lister.Current()||0===module.page.lister.handle.children.length||(module.page.lister.isActive||module.page.lister.Activate(),module.page.lister.Focused(module.page.lister.FindOne(),!0)),0===module.page.lister.handle.children.length&&module.page.lister.isVisible&&module.page.lister.Show(!1),0===module.page.lister.handle.children.length||module.page.lister.isVisible||module.page.lister.Show(!0)},module.timer=window.setInterval(function(){module.updatePVRData()},6e3)},module.show=function(){module.page.Show(!0),document.getElementById("pageInit").style.display="none",module.updatePVRData()},module.actions={exit:function(){module.page.lister.parentItem.filterText?(module.page.lister.Open({type:MEDIA_TYPE_BACK}),module.updatePVRData(),0!==module.page.lister.Length()&&(module.page.lister.Activate(!0),module.page.lister.Focused(module.page.lister.FindOne(),!0,!0))):(echo("Exit app..."),global.parent.postMessage("hide","*"))},frame:function(state){state=void 0!==state?state:!module.page.preview.isVisible,module.page.preview.Show(state,!1),module.page.buttonPanel.Rename(module.page.buttonPanel.btnFrame,_(module.page.preview.isVisible?"Hide<br>info panel":"Show<br>info panel")),module.page.preview.handle.parentNode.className=state?"preview":""},menu:function(){module.page.modalMenu.Show(!0)},f1:function(){echo("F1 was pressed"),new CModalAddRecord(module.page,_("Add record"),"")},f2:function(move){if(echo("F2 was pressed"),!module.page.buttonPanel.btnF2.data.hidden){var item=module.page.lister.Current();item.data.markable&&module.page.lister.Marked(item,!item.marked)&&(move!==!1&&module.page.lister.MoveNext(1),module.page.lister.Focused(module.page.lister.Next()))}},f4:function(){module.page.input.Fold(!module.page.input.IsFolded)},remove:function(){var items=module.page.lister.ActiveItems();items.length&&new CModalDelete(module.page,items)},tv:function(){module.page.handle.parentNode.style.backgroundColor="#010101",stbWindowMgr.SetVirtualKeyboardCoord("none"),stbWindowMgr.showPortalWindow()}},module}(window,app),CPVRList.prototype=Object.create(CScrollList.prototype),CPVRList.prototype.constructor=CPVRList,CPVRList.prototype.Sort=function(list,sortType){return list=list||[],echo("sortType"+sortType),Array.isArray(list)&&list.length>0&&(list.sort(function(a,b){return a.name.toLowerCase().localeCompare(b.name.toLowerCase())}),sortType===this.MEDIA_ACTION_SORT_TYPE&&void 0!==list[0].type?(list.sort(function(a,b){return a.type-b.type}),echo("MEDIA_ACTION_SORT_TYPE")):sortType===MEDIA_ACTION_SORT_NAME&&void 0!==list[0].name?(list.sort(function(a,b){return a.name.toLowerCase().localeCompare(b.name.toLowerCase())}),echo("MEDIA_ACTION_SORT_NAME")):sortType===MEDIA_ACTION_SORT_TIME&&void 0!==list[0].startTime?(list.sort(function(a,b){return b.startTime-a.startTime}),echo("MEDIA_ACTION_SORT_TIME")):sortType===this.MEDIA_ACTION_SORT_SIZE&&void 0!==list[0].duration&&(echo("MEDIA_ACTION_SORT_SIZE"),list.sort(function(a,b){return a.duration-b.duration}))),list},CPVRList.prototype.SetBreadCrumb=function(component){this.bcrumb=component},CPVRList.prototype.SetSearchBar=function(component){this.sbar=component},CPVRList.prototype.SetData=function(data){this.data=data},CPVRList.prototype.Filter=function(){var self=this;this.Each(function(item){var textOk=item.data.type===MEDIA_TYPE_BACK||item.data.name&&-1!==item.data.name.toLowerCase().indexOf(self.filterText),typeOk=item.data.type===self.filterType||self.filterType===MEDIA_TYPE_NONE||item.data.type===MEDIA_TYPE_BACK;self.Hidden(item,!(textOk&&typeOk))}),app.views.main.page.preview.SetItemsCount()},CPVRList.prototype.FirstMatch=function(value){for(var items=this.handleInner.children,i=0;i<items.length;i++){var item=items[i];if(item.data.type!==MEDIA_TYPE_BACK&&item.data.name&&-1!==item.data.name.toLowerCase().indexOf(value.toLowerCase()))return item}return null},CPVRList.prototype.Add=function(name,inAttrs){var $name,$ico,$progress,$wrapper,item,hidden=!1,progress=0,attrs=inAttrs,className=["","waiting","running","error","done"];if(attrs&&attrs.type!==MEDIA_TYPE_BACK&&($progress=element("div",{className:"progress"}),progress=((new Date).getTime()/1e3-attrs.startTime)/attrs.duration*100,attrs.progressPct<0&&(attrs.progressPct=0),attrs.progressPct=Math.floor(progress),$progress.style.width=attrs.type===MEDIA_TYPE_PVR_REC?attrs.progressPct+"%":"0%",$ico=element("div",{className:"ico"}),$name=element("div",{className:"name"},attrs.name),$wrapper=element("div",{className:className[attrs.state]},[$progress,$ico,$name]),attrs.$progress=$progress),this.filterText&&(hidden=!(attrs.name&&-1!==attrs.name.toLowerCase().indexOf(this.filterText.toLowerCase()))),attrs.type!==MEDIA_TYPE_BACK?attrs.markable=!0:($wrapper=element("div",{className:"back"},[element("div",{className:"ico"}),element("div",{className:"name"},"..")]),hidden=!1,attrs.markable=!1),item=CScrollList.prototype.Add.call(this,$wrapper,{$body:$wrapper,hidden:hidden,disabled:!1,markable:attrs.markable,data:attrs,onclick:function(){return this.data.type===MEDIA_TYPE_BACK&&(this.self.Open(this.data),app.views.main.updatePVRData()),this.data.type===MEDIA_TYPE_PVR_DONE&&this.self.Open(this.data),!1},oncontextmenu:EMULATION?null:function(){return!1}}),attrs.type!==MEDIA_TYPE_BACK&&!this.indexTable[attrs.id]){echo("WE ARE ADDING NEW ITEM WITH ID"+attrs.id),this.indexTable[attrs.id]=item;var hasAlready=!1;this.data.some(function(item){return item.id===attrs.id?(hasAlready=!0,!0):void 0}),hasAlready||(this.data[attrs.id]=attrs)}return item},CPVRList.prototype.Delete=function(item){echo("CPVRList.prototype.Delete"),delete this.indexTable[item.data.id],this.data.splice(this.data.indexOf(item.data),1),CScrollList.prototype.Delete.call(this,item),0===this.handle.childNodes.length&&this.Show(!1),this.parent.preview.SetItemsCount(),0===this.Length()&&app.views.main.actions.frame(!1)},CPVRList.prototype.onFocus=function(item,previous){return this.parent.buttonPanel.Hidden(this.parent.buttonPanel.btnF3,item.data.type===MEDIA_TYPE_BACK),!1},CPVRList.prototype.onStateChange=function(item,option,oldVal,newVal){var marked=Array.isArray(this.states.marked)?this.states.marked:[];marked.length>0&&(this.parent.preview.valSel.innerHTML=marked.length),this.parent.preview.blkSel.style.display=marked.length>0?"inline-block":"none"},CPVRList.prototype.Clear=function(){this.handleInner.innerHTML=null,this.activeItem=null,this.states={},this.indexTable={},this.sbar&&this.sbar.Reset(),this.filterType=MEDIA_TYPE_NONE},CPVRList.prototype.OpenRoot=function(data){echo(data,"CPVRList.prototype.OpenRoot data:");var self=this;return this.Clear(),window.scrollTo(0,0),data.filterText&&self.Add("..",{type:MEDIA_TYPE_BACK,markable:!1}),this.Sort(this.data,self.sortType).forEach(function(item){self.indexTable[item.id]||(echo(item.name,"NEW ITEM ADDED"),item.markable=!0,self.Add(item.fileName.split("records/")[1].split("/")[0]+" "+item.name,item))}),this.filterText&&this.Filter(),this.Length()>0&&(this.hideF2=!1),this.Render(),self.LEVEL_CHANGE_DOWN},CPVRList.prototype.OpenBack=function(data){var self=this;return this.path.length>1?(this.path.pop(),this.bcrumb&&this.bcrumb.Pop(),this.Build(this.path[this.path.length-1]),setTimeout(function(){self.onFocus(self.Current())},0),this.LEVEL_CHANGE_UP):this.LEVEL_CHANGE_NONE},CPVRList.prototype.OpenRecord=function(data){return this.timer&&clearTimeout(this.timer),echo(data.fileName),gSTB.IsFileExist(data.fileName)?stbWebWindow.messageSend(getWindowIdByName(WINDOWS.PORTAL),"player.play",data.fileName):new CModalHint(this.parent,_("File not found"),5e3),this.LEVEL_CHANGE_NONE},CPVRList.prototype.Build=function(data){var levelChange=this.LEVEL_CHANGE_NONE;return this.filterText=data.filterText?data.filterText:"",data&&data.type&&"function"==typeof this.openAction[data.type]?levelChange=this.openAction[data.type].call(this,data):new CModalAlert(this.parent,_("Error"),_("Unknown type of selected item"),_("Close")),levelChange},CPVRList.prototype.Open=function(data){echo("CPVRList.Open :: data"),this.hideF2=!0;var levelChange=this.Build(data);return levelChange!==this.LEVEL_CHANGE_NONE&&(levelChange===this.LEVEL_CHANGE_DOWN&&(this.filterText?this.bcrumb&&this.bcrumb.Push("/","media/ico_filter.png",this.filterText):this.bcrumb&&this.bcrumb.Push("/","media/type_"+data.type+".png",data.name?data.name:""),this.path.push(data)),this.mode=void 0!==this.path[1]?this.path[1].type:MEDIA_TYPE_ROOT_PVR,this.parentItem=this.path[this.path.length-1],this.parent.buttonPanel.Hidden(this.parent.buttonPanel.btnF2,this.hideF2),this.parent.preview.SetItemsCount()),levelChange},CPVRList.prototype.Reset=function(){this.parentItem=null,this.mode=MEDIA_TYPE_ROOT_PVR,this.sortType=MEDIA_ACTION_SORT_TYPE,this.path=[],this.Clear(),window.scrollTo(0,0),this.bcrumb&&this.bcrumb.Reset(),this.sbar&&this.sbar.Reset()},CPVRList.prototype.Refresh=function(refocus){echo("refresh"),this.indexTable={},null!==this.parentItem&&this.Build(this.parentItem)},CPVRList.prototype.Marked=function(item,state){return item&&item.data&&item.data.markable?CScrollList.prototype.Marked.call(this,item,state):!1},CPVRList.prototype.SetFilterType=function(type){this.filterType=type,this.Filter()},CPVRList.prototype.SetFilterText=function(text){this.filterText=text.toLowerCase(),this.Filter()},CPVRList.prototype.ActiveItems=function(){var items=Array.isArray(this.states.marked)?this.states.marked.slice():[];return 0===items.length&&this.activeItem&&this.activeItem.data.markable&&items.push(this.activeItem),items},CPVRList.prototype.UpdateList=function(dataForUpdate){var progressPct,currItem,self=this,newItem=null,infoRefreshFlag=!1,className=["","waiting","running","error","done"];dataForUpdate.forEach(function(item){self.indexTable[item.id]?(infoRefreshFlag=!0,currItem=self.indexTable[item.id],currItem.data.state!==item.state&&(echo(currItem,"update item state by id "+item.id),echo("className[item.state]"+className[item.state]),currItem.$body.className=className[item.state],currItem.data.type=90+item.state,currItem.data.state=item.state,currItem.data.status=item.status),currItem.data.endTime!==item.endTime&&(currItem.data.endTime=item.endTime,currItem.data.duration=currItem.data.endTime-currItem.data.startTime),currItem.data.type===MEDIA_TYPE_PVR_REC&&(progressPct=((new Date).getTime()/1e3-currItem.data.startTime)/currItem.data.duration*100,progressPct=0>progressPct?0:Math.floor(progressPct),currItem.data.$progress.style.width=progressPct+"%")):(echo(item,"UpdateList->add new item"),item.markable=!0,newItem=self.Add(item.name,item))}),self.Render(),"CPageMain"===currCPage&&self.Activate(!0),newItem&&self.Focused(newItem,!0,!0),infoRefreshFlag&&currCPage.preview&&currCPage.preview.isVisible&&currCPage.preview.onShow()},CModalEditRecord.prototype=Object.create(CModalBox.prototype),CModalEditRecord.prototype.constructor=CModalEditRecord,CModalDelete.prototype=Object.create(CModalAlert.prototype),CModalDelete.prototype.constructor=CModalDelete,CModalAddRecord.prototype=Object.create(CModalBox.prototype),CModalAddRecord.prototype.constructor=CModalAddRecord;