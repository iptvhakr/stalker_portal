/*! ivi-webapp - v2.5.4 - 2014-10-15 */
require=function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);throw new Error("Cannot find module '"+g+"'")}var j=c[g]={exports:{}};b[g][0].call(j.exports,function(a){var c=b[g][1][a];return e(c?c:a)},j,j.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({"collections/adv":[function(a,b){b.exports=a("4eSXXB")},{}],"4eSXXB":[function(a,b){"use strict";function c(a){var b=this;this.defaults={name:"AdvCollection",modelType:e,watchHistory:{},inLoad:!1},d.call(this,i.defaults(a||{},this.defaults)),this.on("add",function(a){a.model.setAll({filmId:this.filmId,watchId:this.watchId}),a.model.on("watched",function(){b.watchHistory[a.model.get("type")]=Date.now()})}),this.rpcClient=new f(h.get("contentApiUrl"),h.get("advApiNamespace"))}var d=a("lib/collection"),e=a("models/adv"),f=a("lib/rpc.client"),g=a("models/user"),h=a("../config"),i=a("lib/tools");c.prototype=Object.create(d.prototype),c.prototype.constructor=c,c.prototype.getByType=function(a){return this.filter(function(b){return b.get("type")===a})},c.prototype.prepareAdvLast=function(){var a,b={};for(a in this.watchHistory)this.watchHistory.hasOwnProperty(a)&&(b[a]=(Date.now()-this.watchHistory[a])/100);return b},c.prototype.add=function(a){Array.isArray(a.files)&&a.files.length&&d.prototype.add.call(this,a)},c.prototype.load=function(a,b){var c,d=this;this.clear(),this.filmId=a,this.watchId=b,this.inLoad=!0,c=this.getParams(),c.adv_last_by_type=this.prepareAdvLast(),this.loadXhr=this.rpcClient.call("get",[c.contentid,c]).onSuccess(function(a){d.inLoad=!1,d.models(a),d.trigger("loaded")}).onError(function(a){d.inLoad=!1,d.trigger("loadError",a)})},c.prototype.getParams=function(){var a={site:"s"+h.get("site"),contentid:this.filmId,watchid:this.watchId,uid:h.get("uid")};return g.isAuthorized()&&(a.iviid=g.get("id")),a},c.prototype.abort=function(){this.loadXhr&&this.loadXhr.abort()},b.exports=c},{"../config":39,"lib/collection":"Ou0jNv","lib/rpc.client":"PcZuZs","lib/tools":"AjqgZI","models/adv":"giot0N","models/user":"QAloAk"}],MRwP1A:[function(a,b){"use strict";function c(a){this.defaults={url:f.get("apiUrl")+"/catalogue/"+f.get("apiVersion"),modelType:e,params:{from:0,to:27,direction:1,paid_type:f.get("paidTypes"),subsite:f.get("site")},indent:12,maxLength:36},d.call(this,g.defaults(a||{},this.defaults)),this.defParams=this.params,this.on("fetch",function(a){this.params.to-this.params.from>a.length&&(this.params.to=this.params.from+a.length-1,a.to<0&&(a.to=0),this.isEnd=!0),this.updateIndexes()}),this.on("remove",function(){-1===this.params.direction&&(this.isEnd=!1)}),this.on("add",function(a){var b;a.model.index=a.index,this.length>this.maxLength&&(b=1===this.params.direction?this.slice(0,1)[0]:this.slice(-1)[0],this.remove(b))})}var d=a("lib/ajax.collection"),e=a("models/film"),f=a("../config"),g=a("lib/tools");c.prototype=Object.create(d.prototype),c.prototype.constructor=c,c.prototype.clear=function(){this.emit("clear")},c.prototype.fullClear=function(){this.reset(),d.prototype.clear.call(this)},c.prototype.models=function(a){var b;if(1===this.params.direction)d.prototype.models.call(this,a);else{for(var c=a.length-1;c>=0;c--)b=this.insert(a[c],0),b.view.hide();this.clear()}},c.prototype.updateIndexes=function(){for(var a=0;a<this.length;a++)this._data[a].index=a},c.prototype.sort=function(a){this.params.sort=a,this.fetch()},c.prototype.reset=function(){this.setParameters(this.defParams)},b.exports=c},{"../config":39,"lib/ajax.collection":"fqWis0","lib/tools":"AjqgZI","models/film":"DKEUaB"}],"collections/films":[function(a,b){b.exports=a("MRwP1A")},{}],"7uhHY+":[function(a,b){"use strict";function c(a){this.defaults={url:f.get("apiUrl")+"/promo/"+f.get("apiVersion"),params:{subsite:f.get("site"),paid_type:f.get("paidTypes")},autoload:!0,modelType:e},d.call(this,g.defaults(a||{},this.defaults)),this.imageSize="372x163"}var d=a("lib/ajax.collection"),e=a("models/promo"),f=a("../config"),g=a("lib/tools");c.prototype=Object.create(d.prototype),c.prototype.constructor=c,b.exports=c},{"../config":39,"lib/ajax.collection":"fqWis0","lib/tools":"AjqgZI","models/promo":"iVIYTP"}],"collections/promo":[function(a,b){b.exports=a("7uhHY+")},{}],"collections/reviews":[function(a,b){b.exports=a("RbgBjM")},{}],RbgBjM:[function(a,b){"use strict";function c(a){this.defaults={url:f.get("apiUrl")+"/video/reviews",params:{limit:5,sort:"all"},autoLoad:!1,events:{add:function(a){a.model.get("text")!==a.model.get("moderate_preview")&&a.model.set("isPreview",!0)}}},d.call(this,e.defaults(a||{},this.defaults))}var d=a("lib/ajax.collection"),e=a("lib/tools"),f=a("../config");c.prototype=Object.create(d.prototype),c.prototype.constructor=c,c.prototype.setType=function(a){this.url=f.get("apiUrl")+"/"+a+"/reviews"},c.prototype.fetch=function(a){this.params.id=a,d.prototype.fetch.call(this)},b.exports=c},{"../config":39,"lib/ajax.collection":"fqWis0","lib/tools":"AjqgZI"}],uboD1Q:[function(a,b){"use strict";function c(a){var b=this;this.defaults={url:f.get("apiUrl")+"/videofromcompilation/",modelType:e,params:{from:0,to:99},view:{watch:!0},maxLength:100,allLoaded:!1},d.call(this,g.defaults(a||{},this.defaults)),this.on("fetch",function(a){if(a.length===b.maxLength){var c=b.getParameter("from"),d=b.getParameter("to");b.setParameter("from",c+b.maxLength),b.setParameter("to",d+b.maxLength),b.fetch()}else b.allLoaded=!0})}var d=a("lib/ajax.collection"),e=a("models/serie"),f=a("../config"),g=a("lib/tools");c.prototype=Object.create(d.prototype),c.prototype.constructor=c,c.prototype.fullClear=function(){this.reset(),d.prototype.clear.call(this)},c.prototype.reset=function(){this.setParameters(this.defParams)},b.exports=c},{"../config":39,"lib/ajax.collection":"fqWis0","lib/tools":"AjqgZI","models/serie":"jiRtAe"}],"collections/series":[function(a,b){b.exports=a("uboD1Q")},{}],"components/action":[function(a,b){b.exports=a("tNzK7p")},{}],tNzK7p:[function(a,b){"use strict";function c(a){this.defaults={name:"CAction"},d.call(this,e.defaults(a,this.defaults)),this.on("click",function(){"function"==typeof this.action&&this.action()})}var d=a("lib/cbase"),e=a("lib/tools"),f=a("lib/keys");c.prototype=Object.create(d.prototype),c.prototype.constructor=c,c.prototype.eventHandler=function(a){switch(a.code){case f.OK:return this.emit("click"),!0}return!1},b.exports=c},{"lib/cbase":"tTNRm4","lib/keys":"iIRFqq","lib/tools":"AjqgZI"}],"+xiQfc":[function(a,b){"use strict";function c(a){this.defaults={name:"CButton",model:{data:{title:a.title||""},view:{template:void 0!==a.template?a.template:!0,watch:a.watch,handle:a.handle}}},d.call(this,e.defaults(a,this.defaults))}var d=a("components/action"),e=a("lib/tools");c.prototype=Object.create(d.prototype),c.prototype.constructor=c,c.prototype.setTitle=function(a){this.model.set("title",a)},b.exports=c},{"components/action":"tNzK7p","lib/tools":"AjqgZI"}],"components/button":[function(a,b){b.exports=a("+xiQfc")},{}],"components/footer":[function(a,b){b.exports=a("SHo47G")},{}],SHo47G:[function(a,b){"use strict";function c(a){var b=this;this.defaults={visible:!0,name:"Footer",handle:null,manager:null,active:!1,owner:null,model:{data:{isLoading:!0,buttonsVisible:!1}},viewType:e,view:{template:!0,watch:!0,autoRender:!0}},d.call(this,g.defaults(a,this.defaults)),this.list=new f({name:"FooterButtons",arrows:null,visible:!1,handle:this.handle.querySelector(".buttons-list"),active:!0,collection:{watch:!0,idName:"button",data:[{title:"Выход",button:"exit",code:h.EXIT},{title:"Подробнее",button:"info",code:h.INFO},{title:"Изменить вид",button:"frame",code:h.FRAME},{button:"red",code:h.F1},{button:"green",code:h.F2},{button:"yellow",code:h.F3},{button:"blue",code:h.F4}],events:{models:function(a){for(var b,c=0;b=a.models[c];c++)b.view.hide()}}},events:{enter:function(a){b.owner.emit("keydown",{code:a.get("code")})}}})}var d=a("lib/cbase"),e=a("lib/model.view"),f=a("components/hlist"),g=a("lib/tools"),h=a("lib/keys");c.prototype=Object.create(d.prototype),c.prototype.constructor=c,c.prototype.loading=function(a){this.model.set("isLoading",a)},c.prototype.buttons=function(a){a?this.list.show():this.list.hide()},c.prototype.showButton=function(a,b){a=this.list.collection.get(a),a&&a.view.show(),b&&a.set("title",b)},c.prototype.hideButton=function(a){a=this.list.collection.get(a),a&&a.view.hide()},c.prototype.hideAll=function(){this.list.collection.forEach(function(a){a.view.hide()})},c.prototype.setTitle=function(a,b){a=this.list.collection.get(a),a&&a.set("title",b)},b.exports=c},{"components/hlist":"GEj0De","lib/cbase":"tTNRm4","lib/keys":"iIRFqq","lib/model.view":"ESYGw6","lib/tools":"AjqgZI"}],"components/header":[function(a,b){b.exports=a("zExk/C")},{}],"zExk/C":[function(a,b){"use strict";function c(a){var b=this;this.defaults={visible:!0,name:"Header",handle:null,manager:null,active:!1,owner:null,model:{data:{title:"",logoPosition:"center",menuShow:!0}},viewType:f,view:{template:!0,watch:!0,autoRender:!0}},d.call(this,g.defaults(a,this.defaults)),this.on("activate",function(){b.manager.current().deactivate()}),this.addComponent(new e({handle:document.getElementById("header-menu-btn"),active:!0,owner:this,action:function(){b.owner.showMenu()}}))}var d=a("lib/cpanel"),e=a("components/button"),f=a("lib/model.view"),g=a("lib/tools"),h=a("lib/keys");c.prototype=Object.create(d.prototype),c.prototype.constructor=c,c.prototype.setTitle=function(a){a?(this.model.set("title",a),this.model.set("logoPosition","right")):(this.model.remove("title"),this.model.set("logoPosition","center"))},c.prototype.eventHandler=function(a){switch(a.code){case h.UP:return!0;case h.DOWN:case h.EXIT:return this.manager.current().activate(),!0}return d.prototype.eventHandler.call(this,a)},b.exports=c},{"components/button":"+xiQfc","lib/cpanel":"ySbxUr","lib/keys":"iIRFqq","lib/model.view":"ESYGw6","lib/tools":"AjqgZI"}],qh3oth:[function(a,b){"use strict";function c(a){this.defaults={name:"FilmsList",activated:!0,autoLoad:!0,collection:{params:{sort:a.sort}},collectionType:e},d.call(this,f.defaults(a,this.defaults)),this.autoLoad===!0&&this.collection.fetch()}var d=a("./hlist"),e=a("collections/films"),f=a("lib/tools"),g=a("lib/keys"),h=a("lib/dom");c.prototype=Object.create(d.prototype),c.prototype.constructor=c,c.prototype.moveNext=function(){var a,b,c=this.activeChild||this.first();this.collection.length-c.index<this.collection.indent&&this.collection.fetching===!1&&this.collection.isEnd!==!0&&(a=this.collection.params,b=-1===a.direction?this.collection.length:this.collection.indent,a.to+=b,a.from=a.to-this.collection.indent+1,a.direction=1,this.collection.fetch()),d.prototype.moveNext.call(this)},c.prototype.movePrevious=function(){var a,b,c=this.activeChild||this.first();a=this.collection.params,c.index<this.collection.indent&&0!==a.from&&this.collection.fetching===!1&&(b=1===a.direction?this.collection.length:this.collection.indent,a.to-=b,a.from=a.to-this.collection.indent+1,a.from<0&&(a.from=0),a.direction=-1,this.collection.fetch()),d.prototype.movePrevious.call(this)},c.prototype.updateArrows=function(a){this.arrows&&a&&(0===a.index&&0===this.collection.getParameter("from")&&this.collection.fetching!==!0?(h.hide(this.arrows.previous),h.show(this.arrows.next)):this.collection.indexOf(a)===this.collection.length-1&&this.collection.isEnd===!0?(h.hide(this.arrows.next),h.show(this.arrows.previous)):(h.show(this.arrows.next),h.show(this.arrows.previous)))},c.prototype.reload=function(){this.collection.fullClear(),this.collection.fetch(),this.activeChild=null},c.prototype.eventHandler=function(a){switch(a.code){case g.INFO:return this.emit("showInfo",this.activeChild),!0}return d.prototype.eventHandler.call(this,a)},c.prototype.sortBy=function(a){this.collection.once("clear",function(){this.fullClear()}),this.collection.reset(),this.collection.params.sort=a,this.collection.fetch(),this.activeChild=null},b.exports=c},{"./hlist":"GEj0De","collections/films":"MRwP1A","lib/dom":"CBUzS7","lib/keys":"iIRFqq","lib/tools":"AjqgZI"}],"components/hflist":[function(a,b){b.exports=a("qh3oth")},{}],GEj0De:[function(a,b){"use strict";function c(a){var b=this;this.defaults={},d.call(this,e.defaults(a,this.defaults)),this._last=null,this._first=null,this.on("activate",function(){this._update()}),this.collection.on("fetch",function(){b._update()})}var d=a("./list"),e=a("lib/tools");c.prototype=Object.create(d.prototype),c.prototype.constructor=c,c.prototype.moveNext=function(){var a=this.next();null!==a&&(this.activeChild===this._last&&(this.hideItem(this._first),this._first=this.next(this._first),this._last=a),this.activateItem(a))},c.prototype.movePrevious=function(){var a=this.previous();null!==a&&(this.activeChild===this._first&&(this._first=this.previous(this._first),this.showItem(this._first),this._last=this.previous(this._last)),this.activateItem(a))},c.prototype._update=function(){var a=0,b=this.collection.view.handle.firstElementChild;for(this._last=null,this._first=null;b&&(this.filter(b)&&b.view.isVisible()&&(null===this._first&&(this._first=b.view.model),a++,this._last=b.view.model),a!==this.hItems);)b=b.nextElementSibling},b.exports=c},{"./list":"ZuDVNd","lib/tools":"AjqgZI"}],"components/hlist":[function(a,b){b.exports=a("GEj0De")},{}],"7zX6co":[function(a,b){"use strict";function c(a){var b=this;this.defaults={name:"CInput",handle:null},d.call(this,g.defaults(a,this.defaults)),this.on("activate",function(){b.handle.focus()}),this.on("deactivate",function(){b.handle.blur()}),this.handle.addEventListener("input",function(){b.emit("change",b.value)}),this.on("change",function(){b.handle.blur(),b.handle.focus()}),e.on("keydown",function(a){a.code===f.BACK&&document.activeElement===b.handle&&b.remove()})}var d=a("lib/cbase"),e=a("lib/listener"),f=a("lib/keys"),g=a("lib/tools");c.prototype=Object.create(d.prototype),c.prototype.constructor=c,c.prototype.blur=function(){this.handle.blur()},c.prototype.focus=function(){this.handle.focus()},c.prototype.clear=function(){this.handle.value=""},c.prototype.insert=function(a){var b=this.handle.value.split(""),c=this.handle.selectionStart;b.splice(c,0,a),this.handle.value=b.join(""),this.setCaretTo(c+1),this.emit("change",this.handle.value)},c.prototype.remove=function(){var a=this.handle.value.split(""),b=this.handle.selectionStart,c=this.handle.selectionEnd;b===c?a.splice(b-1,1):a.splice(b-1,b-c),this.handle.value=a.join(""),this.emit("change",this.handle.value)},c.prototype.carriageLeft=function(){this.handle.selectionStart--,this.handle.selectionEnd--},c.prototype.carriageRight=function(){this.handle.selectionEnd++,this.handle.selectionStart++},c.prototype.setCaretTo=function(a){this.handle.selectionStart=a,this.handle.selectionEnd=a},c.prototype.eventHandler=function(a){switch(a.code){case f.LEFT:return this.carriageLeft(),0!==this.handle.selectionStart;case f.RIGHT:return this.carriageRight(),this.handle.selectionStart===this.handle.selectionEnd&&this.handle.selectionStart!==this.handle.value.length}return!1},Object.defineProperties(c.prototype,{value:{get:function(){return this.handle.value}}}),b.exports=c},{"lib/cbase":"tTNRm4","lib/keys":"iIRFqq","lib/listener":"0gs5AI","lib/tools":"AjqgZI"}],"components/input":[function(a,b){b.exports=a("7zX6co")},{}],A64hEq:[function(a,b){"use strict";function c(a){var b=this;this.defaults={name:"Keyboard",arrows:null,active:!0,activated:!0,scroller:!1,input:null,collection:{modelType:e,watch:!0},keymap:{value:"Рус","short":"ru"},textCase:"lower"},d.call(this,f.defaults(a,this.defaults)),this.initCollection(),this.on("activateItem",function(a){"skip"===a.get("class")&&b.moveNext()}),this.on("previous",function(a){a.skip||"Очистить"!==a.item.get("value")||(a.skip=2)}),this.on("enter",function(a){"function"==typeof a.data.action&&a.data.action(a)})}var d=a("components/mclist"),e=a("lib/model"),f=a("lib/tools"),g={ru:["а","б","в","г","д","е","ё","ж","з","и","й","к","л","м","н","о","п","р","с","т","у","ф","х","ц","ч","ш","щ","ъ","ы","ь","э","ю","я"],en:["a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z"],ch:["1","2","3","4","5","6","7","8","9","0",".",",","-",":","(",")","$","&",'"',"!","?","@","/","\\","'","+","*"]};c.prototype=Object.create(d.prototype),c.prototype.constructor=c,c.prototype.initCollection=function(){var a,b,c=this,d=[{type:"control",action:function(){c.input.remove()},"class":"del"},{type:"control",action:function(){c.input.carriageLeft()},"class":"left"},{type:"control",action:function(){c.input.carriageRight()},"class":"right"},{type:"control",action:function(a){c.changeKeymap(a)},"class":"serv",value:"Eng","short":"en"},{type:"control",action:function(a){c.changeKeymap(a)},"class":"serv",value:"123","short":"ch"},{type:"control","class":"skip"},{type:"control",action:function(){c.input.clear()},"class":"serv wide",value:"Очистить"}],e=function(a){c.addChar(a)};for(b in g)if(g.hasOwnProperty(b))for(a=0;a<g[b].length;a++)d.push({value:g[b][a],type:b,action:e,"class":"symbol"});d.push({type:"control",action:e,"class":"space",value:" "}),d.push({type:"control",action:function(a){c.changeCase(a)},"class":"shift",id:"shift"}),this.collection.models(d)},c.prototype.changeCase=function(a){var b,c=this;this.textCase="upper"===this.textCase?"lower":"upper",this.collection.forEach(function(a){b=a.get("value"),"string"==typeof b&&"control"!==a.get("type")&&(b="upper"===c.textCase?b.toUpperCase():b.toLowerCase(),a.set("value",b))}),a.set("class","shift "+this.textCase)},c.prototype.changeKeymap=function(a){var b=a.getAll(),c=this.collection.get("shift");a.setAll(this.keymap),this.keymap=b,this.update(),"ch"!==this.keymap.short?c.view.show():c.view.hide()},c.prototype.filter=function(a){var b=a.get("type");return b===this.keymap.short||"control"===b},c.prototype.addChar=function(a){this.input.insert(a.get("value"))},c.prototype.previous=function(a,b){return this.activeChild.view.handle.offsetLeft<this.itemWidth&&!b?null:d.prototype.previous.call(this,a,b)},b.exports=c},{"components/mclist":"mKkleD","lib/model":"blv/2e","lib/tools":"AjqgZI"}],"components/keyboard":[function(a,b){b.exports=a("A64hEq")},{}],"components/list":[function(a,b){b.exports=a("ZuDVNd")},{}],ZuDVNd:[function(a,b){"use strict";function c(a){var b=this;this.defaults={collection:{view:{handle:a.collectionHandle||a.handle,template:!0,watch:!0}},arrows:{previous:".arrow.left",next:".arrow.right"},collectionType:e,activateOnHover:!1,owner:null,handle:null,scroller:!1},d.call(this,g.defaults(a,this.defaults)),this.on("activate",function(){this.activeChild||this.activateItem(this.first())}),this.activateOnHover&&this.handle.addEventListener("mouseover",function(a){b.emit("hover",a),b.activate()}),this.data=this.collection.data,delete this.collection.data,this.setCollection(this.collection),this.scroller&&this.setScroller(this.scroller),this.collection.on("add",function(a){b.activateOnHover&&a.model.view.handle.addEventListener("mouseover",function(){b.isActive()&&b.activateItem(a.model)}),b.filter(a.model)||a.model.view.hide()}),this.collection.on("request",function(){b.emit("request")}),this.collection.on("fetch",function(){b.emit("fetch"),b.activeChild||b.activateItem(b.collection.at(0))}),this.arrows&&this.setArrows(this.arrows),this.data&&this.collection.models(this.data)}var d=a("lib/cbase"),e=a("lib/collection"),f=a("lib/scroller"),g=a("lib/tools"),h=a("lib/keys"),i=a("lib/dom");c.prototype=Object.create(d.prototype),c.prototype.constructor=c,c.prototype.first=function(){if(this.collection.length){var a=(this.collectionHandle||this.handle).firstElementChild.view.model;return("function"==typeof this.parse&&!this.parse(a)||!a.view.isVisible())&&(a=this.next(a)),a}},c.prototype.next=function(a,b){if(a=a||this.activeChild,!a)return this.first();var c,d=1;for(this.emit("next",c={item:a,skip:b,next:a.view.handle.nextElementSibling});c.next;){if(this.filter(c.next.view.model)&&!this.skip(c.next.view.model)&&(!c.skip||c.skip===d++))return c.next.view.model;c.next=c.next.nextElementSibling}return null},c.prototype.previous=function(a,b){if(a=a||this.activeChild,!a)return null;var c,d=1;for(this.emit("previous",c={item:a,skip:b,previous:a.view.handle.previousElementSibling});c.previous;){if(this.filter(c.previous.view.model)&&!this.skip(c.previous.view.model)&&(!c.skip||c.skip===d++))return c.previous.view.model;c.previous=c.previous.previousElementSibling}return null},c.prototype.moveNext=function(a){var b=this.next(null,a);return null===b?!1:(this.activateItem(b),b)},c.prototype.movePrevious=function(a){var b=this.previous(null,a);return null===b?!1:(this.activateItem(b),b)},c.prototype.setArrows=function(a){var b=this;"string"==typeof a.previous&&(a.previous=this.handle.querySelector(a.previous)),"string"==typeof a.next&&(a.next=this.handle.querySelector(a.next)),a.previous.addEventListener("click",function(){b.movePrevious()}),a.next.addEventListener("click",function(){b.moveNext()})},c.prototype.updateArrows=function(a){this.arrows&&a&&(0===this.collection.indexOf(a)?(i.hide(this.arrows.previous),i.show(this.arrows.next)):this.collection.indexOf(a)===this.collection.length-1?(i.hide(this.arrows.next),i.show(this.arrows.previous)):(i.show(this.arrows.next),i.show(this.arrows.previous)))},c.prototype.setCollection=function(a){a instanceof e||(a=new this.collectionType(a)),a.owner=this,this.collection=a},c.prototype.setScroller=function(a){a instanceof f||(a=new f(this.scroller)),this.scroller=a},c.prototype.activateItem=function(a){a&&(this.deactivateItem(this.activeChild),this.scroller&&this.scroller.show(a.view.handle),a.view.handle.classList.add("active"),this.updateArrows(a),this.activeChild=a,this.emit("activateItem",a))},c.prototype.deactivateItem=function(a){a&&(this.activeChild=null,a.view.handle.classList.remove("active"),this.emit("deactivateItem",a))},c.prototype.hideItem=function(a){a&&a.view.hide()},c.prototype.showItem=function(a){a&&a.view.show()},c.prototype.filter=function(){return!0},c.prototype.skip=function(){return!1},c.prototype.update=function(){var a=this;this.collection.forEach(function(b){a.filter(b)?b.view.show():b.view.hide()})},c.prototype.clear=function(){this.collection.clear()},c.prototype.eventHandler=function(a){if(0===this.collection.length)return!1;switch(a.code){case h.RIGHT:return this.moveNext(),this.emit("right"),!0;case h.LEFT:return this.movePrevious(),this.emit("left"),!0;case h.OK:return this.emit("enter",this.activeChild),!0;case h.INFO:return this.emit("showInfo",this.activeChild),!0}return!1},Object.defineProperties(c.prototype,{hItems:{get:function(){if(this._hItems)return this._hItems;var a=this.first();return this._hItems=a?Math.floor(this.collection.view.handle.offsetWidth/a.view.handle.offsetWidth):0,this._hItems},set:function(a){this._hItems=a}},vItems:{get:function(){if(this._vItems)return this._vItems;var a=this.first();return this._vItems=a?Math.floor(this.collection.view.handle.offsetHeight/a.view.handle.offsetHeight):0,this._vItems},set:function(a){this._vItems=a}},itemHeight:{get:function(){var a=this.first();return a?a.view.handle.offsetHeight:0}},itemWidth:{get:function(){var a=this.first();return a?a.view.handle.offsetWidth:0}}}),b.exports=c},{"lib/cbase":"tTNRm4","lib/collection":"Ou0jNv","lib/dom":"CBUzS7","lib/keys":"iIRFqq","lib/scroller":"8+NRr9","lib/tools":"AjqgZI"}],gQ4GYy:[function(a,b){"use strict";function c(a){this.defaults={name:"MCFList",collectionType:e},d.call(this,f.defaults(a,this.defaults))}var d=a("components/mclist"),e=a("collections/films"),f=a("lib/tools");c.prototype=Object.create(d.prototype),c.prototype.constructor=c,c.prototype.moveNext=function(a){var b,c,e=this.collection.params,f=this.activeChild||this.first();this.collection.length-f.index<this.collection.indent&&this.collection.fetching===!1&&this.collection.isEnd!==!0&&(b=-1===e.direction?this.collection.length:this.collection.indent,e.to+=b,e.from=e.to-this.collection.indent+1,e.direction=1,this.collection.fetch()),c=Math.floor((f.index+(a||1))/this.hItems),this.currentRow>0&&c-this.lastHiddenRow>this.hItems&&this.hideRow(this.currentRow-1),d.prototype.moveNext.call(this,a)},c.prototype.movePrevious=function(a){var b,c,e=this.collection.params,f=this.activeChild||this.first();f.index<this.collection.indent&&0!==e.from&&this.collection.fetching===!1&&(b=1===e.direction?this.collection.length:this.collection.indent,e.to-=b,e.from=e.to-this.collection.indent+1,e.from<0&&(e.from=0),e.direction=-1,this.collection.fetch()),c=Math.floor((f.index-(a||1))/this.hItems),c===this.lastHiddenRow&&this.showRow(this.lastHiddenRow),d.prototype.movePrevious.call(this,a)},c.prototype.hideRow=function(a){var b,c,d=a*this.hItems,e=d+this.hItems;for(b=d;e>b;b++)c=this.collection.at(b),c.view.hide()},c.prototype.showRow=function(a){var b,c,d=a*this.hItems,e=d+this.hItems;for(b=d;e>b;b++)c=this.collection.at(b),c.view.show()},Object.defineProperty(c.prototype,"currentRow",{get:function(){var a=this.activeChild||this.first();return Math.floor(a.index/this.hItems)}}),Object.defineProperty(c.prototype,"lastHiddenRow",{get:function(){var a=this.collection.filter(function(a){return!a.view.isVisible()}).pop();return a?Math.floor(a.index/this.hItems):-1}}),b.exports=c},{"collections/films":"MRwP1A","components/mclist":"mKkleD","lib/tools":"AjqgZI"}],"components/mcflist":[function(a,b){b.exports=a("gQ4GYy")},{}],mKkleD:[function(a,b){"use strict";function c(a){this.defaults={scroller:{container:a.collectionHandle}},d.call(this,e.defaults(a,this.defaults))}var d=a("components/list"),e=a("lib/tools"),f=a("lib/keys");c.prototype=Object.create(d.prototype),c.prototype.constructor=c,c.prototype.eventHandler=function(a){switch(a.code){case f.LEFT:return this.emit("left"),this.movePrevious()!==!1;case f.RIGHT:return this.emit("right"),this.moveNext()!==!1;case f.DOWN:return this.emit("down"),this.moveNext(this.hItems)!==!1;case f.UP:return this.emit("up"),this.movePrevious(this.hItems)!==!1;case f.OK:return this.emit("enter",this.activeChild),!0;default:return!1}},b.exports=c},{"components/list":"ZuDVNd","lib/keys":"iIRFqq","lib/tools":"AjqgZI"}],"components/mclist":[function(a,b){b.exports=a("mKkleD")},{}],"components/menu":[function(a,b){b.exports=a("iHD9HF")},{}],iHD9HF:[function(a,b){"use strict";function c(a){var b=this;this.defaults={modal:!0,visible:!1,submenu:!1,handle:document.getElementById("menu"),menuHandle:document.getElementById("menu-list"),subMenuHandle:document.getElementById("submenu-list"),menuListHandle:document.getElementById("genres-list"),subMenuListHandle:document.getElementById("categories-list")},d.call(this,i.defaults(a,this.defaults)),this.on("show",function(){this.activate()}),this.on("hide",function(){this.deactivate()}),this.categoriesList=new e({name:"MenuCategoryList",active:!0,owner:this,handle:this.menuHandle,arrows:{next:".arrow_bottom",previous:".arrow_top"},collection:{modelType:g},eventHandler:function(a){if(0===this.collection.length)return!1;switch(a.code){case j.RIGHT:return b.genresList.isVisible()&&b.genresList.activate(),!0}return e.prototype.eventHandler.call(this,a)},skip:function(a){return"divider"===a.get("type")},events:{enter:function(a){var c=a.get("action");b.hide(),"function"==typeof c?c():b.emit("enter",{category:a.get("id")})},activateItem:function(a){clearTimeout(this.changeTimer),this.changeTimer=setTimeout(function(){var c=a.view.model.get("genres");c?(b.genresList.collection.models(c),b.genresList.show()):b.genresList.hide()},400)}},collectionHandle:this.menuListHandle}),this.genresList=new e({name:"MenuGenreList",active:!1,visible:!1,owner:this,handle:this.subMenuHandle,scroller:{container:this.subMenuHandle,indent:30},arrows:{next:".arrow_bottom",previous:".arrow_top"},collection:{modelType:g,events:{clear:function(){b.genresList.activeChild=null}}},eventHandler:function(a){if(0===this.collection.length)return!1;switch(a.code){case j.LEFT:return b.categoriesList.activate(),!0}return e.prototype.eventHandler.call(this,a)},events:{enter:function(a){b.hide(),b.emit("enter",{genre:a.get("id")})},activate:function(){this.isVisible()||this.show()}},collectionHandle:this.subMenuListHandle}),h.categories.length?this.initMenu(h.categories.getData()):h.categories.on("fetch",function(a){b.initMenu(a)}),f.on("authorized",function(){var a=[],c=b.categoriesList.collection.get("auth"),d=c.get("firstname"),e=c.get("lastname");d&&a.push(d),e&&a.push(e),0===a.length&&a.push("Профиль"),c.set("title",a)}),f.on("logout",function(){var a=b.categoriesList.collection.get("auth");a.set("title","Авторизация")})}var d=a("lib/cbase"),e=a("components/vlist"),f=a("models/user"),g=a("lib/model"),h=a("../dictionary"),i=a("lib/tools"),j=a("lib/keys");c.prototype=Object.create(d.prototype),c.prototype.constructor=c,c.prototype.initMenu=function(a){var b=this,c=[{title:"Главная",action:function(){b.emit("showMain")}}];c=c.concat(a),c=c.concat([{title:"Поиск",action:function(){b.emit("showSearch")}},{type:"divider",title:""},{id:"auth",title:"Авторизация",action:function(){b.emit("showAuthorization")}},{type:"divider",title:""},{title:"Соглашение",action:function(){b.emit("showAgreements")}},{title:"Выход",action:function(){b.emit("exit")}}]),this.categoriesList.collection.models(c)},c.prototype.eventHandler=function(a){if(this.activeChild&&"function"==typeof this.activeChild.eventHandler&&this.activeChild.eventHandler(a)===!0)return!0;switch(a.code){case j.EXIT:case j.MENU:this.hide()}return!0},b.exports=c},{"../dictionary":40,"components/vlist":"CJRc+3","lib/cbase":"tTNRm4","lib/keys":"iIRFqq","lib/model":"blv/2e","lib/tools":"AjqgZI","models/user":"QAloAk"}],uFvIi8:[function(a,b){"use strict";function c(a){this.defaults={viewType:e,activated:!0,modal:!0,model:{},modelType:f,visible:!1,view:{template:!0,autoRender:!1}},d.call(this,g.defaults(a,this.defaults)),this.view.compile(),this.view.insert(this.view.compiled.element),this.on("hide",function(){this.deactivate()})}var d=a("lib/cbase"),e=a("lib/model.view"),f=a("models/film.info"),g=a("lib/tools"),h=a("lib/keys");c.prototype=Object.create(d.prototype),c.prototype.constructor=c,c.prototype.show=function(a){this.film=a,this.update(a),this.handle.firstElementChild.scrollTop=0,this.view.show(),this.activate()},c.prototype.update=function(a){this.model.clear(),this.model.setAll(a.getAll()),this.view.update()},c.prototype.eventHandler=function(a){switch(a.code){case h.UP:this.handle.firstElementChild.scrollByLines(-1);break;case h.DOWN:this.handle.firstElementChild.scrollByLines(1);break;case h.OK:this.hide(),this.emit("enter",this.film);break;case h.EXIT:case h.INFO:this.hide()}return!0},b.exports=c},{"lib/cbase":"tTNRm4","lib/keys":"iIRFqq","lib/model.view":"ESYGw6","lib/tools":"AjqgZI","models/film.info":"7L3aGG"}],"components/quickinfo":[function(a,b){b.exports=a("uFvIi8")},{}],"components/vlist":[function(a,b){b.exports=a("CJRc+3")},{}],"CJRc+3":[function(a,b){"use strict";function c(a){this.defaults={scroller:{container:a.collectionHandle}},d.call(this,e.defaults(a,this.defaults))}var d=a("components/list"),e=a("lib/tools"),f=a("lib/keys");c.prototype=Object.create(d.prototype),c.prototype.constructor=c,c.prototype.eventHandler=function(a){switch(a.code){case f.DOWN:return this.moveNext()!==!1;case f.UP:return this.movePrevious()!==!1;case f.OK:return this.emit("enter",this.activeChild),!0;default:return!1}},b.exports=c},{"components/list":"ZuDVNd","lib/keys":"iIRFqq","lib/tools":"AjqgZI"}],39:[function(a,b){"use strict";var c=a("lib/local.model");b.exports=new c({name:"Ivi.ru",data:{apiUrl:"http://www.ivi.ru/mobileapi",contentApiUrl:"http://api.digitalaccess.ru/api/json/",logApiUrl:"http://api.digitalaccess.ru/logger/",paidTypes:["AVOD"],apiVersion:"v3",videoMode:"576i",subtitlesFont:"/usr/lib/fonts/Ubuntu.ttf",subtitlesLang:"ru",audioLang:"ru",contentApiNamespace:"da.content",advApiNamespace:"da.adv",site:127,posterSize:"172x264",serialThumbSize:"132x95",videoQuality:"hi",deviceModel:gSTB.GetDeviceModel(),app_version:"390"},savedFields:["email","password","uid","videoQuality"]})
},{"lib/local.model":"ieUPCh"}],40:[function(a,b){"use strict";var c=a("lib/ajax.collection"),d=a("lib/collection"),e=a("./config"),f=e.get("apiUrl"),g={countries:new c({url:f+"/countries/",parse:function(a){var b,c=[];for(b in a)a.hasOwnProperty(b)&&c.push({id:b,title:a[b]});return c},autoload:!0}),genres:new d({}),categories:new c({url:f+"/categories/v2/",events:{fetch:function(a){var b;for(b=0;b<a.length;b++)a[b].genres&&a[b].genres.length&&g.genres.addAll(a[b].genres)}},autoload:!0})};b.exports=g},{"./config":39,"lib/ajax.collection":"fqWis0","lib/collection":"Ou0jNv"}],41:[function(a){"use strict";function b(){var a,b=this,y={name:"IVI",pageManager:{showDetails:function(a){a&&b.detailsPage.show(a)},showInfo:function(a){b.quickInfo.show(a)},showSorted:function(a){b.sortedPage.show(a)},showUserData:function(a){b.profilePage.show(a)},showRatingSort:function(a,c){b.sortRatingModal.action=c,b.sortRatingModal.show(a)},showBudgetSort:function(a,c){b.sortBudgetModal.action=c,b.sortBudgetModal.show(a)},events:{allReady:function(){b.splashScreen.hide()},startChanges:function(){b.splashScreen.show()}}},images:[]};c.call(this,y),this.authModal=new p({owner:this,handle:document.getElementById("authorization-modal")}),this.header=new j({name:"Header",owner:this,activated:!1,manager:this.pageManager,handle:document.getElementById("header")}),this.footer=new k({name:"Footer",owner:this,activated:!1,manager:this.pageManager,handle:document.getElementById("footer")}),this.quickInfo=new r({owner:this,modal:!0,handle:document.getElementById("quick-info"),events:{enter:function(a){b.pageManager.showDetails(a)},show:function(){b.footer.setTitle("info","Скрыть")},hide:function(){b.footer.setTitle("info","Подробней")}}}),this.menu=new l({owner:this,events:{enter:function(a){this.deactivate(),b.genrePage.show(a)},showAgreements:function(){b.agreementsPage.show()},showMain:function(){b.mainPage.show()},showSearch:function(){b.searchPage.show()},showAuthorization:function(){u.isAuthorized()===!1?b.authModal.show():b.profilePage.show()},exit:function(){b.exit()}}}),this.splashScreen=new m({name:"SplashScreen",handle:document.getElementById("splash-screen"),owner:this,visible:!0,active:!0,modal:!0,header:this.header,footer:this.footer,show:function(){b.footer.loading(!0),b.footer.buttons(!1),this.activate(),this.handle.classList.remove("invisible")},hide:function(){b.footer.loading(!1),b.footer.buttons(!0),this.deactivate(),this.handle.classList.add("invisible")},manager:this.pageManager,eventHandler:function(a){var c;return a.code===x.EXIT&&(c=b.pageManager.current(),c&&"function"==typeof c.cancel&&c.cancel(),this.hide(),b.pageManager.back()),!0}}),this.mainPage=this.pageManager.main(new d({visible:!0,active:!0,manager:this.pageManager,infoFilm:this.quickInfo,handle:document.getElementById("main-page"),header:this.header,footer:this.footer})),this.detailsPage=this.pageManager.addPage(new q({manager:this.pageManager,handle:document.getElementById("details-page"),events:{showPlayer:function(a){b.playerPage.show(a)}},header:this.header,footer:this.footer})),this.genrePage=this.pageManager.addPage(new e({manager:this.pageManager,infoFilm:this.quickInfo,handle:document.getElementById("genre-page"),header:this.header,footer:this.footer})),this.playerPage=this.pageManager.addPage(new s({manager:this.pageManager,handle:document.getElementById("player-page"),header:this.header,footer:this.footer,events:{error:function(a){this.manager.back(),b.splashScreen.hide(),b.showError(a)},updateHistory:function(){u.isAuthorized()&&(b.mainPage.updateHistory(),b.profilePage.updateHistory())}}})),this.agreementsPage=this.pageManager.addPage(new h({header:this.header,footer:this.footer,manager:this.pageManager,handle:document.getElementById("agreements-page")})),this.searchPage=this.pageManager.addPage(new f({active:!0,manager:this.pageManager,handle:document.getElementById("search-page"),header:this.header,footer:this.footer})),this.profilePage=this.pageManager.addPage(new g({active:!0,manager:this.pageManager,handle:document.getElementById("profile-page"),header:this.header,footer:this.footer})),this.sortedPage=this.pageManager.addPage(new i({active:!0,manager:this.pageManager,handle:document.getElementById("sorted-page"),quickInfo:this.quickInfo,header:this.header,footer:this.footer})),a=document.getElementById("exit-modal"),this.exitModal=new m({owner:this,handle:a,visible:!1,active:!1,template:!1,exitBtnHandle:".close",buttonsHandle:".buttons",buttons:[this.exitBtn=new o({handle:a.querySelector(".btn_modal.exit"),template:!1,active:!0,action:function(){t.stop(),window.location=w.getUrlParameters("referrer")}}),new o({handle:a.querySelector(".btn_modal.cancel"),template:!1,action:function(){b.exitModal.hide()}})],events:{show:function(){b.exitBtn.activate()}}}),this.errorModal=new m({owner:this,handle:document.getElementById("error-modal"),visible:!1,model:{data:{title:"Ошибка",text:"Что-то не так, пожалуйста повторите попытку позже."},view:{handle:document.getElementById("error-modal"),template:!0}},active:!1,exitBtnHandle:".close",eventHandler:function(a){return(a.code===x.OK||a.code===x.EXIT)&&this.hide(),!0}}),this.sortRatingModal=new n({owner:this,handle:document.getElementById("sort-rating-modal"),list:[{title:"КиноПоиск",sort:"kp"},{title:"IMDb",sort:"imdb"},{title:"ivi.ru",sort:"ivi"}],events:{enter:function(){this.hide()}}}),this.sortBudgetModal=new n({owner:this,handle:document.getElementById("sort-budget-modal"),list:[{title:"по бюджету",sort:"budget"},{title:"по сборам",sort:"boxoffice"}],events:{enter:function(){this.hide()}}}),u.on("authorized",function(){var a=v.get("email"),b=v.get("password");(a!==this.get("email")||b!==this.get("password"))&&(v.set("email",this.get("email")),v.set("password",this.get("password")),v.set("uid",this.generateUID()),v.save())}),u.on("authError",function(){b.showError("Неверное имя пользователя или пароль")}),u.on("reqError",function(){b.showError("Ошибка связи. Пожалуйста повторите попытку позже")}),u.on("logout",function(){v.remove("email"),v.remove("password"),v.set("uid",this.generateUID()),v.set("videoQuality","hi"),v.save()}),v.once("load",function(){var a,b;this.get("uid")||this.set("uid",u.generateUID()),(a=this.get("email"))&&(b=this.get("password"))&&u.authorize(a,b)}),v.load()}var c=a("lib/application"),d=a("pages/main"),e=a("pages/genre"),f=a("pages/search"),g=a("pages/profile"),h=a("pages/agreements"),i=a("pages/sorted"),j=a("components/header"),k=a("components/footer"),l=a("components/menu"),m=a("modals/modal"),n=a("modals/list"),o=a("components/button"),p=a("modals/authorization"),q=a("pages/details"),r=a("components/quickinfo"),s=a("pages/player"),t=a("lib/player"),u=a("models/user"),v=a("./config"),w=a("lib/tools"),x=a("lib/keys");b.prototype=Object.create(c.prototype),b.prototype.constructor=b,b.prototype.showError=function(a){this.errorModal.model.set("text",a),this.errorModal.show()},b.prototype.eventHandler=function(a){if(c.prototype.eventHandler.call(this,a)===!0)return!0;switch(a.code){case x.MENU:return this.showMenu(),!0;case x.EXIT:return this.exit(),!0}return!1},b.prototype.showMenu=function(){this.menu.show()},b.prototype.exit=function(){this.exitModal.show()},window.moveTo(0,0),window.resizeTo(screen.width,screen.height),window.onload=function(){var a,c,d,e=["img/bg_black_50.png","img/bg_black_85.png","img/bg_red_50.png","img/bg_white_30.png","img/menu_bg.jpg","img/menu_bg2.jpg"],f=["loading_ani.gif","arrow_bottom.png","arrow_left.png","arrow_right.png","arrow_top.png","avatar_female.png","avatar_male.png","btn_arrow_close.png","btn_arrow_open.png","btn_back.png","btn_exit.png","btn_f1.png","btn_f2.png","btn_f3.png","btn_f4.png","btn_ffwd.png","btn_ffwd_focused.png","btn_focused.png","btn_frame.png","btn_info.png","btn_kb_del.png","btn_kb_del_focused.png","btn_kb_left.png","btn_kb_left_focused.png","btn_kb_right.png","btn_kb_right_focused.png","btn_kb_shift.png","btn_kb_shift_focused.png","btn_kb_space.png","btn_kb_space_focused.png","btn_menu_focused.png","btn_menu_normal.png","btn_normal.png","btn_pause.png","btn_pause_focused.png","btn_play.png","btn_play_focused.png","btn_popup.png","btn_popup_focused.png","btn_rew.png","btn_rew_focused.png","button_focused.png","button_normal.png","header_bg.png","header_logo.png","modal_bg.png","modal_close.png","modal_list.png","promo_preview.png","quickinfo_bg.png","row_active.png","thumb.png","thumb_focused.png","video-preview.png"];for(d=screen.height>=576?screen.height:576,a=0,c=f.length;c>a;a++)e.push("img/"+d+"/"+f[a]);w.imageLoader(e,function(){window.ivi=new b,document.body.classList.remove("invisible")}),gSTB.EnableServiceButton(!1),gSTB.EnableVKButton(!1),gSTB.EnableAppButton(!1),gSTB.EnableTvButton(!1),document.body.addEventListener("click",function(a){a.stopPropagation(),a.stopImmediatePropagation(),a.preventDefault()})}},{"./config":39,"components/button":"+xiQfc","components/footer":"SHo47G","components/header":"zExk/C","components/menu":"iHD9HF","components/quickinfo":"uFvIi8","lib/application":"8NvQGu","lib/keys":"iIRFqq","lib/player":"LZDS0b","lib/tools":"AjqgZI","modals/authorization":"UgnP4x","modals/list":"/X0zSk","modals/modal":"BjgSXc","models/user":"QAloAk","pages/agreements":"u2t6GX","pages/details":"PcF5dW","pages/genre":"VmX1kv","pages/main":"leTyfk","pages/player":"JjW+Ru","pages/profile":"B3R0cH","pages/search":"sZ0N3q","pages/sorted":"K/khU5"}],fqWis0:[function(a,b){"use strict";function c(a){this.defaults={autoload:!1,params:{}},d.call(this,e.defaults(a,this.defaults)),this.autoload===!0&&this.fetch(),this.fetching=!1}var d=a("./collection"),e=a("./tools");c.prototype=Object.create(d.prototype),c.prototype.constructor=c,c.prototype.fetch=function(a){var b=this;this.url&&(this.fetching=!0,this.emit("request"),this.request=e.ajax({url:this.url,data:a||this.getParameters(),method:"GET",success:function(a){a="function"==typeof b.parse?b.parse(a):a,b.models(a),b.fetching=!1,b.emit("fetch",a)}}))},c.prototype.abort=function(){this.request&&this.request.abort()},c.prototype.setParameter=function(a,b){this.params[a]=b},c.prototype.setParameters=function(a){for(var b in a)a.hasOwnProperty(b)&&this.setParameter(b,a[b])},c.prototype.getParameter=function(a){return this.params[a]},c.prototype.getParameters=function(){return this.params},b.exports=c},{"./collection":"Ou0jNv","./tools":"AjqgZI"}],"lib/ajax.collection":[function(a,b){b.exports=a("fqWis0")},{}],"/TtyQ3":[function(a,b){"use strict";function c(a){d.call(this,a)}var d=a("./model"),e=a("./tools");c.prototype=Object.create(d.prototype),c.prototype.constructor=c,c.prototype.save=function(){var a=this;this.url&&e.ajax({url:this.url,method:a._data[a.idName]?"put":"post",data:a.pack(),onload:function(b){b=a.unpack(a.parse(b)),a.attributes(b),console.log(b),a.emit("save",!0)},onerror:this.saveFailure,ontimeout:this.saveFailure})},b.exports={}},{"./model":"blv/2e","./tools":"AjqgZI"}],"lib/ajax.model":[function(a,b){b.exports=a("/TtyQ3")},{}],"lib/application":[function(a,b){b.exports=a("8NvQGu")},{}],"8NvQGu":[function(a,b){"use strict";function c(a){var b=this;this.defaults={name:"Application",pages:{},pageManager:{pages:a.pages},components:{},models:{},collections:{},_events:new Object(null),activeChild:null,activeModal:null,activeModals:[]},l.extend(this,l.defaults(a,this.defaults)),this.addHash("components",i,this.components),this.addHash("models",h,this.models),this.addHash("collections",e,this.collections),this.events&&this.bindAll(this.events),this.eventExclusions=[k.MENU,k.LEFT,k.RIGHT,k.UP,k.DOWN,k.OK,k.PAGE_DOWN,k.PAGE_UP,k.BACK,k.CHANNEL_NEXT,k.CHANNEL_PREV],this.setPageManager(this.pageManager),j.init(["keydown","input"]),j.on("keydown",function(a){l.prepareEvent(a),-1!==b.eventExclusions.indexOf(a.code)&&a.preventDefault(),a.code&&b.emit("keydown",a)}),this.on("keydown",function(a){b.eventHandler(a)})}var d=a("./page.manager"),e=a("./collection"),f=a("./emitter"),g=a("./thash"),h=a("./model"),i=a("./cbase"),j=a("./listener"),k=a("./keys"),l=a("./tools");c.prototype.addHash=function(a,b,c){this[a]=new g({type:b,data:c})},c.prototype.setPageManager=function(a){a instanceof d||(a=new d(a)),this.pageManager=a},c.prototype.eventHandler=function(a){return this.activeModal&&"function"==typeof this.activeModal.eventHandler&&this.activeModal.eventHandler(a)===!0?!0:this.activeChild&&"function"==typeof this.activeChild.eventHandler&&this.activeChild.eventHandler(a)===!0?!0:this.pageManager.eventHandler(a)},f.inject(c),b.exports=c},{"./cbase":"tTNRm4","./collection":"Ou0jNv","./emitter":"P7cBNP","./keys":"iIRFqq","./listener":"0gs5AI","./model":"blv/2e","./page.manager":"O89K3x","./thash":"mtNT1s","./tools":"AjqgZI"}],tTNRm4:[function(a,b){"use strict";function c(a){if(this.defaults={name:"CBase",view:{handle:a.handle,owner:this,template:a.template||null},activated:!0,model:null,data:null,modal:!1,modelType:f,dataType:f,events:{},viewType:e,owner:null,handle:null,active:!1,visible:!0,saveDefaultView:!1,activeChild:null,activeModal:null,activeModals:[],components:new Object(null)},g.extend(this,g.defaults(a,this.defaults)),!this.handle||!this.handle.nodeName)throw"Wrong handle in "+this.name+" component.";this._events=Object(null),this.bindAll(this.events),this.model&&this.setModel(this.model),this.setView(this.view),this.visible===!0?this.show():this.hide(),this.setOwner(this.owner),this.active===!0&&this.activate(!0),this._startedActions=0,this.trigger("init")}var d=a("./emitter"),e=a("./view"),f=a("./model"),g=a("./tools");c.prototype.setView=function(a){var b=this;a instanceof e||(a.model=this.model,a=new this.viewType(a)),this.view=a,this.view.bindAll({show:function(){b.emit("show")},hide:function(){b.emit("hide")},click:function(){b.emit("click"),b.activate()}})},c.prototype.setModel=function(a){this.model instanceof f&&this.model.clear(),a instanceof f||!this.model||(a=new this.modelType(a)),this.model=a,this.view&&"function"==typeof this.view.setModel&&this.view.setModel(this.model),this.emit("setModel",a)},c.prototype.setData=function(a){this.data&&"function"==typeof this.data.clear&&this.data.clear(),a instanceof this.dataType||!this.data||(a=new this.dataType(a)),this.data=a,this.view&&"function"==typeof this.view.setData&&this.view.setData(this.model),this.emit("setData",a)},c.prototype.addComponent=function(a){a&&(a.owner=this,this.components[a.name]=a,a.previousComponent=this._lastAdded,this._lastAdded&&(this._lastAdded.nextComponent=a),this._lastAdded=a,a.isActive()&&a.activate(!0),this.emit("addComponent",a))},c.prototype.getComponent=function(a){return this.components[a]},c.prototype.activate=function(a){this.isActive()&&!a||this.activated===!1||!this.isVisible()||(this.active=!0,this.emit("activate"),this.handle.classList.add("active"),this.owner&&(this.modal===!0?(this.owner.activeModal=this,this.owner.activeModals.push(this)):(this.owner.activeChild&&this.owner.activeChild!==this&&this.owner.activeChild.deactivate(),this.owner.activeChild=this)))},c.prototype.deactivate=function(){if(this.isActive()&&this.activated!==!1&&(this.active=!1,this.emit("deactivate"),this.handle.classList.remove("active"),this.owner))if(this.modal){var a;this.owner.activeModals.pop(),a=this.owner.activeModals[this.owner.activeModals.length-1],this.owner.activeModal=a}else this.owner.activeChild=null},c.prototype.isActive=function(){return this.active===!0},c.prototype.setOwner=function(a){a instanceof c&&(this.owner=a,this.emit("setOwner",a))},c.prototype.show=function(){this.view.show()},c.prototype.hide=function(){this.view.hide()},c.prototype.toggle=function(){this.view.toggle()},c.prototype.isVisible=function(){return this.view.isVisible()},c.prototype.clear=function(){g.extend(this,this.defaults)},c.prototype.startAction=function(a){0===this._startedActions++&&this.emit("startChanges"),this.emit("startAction",this._startedActions)},c.prototype.endAction=function(a){0===--this._startedActions&&this.emit("allReady"),this.emit("endAction",this._startedActions)},c.prototype.eventHandler=function(){return!1},d.inject(c),b.exports=c},{"./emitter":"P7cBNP","./model":"blv/2e","./tools":"AjqgZI","./view":"kWfdrx"}],"lib/cbase":[function(a,b){b.exports=a("tTNRm4")},{}],"lib/collection":[function(a,b){b.exports=a("Ou0jNv")},{}],Ou0jNv:[function(a,b){"use strict";function c(a){this._data=[],this._ids={},this.defaults={modelType:d,viewType:f,url:null,data:null,prepare:null,idName:"id"},g.extend(this,g.defaults(a||{},this.defaults)),this._events=new Object(null),this.events&&this.onAll(this.events),this.view&&this.setView(this.view),this.data&&this.models(this.data)}var d=a("./model"),e=a("./emitter"),f=a("./collection.view"),g=a("./tools");c.prototype.clear=function(){for(;this._data[0];)this.remove(this._data[0]);this._data=[],this._ids={},this.emit("clear")},c.prototype.models=function(a){var b=0;if(Array.isArray(a))for(this.clear();b<a.length;b++)this.add(a[b]);return this.emit("models",{models:this._data}),this._data},c.prototype.add=function(a){return a instanceof d||null===this.modelType||(a=new this.modelType({data:a})),this._ids[a.get(this.idName)]=a,this._data.push(a),this.emit("add",{model:a,index:this._data.length-1}),this.emit("changed",{event:"add",model:a,index:this._data.length}),a},c.prototype.addAll=function(a){var b=0;if(Array.isArray(a))for(;b<a.length;b++)this.add(a[b]);return this._data},c.prototype.insert=function(a,b){return a instanceof d||(a=new this.modelType({data:a})),this._ids[a.get(a.idName)]=a,this._data.splice(b,0,a),this.emit("add",{model:a,index:b}),this.emit("changed",{event:"add",model:a,index:b}),a},c.prototype.remove=function(a){var b=this.indexOf(a);return b>-1?("function"==typeof a.removeALlListeners&&a.removeAllListeners(),this.splice(b,1),delete this._ids[a.get("id")],this.emit("remove",{index:b,model:a}),this.emit("changed",{event:"remove",index:b,model:a}),a):null},c.prototype.removeAt=function(a){var b=this._data[a];return void 0!==b?(b.removeAllListeners(),this._data.splice(a,1),delete this._ids[b.get("id")],this.emit("remove",{index:a,model:b}),this.emit("changed",{event:"remove",index:a,model:b}),b):null},c.prototype.at=function(a){return this._data[a]},c.prototype.get=function(a){return this._ids[a]},c.prototype.getData=function(){return this._data},c.prototype.getArray=function(){var a,b=[];for(a=0;a<this._data.length;a++)b.push(this._data[a].getAll());return b},["filter","forEach","every","map","some","indexOf","slice","splice"].forEach(function(a){c.prototype[a]=function(){return Array.prototype[a].apply(this._data,arguments)}}),c.prototype.sort=function(a){this._data.sort(a),this.emit("sort")},c.prototype.setView=function(a){a instanceof this.viewType||(a.collection=this,a=new this.viewType(a)),this.view=a},c.prototype.first=function(a){if("function"==typeof a){for(var b=0;b<this._data.length;b++)if(a(this._data[b]))return this._data[b];return null}return this._data[0]},c.prototype.last=function(a){if("function"==typeof a){for(var b=this._data.length-1;b>=0;b--)if(a(this._data[b]))return this._data[b];return null}return this._data[this._data.length-1]},Object.defineProperty(c.prototype,"length",{get:function(){return this._data.length}}),e.inject(c),b.exports=c},{"./collection.view":"eoasPR","./emitter":"P7cBNP","./model":"blv/2e","./tools":"AjqgZI"}],eoasPR:[function(a,b){"use strict";function c(a){var b=this;this.defaults={collection:null,template:!0,watch:!1},d.call(this,f.defaults(a,this.defaults)),this.collection&&this.setCollection(this.collection),this.autoRender===!0&&null!==this.template&&this.update(),this.collection.on("add",function(a){var c=b.template.compile();a.model.setView({handle:c.element,compiled:c,template:b.template,watch:b.watch})}),this.watch===!0&&(this.watcher=new e(this.collection),this.watcher.on("watch",function(a){b.update(a)}),this.watcher.watch())}var d=a("./tview"),e=a("./watcher"),f=a("./tools");c.prototype=Object.create(d.prototype),c.prototype.constructor=c,c.prototype.setCollection=function(a,b){this.collection=a,this.watcher&&this.watcher.setData(a).watch(),b!==!1&&this.refresh()},c.prototype.update=function(a){var b;if(a.model&&a.model.view)switch(a.event){case"add":b=this.collection.at(a.index+1),b?a.model.view.insertBefore(b.view):this.appendChild(a.model.view);break;case"remove":a.model.view&&a.model.view.remove()}},c.prototype.refresh=function(){var a,b=this;this.collection.forEach(function(c){a=b.template.compile(),c.setView({handle:a.element,compiled:a,model:c,template:b.template,watch:b.watch}),b.appendChild(c.view)})},b.exports=c},{"./tools":"AjqgZI","./tview":"r32W0Q","./watcher":"/tW+0Y"}],"lib/collection.view":[function(a,b){b.exports=a("eoasPR")},{}],B6eAZ7:[function(a,b){"use strict";function c(a){var b=this;this.defaults={name:"CPage",active:!1,visible:!1,manager:null,dynamic:!1,header:null,footer:null,arrows:null},d.call(this,g.defaults(a,this.defaults)),this.scroller=new e({container:this.handle}),this.header&&this.setHeader(this.header),this.footer&&this.setFooter(this.footer),this.active===!0&&this.activate(),this.arrows&&this.setArrows(this.arrows),this.on("addComponent",function(a){a.on("activate",function(){b.scroller.show(a.handle)})})}var d=a("./cpanel"),e=a("./scroller"),f=a("lib/keys"),g=a("./tools");c.prototype=Object.create(d.prototype),c.prototype.constructor=c,c.prototype.show=function(a,b){this.manager?(this.manager.show(this,a,b),this.emit("show")):d.prototype.show.call(this)},c.prototype.hide=function(){this.manager?(this.manager.hide(this),this.deactivate(),this.emit("hide")):d.prototype.hide.call(this)},c.prototype.setHeader=function(a){a instanceof d||this.on("activate",function(){null!==this.header&&this.header.deactivate()}),this.header=a},c.prototype.setFooter=function(a){a instanceof d||this.on("activate",function(){null!==this.footer&&this.footer.deactivate()}),this.footer=a},c.prototype.setArrows=function(a){var b=this;"string"==typeof a.previous&&(a.previous=this.handle.querySelector(a.previous)),"string"==typeof a.next&&(a.next=this.handle.querySelector(a.next)),a.previous.addEventListener("click",function(){b.movePrevious()}),a.next.addEventListener("click",function(){b.moveNext()})},c.prototype.eventHandler=function(a){if(this.activeModal&&"function"==typeof this.activeModal.eventHandler&&this.activeModal.eventHandler(a)===!0)return!0;switch(a.code){case f.EXIT:return void 0!==this.manager.back()}return d.prototype.eventHandler.call(this,a)},b.exports=c},{"./cpanel":"ySbxUr","./scroller":"8+NRr9","./tools":"AjqgZI","lib/keys":"iIRFqq"}],"lib/cpage":[function(a,b){b.exports=a("B6eAZ7")},{}],ySbxUr:[function(a,b){"use strict";function c(a){this.defaults={name:"CPanel"},d.call(this,e.defaults(a,this.defaults)),this.components&&this.addComponents(this.components)}var d=a("lib/cbase"),e=a("lib/tools"),f=a("lib/keys");c.prototype=Object.create(d.prototype),c.prototype.constructor=c,c.prototype.addComponents=function(a){for(var b=0;b<a.length;b++)this.addComponent(a[b])},c.prototype.findNextComponent=function(a){return a&&a.nextComponent?a.nextComponent.activated!==!1?a.nextComponent:this.findNextComponent(a.nextComponent):null},c.prototype.findPreviousComponent=function(a){return a&&a.previousComponent?a.previousComponent.activated!==!1?a.previousComponent:this.findPreviousComponent(a.previousComponent):null},c.prototype.moveNext=function(){var a=this.findPreviousComponent(this.activeChild);return null===a?!1:(a.activate(),!0)},c.prototype.movePrevious=function(){var a=this.findNextComponent(this.activeChild);return null===a?!1:(a.activate(),!0)},c.prototype.eventHandler=function(a){if(this.activeChild&&"function"==typeof this.activeChild.eventHandler&&this.activeChild.eventHandler(a)===!0)return!0;var b=f.UP,c=f.DOWN;switch("horizontal"===this.navigation&&(b=f.LEFT,c=f.RIGHT),a.code){case b:return this.moveNext();case c:return this.movePrevious()}return!1},b.exports=c},{"lib/cbase":"tTNRm4","lib/keys":"iIRFqq","lib/tools":"AjqgZI"}],"lib/cpanel":[function(a,b){b.exports=a("ySbxUr")},{}],"lib/dom":[function(a,b){b.exports=a("CBUzS7")},{}],CBUzS7:[function(a,b){b.exports=function(){"use strict";var a={};return a.clear=function(a){return a instanceof Node&&(a.innerHTML=""),a},a.remove=function(a){a instanceof Node&&a.parentNode instanceof Node&&a.parentNode.removeChild(a)},a.tag=function(a,b){var c,d="object"==typeof b&&null!==b?Object.keys(b):[],e=null;if(a){for(e=document.createElement(a),c=0;c<d.length;c++)e[d[c]]=b[d[c]];for(c=2;c<arguments.length;c++)if(arguments[c]instanceof HTMLCollection)for(;arguments[c][0];)e.appendChild(arguments[c][0]);else e.appendChild(arguments[c]instanceof Node?arguments[c]:document.createTextNode(arguments[c]))}return e},a.fragment=function(){var a,b=document.createDocumentFragment();for(a=0;a<arguments.length;a++)if(arguments[a])if(arguments[a]instanceof Node)b.appendChild(arguments[a]);else if(arguments[a]instanceof HTMLCollection)for(;arguments[a].length;)b.appendChild(arguments[a][0]);else b.appendChild(document.createTextNode(arguments[a]));return b},a.add=function(a){var b;if(a instanceof Node)for(b=1;b<arguments.length;b++)arguments[b]&&a.appendChild(arguments[b]instanceof Node?arguments[b]:document.createTextNode(arguments[b]));return a},a.addChild=function(b,c){var d;if(b&&c)if(c.nodeType)d=b.appendChild(c);else if(Array.isArray(c)){d=[];for(var e=0;e<c.length;e++)d.push(a.addChild(b,c[e]))}else d=b.appendChild(document.createTextNode(c));return d},a.value=function(a,b){switch(a.tagName.toLowerCase()){case"img":a.src=b;break;case"input":a.value=b;break;default:a.innerHTML=b}},a.show=function(a){a.classList&&a.classList.remove("hidden")},a.hide=function(a){a.classList&&a.classList.add("hidden")},a.toggle=function(a){a.classList&&a.classList.toggle("hidden")},a.isVisible=function(a){return a.classList?!a.classList.contains("hidden"):void 0},a}()},{}],P7cBNP:[function(a,b){"use strict";var c=a("./tools"),d={addListener:function(a,b){return this._events[a]=this._events[a]||[],this._events[a].push(b),this},addListeners:function(a){var b,c;for(b in a)if(a.hasOwnProperty(b))if(Array.isArray(a[b]))for(c=0;c<a[b].length;c++)this.addListener(b,a[b][c]);else this.addListener(b,a[b]);return this},removeListener:function(a,b){return Array.isArray(this._events[a])&&(this._events[a]=this._events[a].filter(function(a){return a!==b}),0===this._events[a].length&&delete this._events[a]),this},removeAllListeners:function(a){return 0===arguments.length?this._events=Object.create(null):1===arguments.length&&delete this._events[a],this},emit:function(a,b){var c,d;if(Array.isArray(this._events[a]))for(d=this._events[a].slice(),c=0;c<d.length;c++)d[c].call(this,b);return this},once:function(a,b){var c=this;return this.addListener(a,function d(e){c.removeListener(a,d),b.call(c,e)}),this},inject:function(a){"function"==typeof a?(a.prototype._events=Object.create(null),c.extend(a.prototype,this)):"object"==typeof a&&(a._events=Object.create(null),c.extend(a,this))}};d.on=d.bind=d.addListener,d.trigger=d.emit,d.unbind=d.off=d.removeListener,d.unbindAll=d.offAll=d.removeAllListeners,d.onAll=d.bindAll=d.addListeners,b.exports=d},{"./tools":"AjqgZI"}],"lib/emitter":[function(a,b){b.exports=a("P7cBNP")},{}],"lib/jsondb":[function(a,b){b.exports=a("NhVVdj")},{}],NhVVdj:[function(a,b){"use strict";function c(a){this.data=a||{}}function d(a){this.data=a||{}}c.prototype.table=function(a){return a?("object"!=typeof this.data[a]&&(this.data[a]={}),new d(this.data[a])):!1},d.prototype.init=function(){if(arguments.length>0){this.data.rows={},this.data.idName=Array.prototype.shift.call(arguments),this.data.rowIdx=0,this.data.fldIds=[],this.data.fldIdx={};for(var a=0;a<arguments.length;a++)this.data.fldIds[a]=arguments[a],this.data.fldIdx[arguments[a]]=a;return!0}return!1},d.prototype.genId=function(){return(++this.data.rowIdx).toString()},d.prototype.add=function(a){var b,c=[];if(a&&void 0===this.data.rows[a]){for(b=0;b<this.data.fldIds.length;b++)c[b]=void 0!==arguments[b+1]?arguments[b+1]:null;return this.data.rows[a]=c,!0}return!1},d.prototype.get=function(a,b){var c,d=this.data.rows[a],e={};if(void 0!==d){if(void 0===b){for(e[this.data.idName]=a.toString(),c=0;c<d.length;c++)e[this.data.fldIds[c]]=d[c];return e}if(b in this.data.fldIdx)return d[this.data.fldIdx[b]]}return!1},d.prototype.set=function(a,b){var c,d,e=[];if(a&&b&&"object"==typeof b){if(void 0===this.data.rows[a]){for(c=0;c<this.data.fldIds.length;c++)e[c]=null;this.data.rows[a]=e}else e=this.data.rows[a];for(d in b)d in this.data.fldIdx&&(e[this.data.fldIdx[d]]=b[d]);return!0}return!1},d.prototype.unset=function(a){return delete this.data.rows[a]},d.prototype.clear=function(){this.data.rows={},this.data.rowIdx=0},d.prototype.find=function(a,b){var c,d,e,f,g,h=this.data.rows,i=[];if(a&&"object"==typeof a)for(d in h)if(h.hasOwnProperty(d)){f=!0;for(e in a)a.hasOwnProperty(e)&&(f=f&&h[d][this.data.fldIdx[e]]===a[e]);if(f){for(c={},c[this.data.idName]=d,g=0;g<h[d].length;g++)c[this.data.fldIds[g]]=h[d][g];if(i.push(c),void 0!==b&&b===i.length)return i}}return i},b.exports=c},{}],iIRFqq:[function(a,b){"use strict";b.exports={BACK:8,NUM1:49,NUM2:50,NUM3:51,NUM4:52,NUM5:53,NUM6:54,NUM7:55,NUM8:56,NUM9:57,NUM0:48,DELETE:46,CHANNEL_PREV:1009,CHANNEL_NEXT:9,OK:13,EXIT:27,UP:38,DOWN:40,LEFT:37,RIGHT:39,PAGE_UP:33,PAGE_DOWN:34,END:35,HOME:36,VOLUME_UP:107,VOLUME_DOWN:109,F1:112,F2:113,F3:114,F4:115,REFRESH:116,FRAME:117,PHONE:119,SET:120,TV:121,MENU:122,WEB:123,MIC:2032,REWIND:2066,FORWARD:2070,APP:2076,USB_MOUNTED:2080,USB_UNMOUNTED:2081,PLAY_PAUSE:2082,STOP:2083,POWER:2085,RECORD:2087,INFO:2089,MUTE:2192,CLOCK:2032,AUDIO:2071}},{}],"lib/keys":[function(a,b){b.exports=a("iIRFqq")},{}],"lib/listener":[function(a,b){b.exports=a("0gs5AI")},{}],"0gs5AI":[function(a,b){"use strict";var c=a("./emitter"),d={init:function(a){if(this._events=new Object(null),a)for(var b=0;b<a.length;b++)this.listen(a[b])},listen:function(a){var b=this;return document.body.addEventListener(a,function(c){b.emit(a,c)}),this}};c.inject(d),b.exports=d},{"./emitter":"P7cBNP"}],"lib/local.model":[function(a,b){b.exports=a("ieUPCh")},{}],ieUPCh:[function(a,b){"use strict";function c(a){this.defaults={name:"LocalModel",autoLoad:!1,savedFields:[]},d.call(this,e.defaults(a,this.defaults)),this.autoLoad&&this.load()}var d=a("lib/model"),e=a("lib/tools");c.prototype=Object.create(d.prototype),c.prototype.constructor=c,c.prototype.save=function(){var a,b,c=this.getAll(),d=Object.keys(c);for(a=d.length;a;)b=d[--a],-1===this.savedFields.indexOf(b)&&delete c[b];gSTB.SaveUserData(this.name,JSON.stringify(c))},c.prototype.load=function(){var a={};try{a=JSON.parse(gSTB.LoadUserData(this.name)||"{}")}catch(b){}this.setAll(a),this.emit("load")},b.exports=c},{"lib/model":"blv/2e","lib/tools":"AjqgZI"}],aQJBiS:[function(a,b,c){var d="undefined"!=typeof self?self:"undefined"!=typeof window?window:{};b.exports=function(a){"use strict";function e(a,b,c){b||(b=0),"undefined"==typeof c&&(c=a?a.length:0);for(var d=-1,e=c-b||0,f=Array(0>e?0:e);++d<e;)f[d]=a[b+d];return f}function f(){}function g(a){function b(){if(d){var a=d.slice();Y.apply(a,arguments)}if(this instanceof b){var f=h(c.prototype),g=c.apply(f,a||arguments);return q(g)?g:f}return c.apply(e,a||arguments)}var c=a[0],d=a[2],e=a[4];return fb(b,a),b}function h(a){return q(a)?_(a):{}}function i(a,b,c){if("function"!=typeof a)return t;if("undefined"==typeof b||!("prototype"in a))return a;var d=a.__bindData__;if("undefined"==typeof d&&(db.funcNames&&(d=!a.name),d=d||!db.funcDecomp,!d)){var e=W.call(a);db.funcNames||(d=!w.test(e)),d||(d=x.test(e),fb(a,d))}if(d===!1||d!==!0&&1&d[1])return a;switch(c){case 1:return function(c){return a.call(b,c)};case 2:return function(c,d){return a.call(b,c,d)};case 3:return function(c,d,e){return a.call(b,c,d,e)};case 4:return function(c,d,e,f){return a.call(b,c,d,e,f)}}return s(a,b)}function j(a){function b(){var a=l?i:this;if(f){var r=f.slice();Y.apply(r,arguments)}if((g||n)&&(r||(r=e(arguments)),g&&Y.apply(r,g),n&&r.length<k))return d|=16,j([c,o?d:-4&d,r,null,i,k]);
if(r||(r=arguments),m&&(c=a[p]),this instanceof b){a=h(c.prototype);var s=c.apply(a,r);return q(s)?s:a}return c.apply(a,r)}var c=a[0],d=a[1],f=a[2],g=a[3],i=a[4],k=a[5],l=1&d,m=2&d,n=4&d,o=8&d,p=c;return fb(b,a),b}function l(a,b,c,d,e,f){var h=1&b,i=2&b,k=4&b,m=16&b,n=32&b;if(!i&&!p(a))throw new TypeError;m&&!c.length&&(b&=-17,m=c=!1),n&&!d.length&&(b&=-33,n=d=!1);var o=a&&a.__bindData__;if(o&&o!==!0)return o=o.slice(),!h||1&o[1]||(o[4]=e),!h&&1&o[1]&&(b|=8),!k||4&o[1]||(o[5]=f),m&&Y.apply(o[2]||(o[2]=[]),c),n&&Y.apply(o[3]||(o[3]=[]),d),o[1]|=b,l.apply(null,o);var q=1==b||17===b?g:j;return q([a,b,c,d,e,f])}function m(){K.shadowedProps=y,K.array=K.bottom=K.loop=K.top="",K.init="iterable",K.useHas=!0;for(var a,b=0;a=arguments[b];b++)for(var c in a)K[c]=a[c];var d=K.args;K.firstArg=/^[^,]+/.exec(d)[0];var e=Function("baseCreateCallback, errorClass, errorProto, hasOwnProperty, indicatorObject, isArguments, isArray, isString, keys, objectProto, objectTypes, nonEnumProps, stringClass, stringProto, toString","return function("+d+") {\n"+eb(K)+"\n}");return e(i,D,R,X,v,n,gb,r,K.keys,S,L,cb,I,T,U)}function n(a){return a&&"object"==typeof a&&"number"==typeof a.length&&U.call(a)==z||!1}function o(a,b){var c=h(a);return b?kb(c,b):c}function p(a){return"function"==typeof a}function q(a){return!(!a||!L[typeof a])}function r(a){return"string"==typeof a||a&&"object"==typeof a&&U.call(a)==I||!1}function s(a,b){return arguments.length>2?l(a,17,e(arguments,2),null,b):l(a,1,null,null,b)}function t(a){return a}function u(){}var v={},w=/^\s*function[ \n\r\t]+\w/,x=/\bthis\b/,y=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],z="[object Arguments]",A="[object Array]",B="[object Boolean]",C="[object Date]",D="[object Error]",E="[object Function]",F="[object Number]",G="[object Object]",H="[object RegExp]",I="[object String]",J={configurable:!1,enumerable:!1,value:null,writable:!1},K={args:"",array:null,bottom:"",firstArg:"",init:"",keys:null,loop:"",shadowedProps:null,support:null,top:"",useHas:!1},L={"boolean":!1,"function":!0,object:!0,number:!1,string:!1,undefined:!1},M=L[typeof a]&&a||this,N=L[typeof c]&&c&&!c.nodeType&&c,O=L[typeof b]&&b&&!b.nodeType&&b,P=L[typeof d]&&d;!P||P.global!==P&&P.window!==P||(M=P);var Q=[],R=Error.prototype,S=Object.prototype,T=String.prototype,U=S.toString,V=RegExp("^"+String(U).replace(/[.*+?^${}()|[\]\\]/g,"\\$&").replace(/toString| for [^\]]+/g,".*?")+"$"),W=Function.prototype.toString,X=S.hasOwnProperty,Y=Q.push,Z=S.propertyIsEnumerable,$=function(){try{var a={},b=V.test(b=Object.defineProperty)&&b,c=b(a,a,a)&&b}catch(d){}return c}(),_=V.test(_=Object.create)&&_,ab=V.test(ab=Array.isArray)&&ab,bb=V.test(bb=Object.keys)&&bb,cb={};cb[A]=cb[C]=cb[F]={constructor:!0,toLocaleString:!0,toString:!0,valueOf:!0},cb[B]=cb[I]={constructor:!0,toString:!0,valueOf:!0},cb[D]=cb[E]=cb[H]={constructor:!0,toString:!0},cb[G]={constructor:!0},function(){for(var a=y.length;a--;){var b=y[a];for(var c in cb)X.call(cb,c)&&!X.call(cb[c],b)&&(cb[c][b]=!1)}}();var db=f.support={};!function(){var a=function(){this.x=1},b={0:1,length:1},c=[];a.prototype={valueOf:1,y:1};for(var d in new a)c.push(d);for(d in arguments);db.argsClass=U.call(arguments)==z,db.argsObject=arguments.constructor==Object&&!(arguments instanceof Array),db.enumErrorProps=Z.call(R,"message")||Z.call(R,"name"),db.enumPrototypes=Z.call(a,"prototype"),db.funcDecomp=!V.test(M.WinRTError)&&x.test(function(){return this}),db.funcNames="string"==typeof Function.name,db.nonEnumArgs=0!=d,db.nonEnumShadows=!/valueOf/.test(c),db.spliceObjects=(Q.splice.call(b,0,1),!b[0]),db.unindexedChars="x"[0]+Object("x")[0]!="xx"}(1);var eb=function(a){var b="'use strict';\nvar index, iterable = "+a.firstArg+", result = "+a.init+";\nif (!iterable) return result;\n"+a.top+";";a.array?(b+="\nvar length = iterable.length; index = -1;\nif ("+a.array+") {  ",db.unindexedChars&&(b+="\n  if (isString(iterable)) {\n    iterable = iterable.split('')\n  }  "),b+="\n  while (++index < length) {\n    "+a.loop+";\n  }\n}\nelse {  "):db.nonEnumArgs&&(b+="\n  var length = iterable.length; index = -1;\n  if (length && isArguments(iterable)) {\n    while (++index < length) {\n      index += '';\n      "+a.loop+";\n    }\n  } else {  "),db.enumPrototypes&&(b+="\n  var skipProto = typeof iterable == 'function';\n  "),db.enumErrorProps&&(b+="\n  var skipErrorProps = iterable === errorProto || iterable instanceof Error;\n  ");var c=[];if(db.enumPrototypes&&c.push('!(skipProto && index == "prototype")'),db.enumErrorProps&&c.push('!(skipErrorProps && (index == "message" || index == "name"))'),a.useHas&&a.keys)b+="\n  var ownIndex = -1,\n      ownProps = objectTypes[typeof iterable] && keys(iterable),\n      length = ownProps ? ownProps.length : 0;\n\n  while (++ownIndex < length) {\n    index = ownProps[ownIndex];\n",c.length&&(b+="    if ("+c.join(" && ")+") {\n  "),b+=a.loop+";    ",c.length&&(b+="\n    }"),b+="\n  }  ";else if(b+="\n  for (index in iterable) {\n",a.useHas&&c.push("hasOwnProperty.call(iterable, index)"),c.length&&(b+="    if ("+c.join(" && ")+") {\n  "),b+=a.loop+";    ",c.length&&(b+="\n    }"),b+="\n  }    ",db.nonEnumShadows){for(b+="\n\n  if (iterable !== objectProto) {\n    var ctor = iterable.constructor,\n        isProto = iterable === (ctor && ctor.prototype),\n        className = iterable === stringProto ? stringClass : iterable === errorProto ? errorClass : toString.call(iterable),\n        nonEnum = nonEnumProps[className];\n      ",k=0;7>k;k++)b+="\n    index = '"+a.shadowedProps[k]+"';\n    if ((!(isProto && nonEnum[index]) && hasOwnProperty.call(iterable, index))",a.useHas||(b+=" || (!nonEnum[index] && iterable[index] !== objectProto[index])"),b+=") {\n      "+a.loop+";\n    }      ";b+="\n  }    "}return(a.array||db.nonEnumArgs)&&(b+="\n}"),b+=a.bottom+";\nreturn result"};_||(h=function(){function a(){}return function(b){if(q(b)){a.prototype=b;var c=new a;a.prototype=null}return c||M.Object()}}());var fb=$?function(a,b){J.value=b,$(a,"__bindData__",J)}:u;db.argsClass||(n=function(a){return a&&"object"==typeof a&&"number"==typeof a.length&&X.call(a,"callee")&&!Z.call(a,"callee")||!1});var gb=ab||function(a){return a&&"object"==typeof a&&"number"==typeof a.length&&U.call(a)==A||!1},hb=m({args:"object",init:"[]",top:"if (!(objectTypes[typeof object])) return result",loop:"result.push(index)"}),ib=bb?function(a){return q(a)?db.enumPrototypes&&"function"==typeof a||db.nonEnumArgs&&a.length&&n(a)?hb(a):bb(a):[]}:hb,jb={args:"object, source, guard",top:"var args = arguments,\n    argsIndex = 0,\n    argsLength = typeof guard == 'number' ? 2 : args.length;\nwhile (++argsIndex < argsLength) {\n  iterable = args[argsIndex];\n  if (iterable && objectTypes[typeof iterable]) {",keys:ib,loop:"if (typeof result[index] == 'undefined') result[index] = iterable[index]",bottom:"  }\n}"},kb=m(jb,{top:jb.top.replace(";",";\nif (argsLength > 3 && typeof args[argsLength - 2] == 'function') {\n  var callback = baseCreateCallback(args[--argsLength - 1], args[argsLength--], 2);\n} else if (argsLength > 2 && typeof args[argsLength - 1] == 'function') {\n  callback = args[--argsLength];\n}"),loop:"result[index] = callback ? callback(result[index], iterable[index]) : iterable[index]"});return p(/x/)&&(p=function(a){return"function"==typeof a&&U.call(a)==E}),f.assign=kb,f.bind=s,f.create=o,f.keys=ib,f.extend=kb,f.identity=t,f.isArguments=n,f.isArray=gb,f.isFunction=p,f.isObject=q,f.isString=r,f.noop=u,f.VERSION="2.3.0",N&&O&&(N._=f),N._}(this)},{}],"lib/lodash":[function(a,b){b.exports=a("aQJBiS")},{}],"blv/2e":[function(a,b){"use strict";function c(a){this.defaults={data:null,view:null,idName:"id",viewType:e},this._data=Object.create(null),this._events=new Object(null),f.extend(this,f.defaults(a,this.defaults)),this.events&&this.onAll(this.events),this.data&&this.setAll(this.data),this.view&&this.setView(this.view)}var d=a("./emitter"),e=a("./model.view"),f=a("./tools");c.prototype.setView=function(a){a instanceof this.viewType||(a.model=this,a=new this.viewType(a)),this.view=a},c.prototype.clear=function(){var a,b=this.keys();for(a=0;a<b.length;a++)this.remove(b[a]);this._data=Object.create(null),this.emit("clear")},c.prototype.reset=function(){this.clear(),this.setAll(this.data),this.emit("reset")},c.prototype.getAll=function(){var a,b={},c=this.keys();for(a=0;a<c.length;a++)b[c[a]]=this.get(c[a]);return b},c.prototype.get=function(a){return this._data[a]},c.prototype.getDeep=function(a){var b,d,e=a.indexOf(".");return-1!==e&&(b=a.substr(0,e),d=this._data[b],d instanceof c)?d.getDeep(a.substr(e+1)):this.get(a)},c.prototype.set=function(a,b){var c=this.get(a),d={key:a,value:b,previous:c,event:"set"};b!==c&&(this.emit(a+":set",d),this.emit("changed",d),this._data[a]=d.value)},c.prototype.setAll=function(a){for(var b=0,c=a&&"object"==typeof a?Object.keys(a):[];b<c.length;b++)this.set(c[b],a[c[b]]);this.emit("setAll")},c.prototype.keys=function(){return Object.keys(this._data)||[]},c.prototype.has=function(a){return this._data.hasOwnProperty(a)},c.prototype.remove=function(a){var b=this.get(a);delete this._data[a],this.emit("remove:"+a,{previous:b}),this.emit("changed",{key:a,event:"remove",previous:b})},c.prototype.pack=function(){return this._data},c.prototype.unpack=function(a){return a},c.prototype.save=function(){},c.prototype.parse=function(a){var b={};try{b=JSON.parse(a).data}catch(c){console.log(c)}return b},d.inject(c),b.exports=c},{"./emitter":"P7cBNP","./model.view":"ESYGw6","./tools":"AjqgZI"}],"lib/model":[function(a,b){b.exports=a("blv/2e")},{}],"lib/model.view":[function(a,b){b.exports=a("ESYGw6")},{}],ESYGw6:[function(a,b){"use strict";function c(a){var b=this;this.defaults={autoRender:!0,model:null,template:null,watcher:null,watch:!1},a.model&&this.setModel(a.model,!1),d.call(this,f.defaults(a,this.defaults)),this.watch===!0&&(this.watcher=new e(this.model),this.watcher.on("watch",function(a){b.updateField(a)}),this.watcher.watch())}var d=a("./tview"),e=a("./watcher"),f=a("./tools");c.prototype=Object.create(d.prototype),c.prototype.constructor=c,c.prototype.setModel=function(a,b){this.model=a,this.watcher&&this.watcher.setData(this.model).watch(),b!==!1&&this.update()},b.exports=c},{"./tools":"AjqgZI","./tview":"r32W0Q","./watcher":"/tW+0Y"}],"lib/page.manager":[function(a,b){b.exports=a("O89K3x")},{}],O89K3x:[function(a,b){"use strict";function c(a){this.defaults={history:[],pages:{},mainPage:null,_events:new Object(null)},f.extend(this,f.defaults(a,this.defaults)),this.events&&this.onAll(this.events),this.setPages(this.pages)}var d=a("./cpage"),e=a("./emitter"),f=a("./tools");c.prototype.setPages=function(a){for(var b=0;b<a.length;b++)this.addPage(a[b])},c.prototype.addPage=function(a){var b=this;return a instanceof d||(a=new d(a)),a.owner=a.manager=this,a.dynamic===!0&&(a.on("startChanges",function(){b.emit("startChanges")}),a.on("allReady",function(){b.emit("allReady")})),this.pages[a.name]=a,a},c.prototype.setMainPage=function(a){this.mainPage=this.addPage(a)},c.prototype.main=function(a){return a&&this.setMainPage(a),this.mainPage},c.prototype.page=function(a,b){return 2===arguments.length&&this.addPage(a,b),this.pages[a]},c.prototype.show=function(a,b,c){var d=this.current(),e=f.uniqueID();d&&d.hide(),c!==!1&&this.history.push({page:a,data:b,state:e}),"function"==typeof a.prepare&&(a.prepare(b),a._state=e),a.view.handle.classList.remove("invisible"),a.activate()},c.prototype.hide=function(a){a.view.handle.classList.add("invisible")},c.prototype.back=function(){var a=this.history.pop(),b=this.history[this.history.length-1]||{page:this.mainPage};return a&&(a.page.deactivate(),a.page.hide()),b.page&&(b.page.activate(),b.data&&b.state!==b.page._state&&b.page.prepare(b.data),b.page.view.handle.classList.remove("invisible"),b.page.emit("show")),a},c.prototype.current=function(){return this.history[this.history.length-1]?this.history[this.history.length-1].page:this.mainPage},c.prototype.eventHandler=function(a){var b=this.current();return b&&b.isActive()&&b.eventHandler&&b.eventHandler(a)===!0},e.inject(c),b.exports=c},{"./cpage":"B6eAZ7","./emitter":"P7cBNP","./tools":"AjqgZI"}],"lib/player":[function(a,b){b.exports=a("LZDS0b")},{}],LZDS0b:[function(a,b){"use strict";var c=a("lib/emitter"),d=a("../config"),e={aspects:[{name:"exp",mode:0},{type:"fit",mode:16},{name:"big",mode:64},{name:"opt",mode:80}],init:function(){var a=this;this.currentAspect=1,this.muted=0,gSTB.InitPlayer(),gSTB.SetVolume(50),gSTB.SetAspect(this.aspects[this.currentAspect].mode),gSTB.SetVideoControl(0),gSTB.SetVideoState(0),gSTB.SetTopWin(0),gSTB.SetWinMode(0,0),gSTB.SetWinMode(1,0),gSTB.SetMode(0),gSTB.SetWinAlphaLevel(0,255),gSTB.SetWinAlphaLevel(1,255),gSTB.SetPIG(1,0,0,0),gSTB.SetAudioLangs(d.get("audioLang"),d.get("audioLang")),gSTB.SetSubtitleLangs(d.get("subtitlesLang"),d.get("subtitlesLang")),gSTB.SetSubtitlesFont(d.get("subtitlesFont"));try{d.set("videoMode",gSTB.RDir("vmode"))}catch(b){}stbEvent.onEvent=function(b){switch(a.emit("event",b),b){case"1":a.emit("end");break;case"2":a.totalTime=gSTB.GetMediaLenEx(),a.emit("info");break;case"4":a.emit("playStart");break;case"5":a.emit("error");break;case"7":break;case"33":gSTB.Stop()}}},start:function(a){gSTB.SetMode(1),gSTB.Play(a)},play:function(){gSTB.Continue()},pause:function(){gSTB.Pause()},stop:function(){gSTB.Stop()},setPosition:function(a){gSTB.SetPosTimeEx(a),gSTB.Continue()},getCurrentTime:function(){return gSTB.GetPosTimeEx()},isPlaying:function(){return gSTB.IsPlaying()},changeVolume:function(a){return a=gSTB.GetVolume()+a,a>100?a=100:0>a&&(a=0),gSTB.SetVolume(a),a},getVolume:function(){return gSTB.GetVolume()},mute:function(a){return this.muted=void 0===a?this.muted?0:1:a?1:0,gSTB.SetMute(this.muted),this.muted},changeAspect:function(){var a;return this.currentAspect++,this.currentAspect>e.aspects.length-1&&(this.currentAspect=0),a=this.aspects[this.currentAspect],gSTB.SetAspect(a.mode),a}};c.inject(e),e.init(),b.exports=e},{"../config":39,"lib/emitter":"P7cBNP"}],PcZuZs:[function(a,b){"use strict";function c(a,b){this._url=a,this._namespace=b,this._events={}}var d=a("lib/tools");c.prototype.call=function(a,b){var c,e,f=d.ajax({url:this._url,data:{params:d.defaults(b,this.defParams),method:this._namespace?this._namespace+"."+a:a},method:"POST",dataType:"json",headers:{"Content-Type":"application/json"},success:function(a){null===a.result||a.error?e&&e(a.error):c&&c(a.result)},error:function(a){e&&e(a)}});return f.onSuccess=function(a){return c=a,f},f.onError=function(a){return e=a,f},f},b.exports=c},{"lib/tools":"AjqgZI"}],"lib/rpc.client":[function(a,b){b.exports=a("PcZuZs")},{}],"8+NRr9":[function(a,b){"use strict";function c(a){this.defaults={container:document.body,indent:0},d.extend(this,d.defaults(a,this.defaults))}var d=a("./tools");c.prototype.show=function(a){a instanceof Node&&!(a.offsetHeight<=0&&a.offsetWidth<=0)&&(this.showY(a),this.showX(a))},c.prototype.showY=function(a){var b=a.offsetTop,c=a.offsetHeight,d=this.container.scrollTop,e=this.container.offsetHeight;d>b||c>e?this.scrollTop(b-this.indent):b+c>d+e&&this.scrollTop(b+c-e+this.indent)},c.prototype.showX=function(a){var b=a.offsetLeft,c=a.offsetWidth,d=this.container.scrollLeft,e=this.container.offsetWidth;d>b||c>e?this.scrollLeft(b+this.indent):b+c>d+e&&this.scrollLeft(b+c-e-this.indent)},c.prototype.scrollTop=function(a){this.container.scrollTop=a},c.prototype.scrollLeft=function(a){this.container.scrollLeft=a},b.exports=c},{"./tools":"AjqgZI"}],"lib/scroller":[function(a,b){b.exports=a("8+NRr9")},{}],"lib/template":[function(a,b){b.exports=a("5cfm+n")},{}],"5cfm+n":[function(a,b){"use strict";function c(a){a.renders&&this.setRenders(a.renders||[]),a.template&&this.setTemplate(a.template)}var d=a("./dom");c.prototype.setTemplate=function(a){this._template=d.fragment(a)},c.prototype.setRenders=function(a){if(!Array.isArray(a))throw"Renders must be an Array";this._renders=a},c.prototype.addRender=function(a){this._renders.push(a)},c.prototype.compile=function(){var a,b,c,d,e,f,g,h,i={element:this._template.firstChild.cloneNode(!0),fields:{}};for(b=0;b<this._renders.length;b++)for(a=this._renders[b],e="data-"+a,g=i.element.querySelectorAll("["+e+"]"),c=0;c<g.length;c++)f=g[c],d=f.attributes.getNamedItem(e),h=d.value,void 0===i.fields[h]&&(i.fields[h]={}),void 0===i.fields[h][a]?i.fields[h][a]=[f]:i.fields[h][a].push(f);return i},b.exports=c},{"./dom":"CBUzS7"}],mtNT1s:[function(a,b){"use strict";function c(a){this._hash=new Object(null),this.setType(a.type),this.setHash(a.data)}c.prototype.setType=function(a){this.type=a||Object},c.prototype.setHash=function(a){this.clear();for(var b in a)a.hasOwnProperty(b)&&this.set(b,a[b])},c.prototype.set=function(a,b){b instanceof this.type||(b=new this.type(b)),this._hash[a]=b},c.prototype.get=function(a){return this._hash[a]},c.prototype.remove=function(a){delete this._hash[a]},c.prototype.clear=function(){this._hash=new Object(null)},b.exports=c},{}],"lib/thash":[function(a,b){b.exports=a("mtNT1s")},{}],"lib/tools":[function(a,b){b.exports=a("AjqgZI")},{}],AjqgZI:[function(a,b){"use strict";function c(a,b){for(var d in b)b.hasOwnProperty(d)&&(a[d]&&a[d].constructor===Object&&b[d]&&b[d].constructor===Object?c(a[d],b[d]):void 0===a[d]&&(a[d]=b[d]));return a}function d(a,b){return"function"==typeof a[b]?a[b].call(a):a[b]}function e(a,b){var c,f=b.indexOf(".");return-1!==f?(c=b.substr(0,f),e(a[c],b.substr(f+1))):d(a,b)}function f(a,b){return void 0!==a.code?!0:(a.code=a.keyCode||a.which,0===a.code?!1:(a.shiftKey&&(a.code+=1e3),a.altKey&&(a.code+=2e3),b!==!1&&a.stopPropagation(),!0))}function g(a){var b,d,e,f,h=[],i=!1;if(a=a||{},a.url&&("string"==typeof a.url||a.url instanceof String)&&a.url.length>0){void 0!==a&&"object"==typeof a&&(a=c(a,g.defaults));var j=new XMLHttpRequest;if(a.data&&"object"==typeof a.data)if("GET"===a.method){a.url+="?";for(f in a.data)if(a.data.hasOwnProperty(f)&&null!==a.data[f]&&void 0!==a.data[f])if(Array.isArray(a.data[f]))for(b=0;b<a.data[f].length;b++)h.push(f+"="+a.data[f][b]);else h.push(f+"="+a.data[f]);a.url+=h.join("&")}else"object"==typeof a.data&&(a.data=JSON.stringify(a.data));if(j.open(a.method,a.url,a.async!==!1),a.headers&&"object"==typeof a.headers)for(d=Object.keys(a.headers),b=0;b<d.length;b++)j.setRequestHeader(d[b],a.headers[d[b]]);return j.responseType=a.type,j.onreadystatechange=function(){if(4===j.readyState){if(j.inAbort)return;if(i=j.status>=200&&j.status<300||304===j.status,clearTimeout(e),i){if("function"==typeof a.success)switch(a.dataType){case"json":a.success.call(j,JSON.parse(j.responseText),j.status);break;case"xml":a.success(j.responseXML);break;default:a.success(j.responseText)}}else"function"==typeof a.error&&a.error.call(j,j.statusText,j.status);"function"==typeof a.done&&a.done.call(j,j.responseText,j.status)}},j.send(a.data||null),e=setTimeout(function(){j.abort()},a.timeout),j.abort=function(){j.inAbort=!0,XMLHttpRequest.prototype.abort.call(j)},j}return!1}function h(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c]);return a}function i(a,b,c){var d=c===!1?h({},a):a||{};for(var e in b)d[e]="object"!=typeof d[e]||"object"!=typeof b[e]||Array.isArray(d[e])||Array.isArray(b[e])?b[e]:i(d[e],b[e],c);return d}function j(a,b){var c=new Object(a);return"object"==typeof b&&h(c,b),c}function k(a,b){var c=1,d=function(){a.length===c&&"function"==typeof b?b():c++};Array.isArray(a)&&a.length>0?a.forEach(function(a){var b=new Image;b.src=a,b.onload=d,b.onerror=function(){throw"Image "+a+" load fail"}}):0===a.length&&b()}function l(a,b){return a.length>b&&(a=a.substr(0,b-3).trim()+"&nbsp;..."),a}function m(a){return("0"+a).slice(-2)}function n(a){return[m(a.getUTCHours()),m(a.getUTCMinutes()),m(a.getUTCSeconds())].join(":")}function o(){return o.index++}function p(a){for(var b,c={},d=window.location.search.split("?")[1].split("&"),e=0;e<d.length;e++){if(b=d[e].split("="),b[0]===a)return decodeURIComponent(b[1]);c[b[0]]=decodeURIComponent(b[1])}return c}function q(a){var b,c=[];for(b in a)a.hasOwnProperty(b)&&c.push(a[b]);return c}if(g.defaults={method:"GET",async:!0,headers:{},dataType:"json",data:null,timeout:1e4,error:null,done:null,success:null,url:""},!("classList"in document.documentElement)){var r=Array.prototype,s=r.indexOf,t=r.slice,u=r.push,v=r.splice,w=r.join;window.DOMTokenList=function(a){if(this._element=a,a.className!==this._classCache){if(this._classCache=a.className,!this._classCache)return;var b,c=this._classCache.replace(/^\s+|\s+$/g,"").split(/\s+/);for(b=0;b<c.length;b++)u.call(this,c[b])}},window.DOMTokenList.prototype={add:function(a){this.contains(a)||(u.call(this,a),this._element.className=t.call(this,0).join(" "))},contains:function(a){return-1!==s.call(this,a)},item:function(a){return this[a]||null},remove:function(a){var b=s.call(this,a);-1!==b&&(v.call(this,b,1),this._element.className=t.call(this,0).join(" "))},toString:function(){return w.call(this," ")},toggle:function(a){return this.contains(a)?this.remove(a):this.add(a),this.contains(a)}},Object.defineProperty(Element.prototype,"classList",{get:function(){return new window.DOMTokenList(this)}})}o.index=0,b.exports={ajax:g,extend:h,imageLoader:k,defaults:c,getValue:e,prepareEvent:f,extendDeep:i,create:j,result:d,values:q,ellipsis:l,uniqueID:o,prepareTime:n,prependZero:m,getUrlParameters:p}},{}],r32W0Q:[function(a,b){"use strict";function c(a){var b=this;this.defaults={compiled:null,autoRender:!1,renders:{result:function(a){var c=f.result(b.model,a.key);g.value(a.element,c)},action:function(a){a.element.addEventListener("click",function(c){b.model.owner&&"function"==typeof b.model.owner[a.key]&&(b.model.owner[a.key](b.model),c.preventDefault())})},bind:function(a){var c=a.value||b.model.get(a.key)||"";g.value(a.element,c)},show:function(a){var c=void 0!==a.value?a.value:b.model.get(a.key);c?g.show(a.element):g.hide(a.element)},"style-width":function(a){var c=void 0!==a.value?a.value:b.model.get(a.key);a.element.style.width=c||""},"style-height":function(a){var c=void 0!==a.value?a.value:b.model.get(a.key);a.element.style.height=c||""},"class":function(a){var c=a.value||b.model.get(a.key),d=a.previous;d&&d.split(" ").forEach(function(b){a.element.classList.remove(b)}),c&&c.split(" ").forEach(function(b){a.element.classList.add(b)})}}},d.call(this,f.defaults(a,this.defaults)),a.template&&this.setTemplate(a.template),this.autoRender===!0&&this.template&&this.render()}var d=a("./view"),e=a("./template"),f=a("./tools"),g=a("./dom");c.prototype=Object.create(d.prototype),c.prototype.constructor=c,c.prototype.addRender=function(a,b){this.renders[a]=b,this.template.addRender(a)},c.prototype.setTemplate=function(a){a instanceof e||(a&&a.nodeName||(a=this.handle?this.handle.children:null),a=new e({template:a,renders:Object.keys(this.renders)})),this.template=a},c.prototype.render=function(){this.update(),this.handle!==this.compiled.element&&this.insert(this.compiled.element)},c.prototype.update=function(){var a,b;for(null===this.compiled&&(this.compiled=this.compile()),b=Object.keys(this.compiled.fields),a=0;a<b.length;a++)this.updateField(b[a]);this.emit("onUpdate")},c.prototype.compile=function(){return this.compiled=this.template.compile(),this.emit("onCompile",this.compiled),this.compiled},c.prototype.updateField=function(a){var b,c,d,e;a=a.key?a:{key:a},e=this.compiled.fields[a.key];for(c in e)if(this.renders.hasOwnProperty(c))for(b=e[c],d=0;d<b.length;d++)this.renders[c](f.extend({element:b[d],attribute:c},a))},b.exports=c},{"./dom":"CBUzS7","./template":"5cfm+n","./tools":"AjqgZI","./view":"kWfdrx"}],"lib/tview":[function(a,b){b.exports=a("r32W0Q")},{}],"lib/view":[function(a,b){b.exports=a("kWfdrx")},{}],kWfdrx:[function(a,b){"use strict";function c(a){this.defaults={saveDefault:!1,handle:null,owner:null,visible:!0},this._events=new Object(null),f.extend(this,f.defaults(a,this.defaults)),this.setHandle(this.handle),this.visible?this.show():this.hide(),this.saveDefault===!0&&(this.defaultHtml=this.handle.innerHTML)}var d=a("./emitter"),e=a("./dom"),f=a("./tools");c.prototype.setHandle=function(a){if(!(a instanceof Node))throw"Handler for view must be an Node or DocumentFragment";var b=this;this.handle=a,a.view=this,this.handle.addEventListener("click",function(a){b.emit("click",a)})},c.prototype.show=function(){e.show(this.handle),this.emit("show")},c.prototype.hide=function(){e.hide(this.handle),this.emit("hide")},c.prototype.toggle=function(){this.emit(this.isVisible()?"hide":"show"),e.toggle(this.handle)},c.prototype.html=function(a){this.emit("html",{old:this.handle.innerHTML,"new":a}),this.handle.innerHTML=a},c.prototype.getHandle=function(){return this.handle},c.prototype.insert=function(a){this.emit("insert",a.handle||a),this.clear(),this.handle.appendChild(a)},c.prototype.insertTo=function(a){return a=a.handle||a,this.emit("insertTo",a),e.clear(a),a.appendChild(this.handle)},c.prototype.appendChild=function(a){return a=a.handle||a,this.emit("appendChild",a),this.handle.appendChild(a)},c.prototype.appendTo=function(a){return a=a.handle||a,this.emit("onAppendTo",a),a.appendChild(this.handle)},c.prototype.insertBefore=function(a){return a=a.handle||a,this.emit("insertBefore",a),a.parentElement.insertBefore(this.handle,a)},c.prototype.clear=function(){this.emit("clear"),e.clear(this.handle)},c.prototype.remove=function(){this.emit("remove"),e.remove(this.handle)},c.prototype.restore=function(){this.emit("restore"),this.saveDefault===!0&&void 0!==this.defaultHtml&&(this.handle.innerHTML=this.defaultHtml)},c.prototype.isVisible=function(){return e.isVisible(this.handle)},d.inject(c),b.exports=c},{"./dom":"CBUzS7","./emitter":"P7cBNP","./tools":"AjqgZI"}],"/tW+0Y":[function(a,b){"use strict";function c(a){this._events=new Object(null),this.setData(a),this.isPaused=!1}var d=a("./emitter");c.prototype.stop=function(){return this.data.off("changed",this._watch),this},c.prototype.pause=function(){return this.isPaused=!0,this},c.prototype.watch=function(){var a=this;return this.isPaused===!0&&(this.isPaused=!1),this.data.on("changed",function(b){a._watch(b)}),this},c.prototype._watch=function(a){this.isPaused||this.emit("watch",a)},c.prototype.setData=function(a){return this.data=a,this},d.inject(c),b.exports=c},{"./emitter":"P7cBNP"}],"lib/watcher":[function(a,b){b.exports=a("/tW+0Y")},{}],UgnP4x:[function(a,b){"use strict";function c(a){var b=this;this.defaults={name:"AuthorizationModal",visible:!1,active:!1,modal:!0,navigation:"horizontal"},e.call(this,i.defaults(a,this.defaults)),this.addComponent(new e({handle:document.getElementById("authorization-inputs-panel"),components:[this.email=new d({handle:document.getElementById("authorization-email-input"),events:{activate:function(){b.keyboard.activated=!0,b.keyboard.input=this}}}),this.password=new d({handle:document.getElementById("authorization-password-input"),events:{activate:function(){b.keyboard.activated=!0,b.keyboard.input=this}}}),new f({handle:document.getElementById("authorization-ok-button"),action:function(){g.authorize(b.email.value,b.password.value)},events:{activate:function(){b.keyboard.activated=!1}}}),new f({handle:document.getElementById("authorization-exit-button"),action:function(){b.hide()},events:{activate:function(){b.keyboard.activated=!1}}})]})),this.addComponent(this.keyboard=new h({name:"AuthorizationKeyboard",active:!0,owner:this,input:this.email,handle:document.getElementById("authorization-keyboard")})),this.addComponent(new f({activated:!1,active:!1,handle:document.getElementById("authorization-btn-close"),template:null,action:function(){b.hide()}})),this.on("show",function(){this.activate(),this.email.activate()}),this.on("hide",function(){this.deactivate()}),g.on("authorized",function(){b.hide()})}var d=a("components/input"),e=a("lib/cpanel"),f=a("components/button"),g=a("models/user"),h=a("components/keyboard"),i=a("lib/tools"),j=a("lib/keys");c.prototype=Object.create(e.prototype),c.prototype.constructor=c,c.prototype.eventHandler=function(a){switch(a.code){case j.EXIT:return this.hide(),!0}return e.prototype.eventHandler.call(this,a),!0},b.exports=c},{"components/button":"+xiQfc","components/input":"7zX6co","components/keyboard":"A64hEq","lib/cpanel":"ySbxUr","lib/keys":"iIRFqq","lib/tools":"AjqgZI","models/user":"QAloAk"}],"modals/authorization":[function(a,b){b.exports=a("UgnP4x")},{}],"modals/list":[function(a,b){b.exports=a("/X0zSk")},{}],"/X0zSk":[function(a,b){"use strict";function c(a){var b=this;this.defaults={visible:!1,active:!1,template:!1,exitBtnHandle:a.handle.querySelector(".close"),contentHandle:a.handle.querySelector(".content"),content:[this.vlist=new e({active:!0,arrows:null,name:"SortRatingList",handle:a.handle.querySelector(".content"),collectionHandle:a.handle.querySelector(".list"),collection:{idName:"sort",data:a.list},events:{enter:function(a){"function"==typeof b.action&&b.action(a),b.emit("enter",a)}}})]},d.call(this,f.defaults(a,this.defaults))}var d=a("modals/modal"),e=a("components/vlist"),f=a("lib/tools");c.prototype=Object.create(d.prototype),c.prototype.constructor=c,c.prototype.show=function(a){this.activateItem(a),this.view.show(),this.activate()},c.prototype.activateItem=function(a){this.vlist.activateItem(this.vlist.collection.get(a))},b.exports=c},{"components/vlist":"CJRc+3","lib/tools":"AjqgZI","modals/modal":"BjgSXc"}],BjgSXc:[function(a,b){"use strict";function c(a){var b=this;this.defaults={modal:!0,active:!1,activated:!0,model:{data:a.data,view:{handle:a.handle,template:a.template||!1,watch:!0}}},d.call(this,g.defaults(a,this.defaults)),a.buttonsHandle&&("string"==typeof a.buttonsHandle&&(a.buttonsHandle=this.handle.querySelector(a.buttonsHandle)),this.addComponent(new d({active:!0,owner:this,activated:!0,handle:a.buttonsHandle,components:a.buttons,navigation:"horizontal"}))),a.contentHandle&&this.addComponent(new d({active:!0,handle:a.contentHandle,activated:!0,components:a.content})),a.exitBtnHandle&&("string"==typeof a.exitBtnHandle&&(a.exitBtnHandle=this.handle.querySelector(a.exitBtnHandle)),this.addComponent(new e({handle:a.exitBtnHandle,activated:!1,template:!1,action:function(){b.hide()}}))),this.on("hide",function(){this.deactivate()}),this.on("show",function(){this.activate()})}var d=a("lib/cpanel"),e=a("components/button"),f=a("lib/keys"),g=a("lib/tools");c.prototype=Object.create(d.prototype),c.prototype.constructor=c,c.prototype.eventHandler=function(a){switch(a.code){case f.EXIT:return this.hide(),!0}return d.prototype.eventHandler.call(this,a),!0},b.exports=c},{"components/button":"+xiQfc","lib/cpanel":"ySbxUr","lib/keys":"iIRFqq","lib/tools":"AjqgZI"}],"modals/modal":[function(a,b){b.exports=a("BjgSXc")},{}],"models/adv":[function(a,b){b.exports=a("giot0N")},{}],giot0N:[function(a,b){"use strict";function c(a){this.defaults={name:"AdvModel"},d.call(this,h.defaults(a,this.defaults)),this.rpcClient=new e(g.get("contentApiUrl"),g.get("advApiNamespace"))}var d=a("lib/model"),e=a("lib/rpc.client"),f=a("models/user"),g=a("../config"),h=a("lib/tools");c.prototype=Object.create(d.prototype),c.prototype.constructor=c,c.prototype.got=function(){var a=this.getParams();this.rpcClient.call("got",[a.content,this.get("id"),a]).onSuccess(function(){}).onError(function(){})},c.prototype.watched=function(){var a=this.getParams();this.rpcClient.call("get",[a.content,this.get("id"),a]).onSuccess(function(){this.trigger("watched")}).onError(function(){})},c.prototype.getParams=function(){var a={site:g.get("site"),content:this.get("filmId"),watchid:this.get("watchId"),adv_video_id:this.get("id"),uid:g.get("uid")};return f.isAuthorized()&&(a.iviid=f.get("id")),a},c.prototype.getFile=function(){var a,b,c=this.get("files"),d=g.get("videoQuality");if(!Array.isArray(c)||!c.length)return null;for(a=c.length;a&&(b=c[--a],!b.content_format||-1===b.content_format.indexOf(d)););return b.url},b.exports=c},{"../config":39,"lib/model":"blv/2e","lib/rpc.client":"PcZuZs","lib/tools":"AjqgZI","models/user":"QAloAk"}],"7L3aGG":[function(a,b){"use strict";
function c(a){this.defaults={posterSize:"172x264",events:{"budget_million:set":function(a){a.value&&(a.value=this._prepareMoney(a.value))},"artists:set":function(a){a.value.length&&(this.set("artists_short",a.value.slice(0,6).join(", ")+"&nbsp;..."),a.value=a.value.join(", "))},"description:set":function(a){a.value&&this.set("description_short",f.ellipsis(a.value,350))},"gross_world_million:set":function(a){a.value&&(a.value=this._prepareMoney(a.value))},"gross_usa_million:set":function(a){a.value&&(a.value=this._prepareMoney(a.value))}}},d.call(this,f.defaults(a,this.defaults))}var d=a("./film"),e=a("../dictionary"),f=a("lib/tools");c.prototype=Object.create(d.prototype),c.prototype.constructor=c,c.prototype._prepareMoney=function(a){var b,c,d=[],e=(1e6*parseInt(a)).toString().split("");for(b=0;b<e.length;b++)c=e[e.length-b-1],d[e.length-b-1]=b%3===0?c+" ":c;return d.join("")},c.prototype.details=function(){var a,b,c=this.get("year"),d=this.get("country"),f=this.get("duration_minutes"),g=this.get("genres"),h=[];if(c&&h.push(c),d=e.countries.get(d),d&&h.push(d.get("title")),g)for(a=0;a<g.length;a++)b=e.genres.get(g[a]),b&&h.push(b.get("title"));return f&&h.push(f+" минут"),h.join(", ")},b.exports=c},{"../dictionary":40,"./film":"DKEUaB","lib/tools":"AjqgZI"}],"models/film.info":[function(a,b){b.exports=a("7L3aGG")},{}],DKEUaB:[function(a,b){"use strict";function c(a){this.defaults={_data:{poster_originals:"img/"+screen.height+"/video-preview.png"},posterSize:g.get("posterSize"),events:{"poster_originals:set":function(a){a.value.length&&(a.value=a.value[0].path+"/"+this.posterSize+"/")}}},d.call(this,h.defaults(a,this.defaults)),this.rpcClient=new f(g.get("contentApiUrl"),g.get("contentApiNamespace"))}var d=a("lib/model"),e=a("models/user"),f=a("lib/rpc.client"),g=a("../config"),h=a("lib/tools");c.prototype=Object.create(d.prototype),c.prototype.constructor=c,c.prototype.load=function(a){var b,c=this;this.watchId=a,b=this.getRpcParams(),this.inLoad=!0,this.loadXhr=this.rpcClient.call("get",[b.content,b]).onSuccess(function(a){var b,d=g.get("videoQuality");c.set("files",a.files),b=ivi.playerPage.loggerData=a,b.qualityId=0,b.watchedAdvs=[];for(var e=0;e<b.files.length;e++)if(b.files[e].content_format&&-1!==b.files[e].content_format.indexOf(d)){b.qualityId=e;break}c.inLoad=!1,c.trigger("loaded")}).onError(function(){c.inLoad=!1,c.trigger("loadError")})},c.prototype.watched=function(){var a=(this.getRpcParams(),this);this.isWatched=!0,a.trigger("watched")},c.prototype.getRpcParams=function(){var a=h.defaults({uid:g.get("uid"),watchid:this.watchId,content:this.get("id"),site:"s"+g.get("site")},this.reqParameters);return e.isAuthorized()&&(a.iviid=e.get("id")),a},c.prototype.getFile=function(){var a,b,c=this.get("files"),d=g.get("videoQuality");if(!Array.isArray(c)||!c.length)return null;for(a=0;a<c.length&&(b=c[a],!b.content_format||-1===b.content_format.indexOf(d));a++);return b.url},c.prototype.abort=function(){this.loadXhr&&this.loadXhr.abort(),this.watchedXhr&&this.watchedXhr.abort()},b.exports=c},{"../config":39,"lib/model":"blv/2e","lib/rpc.client":"PcZuZs","lib/tools":"AjqgZI","models/user":"QAloAk"}],"models/film":[function(a,b){b.exports=a("DKEUaB")},{}],iVIYTP:[function(a,b){"use strict";function c(a){d.call(this,a),this.imageSize="372x163"}var d=a("lib/model");c.prototype=Object.create(d.prototype),c.prototype.constructor=c,c.prototype.getImageUrl=function(){return this.get("images")["1024x449"].path+"/"+this.imageSize+"/"},b.exports=c},{"lib/model":"blv/2e"}],"models/promo":[function(a,b){b.exports=a("iVIYTP")},{}],jiRtAe:[function(a,b){"use strict";function c(a){this.defaults={posterSize:e.get("serialThumbSize"),events:{"thumb_originals:set":function(a){a.value.length&&this.set("thumbnail",a.value[0].path+"/"+this.posterSize+"/")}}},d.call(this,f.defaults(a,this.defaults))}var d=a("models/film"),e=a("../config"),f=a("lib/tools");c.prototype=Object.create(d.prototype),c.prototype.constructor=c,b.exports=c},{"../config":39,"lib/tools":"AjqgZI","models/film":"DKEUaB"}],"models/serie":[function(a,b){b.exports=a("jiRtAe")},{}],"models/user":[function(a,b){b.exports=a("QAloAk")},{}],QAloAk:[function(a,b){"use strict";function c(a){d.call(this,a||{}),this.authorized=!1}var d=a("lib/model"),e=a("lib/tools"),f=a("../config");c.prototype=Object.create(d.prototype),c.prototype.constructor=c,c.prototype.authorize=function(a,b){var c=this;return a&&b?(this.set("email",a),this.set("password",b),c.emit("request"),e.ajax({url:f.get("apiUrl")+"/login",data:{email:a,password:b},success:function(a){a.user?(c.setAll(a.user),c.authorized=!0,c.emit("authorized",a)):c.emit("authError",a.error)},error:function(a){c.emit("reqError",a)}}),!0):(c.emit("authError"),!1)},c.prototype.generateUID=function(){var a=Math.floor(1e8*Math.random());return a+"."+Date.now().toString().substr(-4)},c.prototype.logout=function(){this.clear(),this.authorized=!1,this.emit("logout")},c.prototype.isAuthorized=function(){return this.authorized===!0},b.exports=new c},{"../config":39,"lib/model":"blv/2e","lib/tools":"AjqgZI"}],u2t6GX:[function(a,b){"use strict";function c(a){this.defaults={name:"AgreementsPage",active:!1,visible:!1},d.call(this,f.defaults(a,this.defaults)),this.on("show",function(){this.header.setTitle("Пользовательское соглашение"),this.initFooter()})}var d=a("lib/cpage"),e=a("lib/keys"),f=a("lib/tools");c.prototype=Object.create(d.prototype),c.prototype.constructor=c,c.prototype.initFooter=function(){this.footer.hideAll(),this.footer.showButton("exit","Назад")},c.prototype.eventHandler=function(a){if(d.prototype.eventHandler.call(this,a)===!0)return!0;switch(a.code){case e.UP:this.handle.scrollByLines(-1);break;case e.DOWN:this.handle.scrollByLines(1);break;case e.PAGE_UP:this.handle.scrollByLines(-20);break;case e.PAGE_DOWN:this.handle.scrollByLines(20)}return!0},b.exports=c},{"lib/cpage":"B6eAZ7","lib/keys":"iIRFqq","lib/tools":"AjqgZI"}],"pages/agreements":[function(a,b){b.exports=a("u2t6GX")},{}],PcF5dW:[function(a,b){"use strict";function c(a){var b,c,r,s=this;this.defaults={name:"DetailsPage",active:!1,visible:!1,modelType:e,dynamic:!0,model:{view:{handle:a.handle,template:!0,watch:!0}}},d.call(this,q.defaults(a,this.defaults)),b=document.getElementById("details-tabs"),this.addComponent(this.buttonsPanel=new i({name:"Buttons",active:!0,activated:!0,owner:this,handle:b,navigation:"horizontal",components:[this.watchBtn=new h({name:"Watch Button",handle:b.querySelector(".watch"),template:!1,action:function(){s.play()},events:{activate:function(){s.watchPanel.show(),s.watchPanel.activate()},deactivate:function(){s.watchPanel.hide()}},eventHandler:function(a){if(h.prototype.eventHandler.call(this,a)===!0)return!0;var b=r.firstElementChild;switch(a.code){case p.UP:return 0===b.scrollTop?!1:(b.scrollByLines(-1),!0);case p.DOWN:return b.scrollByLines(1),!0}return!1}}),this.compilationButton=new h({name:"Compilations content Button",handle:b.querySelector(".compilation"),template:!1,active:!1,action:function(){s.compilationPanel.show()},events:{show:function(){this.activated=!0},hide:function(){this.deactivate(),this.activated=!1},activate:function(){s.compilationPanel.show(),s.compilationPanel.activate()},deactivate:function(){s.compilationPanel.hide(),s.compilationPanel.deactivate()}}}),this.reviewsButton=new h({name:"Reviews Button",handle:b.querySelector(".reviews"),template:!1,active:!1,action:function(){s.reviewsPanel.show()},events:{activate:function(){s.reviewsPanel.show(),s.reviewsPanel.activate()},deactivate:function(){s.reviewsPanel.hide()}}}),new h({name:"Similar Button",handle:b.querySelector(".similar"),template:!1,active:!1,action:function(){s.similarPanel.show()},events:{activate:function(){s.similarPanel.show(),s.similarPanel.activate()},deactivate:function(){s.similarPanel.hide()}}})]})),this.addComponent(this.contentPanel=new i({name:"Content panel",visible:!0,owner:this,navigation:"horizontal",active:!1,activated:!0,handle:document.getElementById("details-content"),events:{activate:function(){s.similarPanel.isActive()===!0?s.similarList.activate():s.reviewsPanel.isActive()===!0&&s.reviews.activate(),s.episodesList.hItems=null},deactivate:function(){s.similarList.deactivate(),s.reviews.deactivate()}}})),r=document.getElementById("details-watch-tab"),this.contentPanel.addComponent(this.watchPanel=new i({name:"Watch tab",activated:!1,visible:!0,handle:r})),c=document.getElementById("details-reviews-tab"),this.contentPanel.addComponent(this.reviewsPanel=new i({name:"Reviews tab",visible:!1,handle:c,components:[this.reviews=new f({handle:document.getElementById("details-reviews-list"),arrows:null,active:!1,scroller:{container:c.querySelector(".content")},collectionType:l,collection:{view:{template:!0,watch:!0},events:{fetch:function(a){a.length?(s.reviewsButton.show(),s.reviewsButton.activated=!0):(s.reviewsButton.hide(),s.reviewsButton.activated=!1)}}},events:{request:function(){s.startAction()},fetch:function(){s.endAction()},enter:function(a){s.reviewModal.showReview(a)}}})]})),this.contentPanel.addComponent(this.similarPanel=new i({name:"Similar panel",visible:!1,handle:document.getElementById("details-similar-tab"),components:[this.similarList=new g({name:"SimilarList",active:!1,visible:!0,handle:document.getElementById("details-similar-list"),collectionType:m,collection:{url:o.get("apiUrl")+"/video/related/",data:{count:30},events:{clear:function(){s.similarList.activeChild=null}}},collectionHandle:document.getElementById("details-similar-collection"),events:{fetch:function(){s.endAction()},request:function(){s.startAction()},enter:function(a){s.manager.showDetails(a)},activate:function(){s.footer.showButton("info")},deactivate:function(){s.footer.hideButton("info")},showInfo:function(a){s.manager.showInfo(a)}}})]})),this.contentPanel.addComponent(this.compilationPanel=new i({name:"Compilation panel",visible:!1,navigation:"horizontal",handle:document.getElementById("details-compilation-tab"),components:[this.seasonsList=new f({name:"SeasonsList",active:!0,visible:!0,arrows:null,handle:document.getElementById("details-seasons-list"),view:{template:!0},collection:{events:{clear:function(){s.seasonsList.activeChild=null}}},events:{enter:function(a){s.seasonsList.activateItem(a)},activateItem:function(){s.episodesList.deactivateItem(s.episodesList.activeChild),s.episodesList.hide(),s.episodesList.update(),s.episodesList.show()},hide:function(){this.deactivate(),this.activated=!1,this.activeChild=null},show:function(){this.activated=!0,this.activate()}}}),this.episodesList=new j({name:"EpisodesList",active:!0,visible:!0,arrows:null,handle:document.getElementById("details-episodes-list"),collectionHandle:document.getElementById("details-episodes-collection"),collectionType:n,filter:function(a){return s.seasonsList.activeChild?a.get("season")===s.seasonsList.activeChild.get("season"):!0},previous:function(a,b){return this.activeChild.view.handle.offsetLeft<this.itemWidth&&!b?null:j.prototype.previous.call(this,a,b)},collection:{events:{clear:function(){this.reset(),s.episodesList.activeChild=null},fetch:function(){s.model.set("episodes",this.getArray())}}},events:{enter:function(a){s.play(a)}}})]})),this.reviewModal=new k({handle:document.getElementById("review-modal"),owner:this,template:!0,visible:!1,active:!1,exitBtnHandle:".close",showReview:function(a){this.model.set("title",a.get("title")),this.model.set("text",a.get("text")),this.show()},events:{init:function(){this.$text=this.handle.querySelector(".text")}},eventHandler:function(a){var b=0;switch(a.code){case p.UP:b=-1;break;case p.DOWN:b=1;break;case p.PAGE_UP:b=-5;break;case p.PAGE_DOWN:b=5;break;case p.EXIT:this.hide()}return this.$text.scrollByLines(b),!0}})}var d=a("lib/cpage"),e=a("models/film.info"),f=a("components/vlist"),g=a("components/hlist"),h=a("components/button"),i=a("lib/cpanel"),j=a("components/mclist"),k=a("modals/modal"),l=a("collections/reviews"),m=a("collections/films"),n=a("collections/series"),o=a("../config"),p=a("lib/keys"),q=a("lib/tools");c.prototype=Object.create(d.prototype),c.prototype.constructor=c,c.prototype.prepare=function(a){this.startAction(),"number"==typeof a?this.loadFilm(a):(this.model.clear(),this.model.setAll(a.data),this.header.setTitle(this.model.get("title")),this.reviews.activeChild=null,this.initFooter(),this.model.get("seasons")?(this.type="compilation",this.compilationButton.show(),this.similarList.collection.url=o.get("apiUrl")+"/compilation/related/",this.loadCompilationReviews(this.model.get("ivi_id")),this.loadCompilationContent(this.model)):this.model.get("compilation")?(this.type="episode",this.compilationButton.show(),this.similarList.collection.url=o.get("apiUrl")+"/compilation/related/",this.loadCompilation(),this.loadCompilationReviews(this.model.get("id"))):(this.type="video",this.compilationButton.hide(),this.similarList.collection.url=o.get("apiUrl")+"/video/related/",this.loadVideoReviews()),this.buttonsPanel.activate(),this.watchBtn.activate(),this.loadSimilar()),this.endAction()},c.prototype.loadFilm=function(a){var b=this;this.startAction(),q.ajax({url:o.get("apiUrl")+"/videoinfo",data:{id:a},success:function(a){b.prepare({data:a}),b.endAction()},error:function(){b.trigger("error","Ошибка связи. Попробуйте позже."),b.endAction()}})},c.prototype.loadCompilation=function(){var a=this,b=this.model.get("compilation");this.startAction(),q.ajax({url:o.get("apiUrl")+"/compilationinfo",data:{id:b},success:function(c){b=new e({data:c}),a.model.set("compilation",b),a.loadCompilationContent(b),a.endAction()},error:function(){a.trigger("error","Ошибка связи. Попробуйте позже."),a.endAction()}})},c.prototype.loadCompilationReviews=function(a){this.reviews.collection.setType("compilation"),this.reviews.collection.fetch(a)},c.prototype.loadVideoReviews=function(){this.reviews.collection.setType("video"),this.reviews.collection.fetch(this.model.get("id"))},c.prototype.loadSimilar=function(){this.similarList.collection.setParameter("id",this.model.get("id")),this.similarList.collection.fullClear(),this.similarList.collection.fetch()},c.prototype.loadCompilationContent=function(a){a.get("seasons_count")?(this.loadCompilationSeasons(a.get("seasons")),this.episodesList.handle.classList.remove("single")):(this.seasonsList.hide(),this.episodesList.handle.classList.add("single"),this.episodesList.activate()),this.loadCompilationEpisodes(a.get("id"))},c.prototype.loadCompilationSeasons=function(a){var b,c,d,e=[];for(b=0,c=a.length;c>b;b++)d=a[b],e.push({title:"Сезон "+d,season:d});this.seasonsList.collection.models(e),this.seasonsList.show()},c.prototype.loadCompilationEpisodes=function(a){this.episodesList.collection.fullClear(),this.episodesList.collection.setParameter("id",a),this.episodesList.collection.fetch()},c.prototype.play=function(a){var b=this.model;"compilation"===this.type?(a||(a=this.episodesList.collection.at(0)),b.set("episode",a)):"episode"===this.type&&(a=this.episodesList.collection.get(this.model.get("id")),b=this.model.get("compilation"),b.set("episode",a),b.set("episodes",this.model.get("episodes"))),this.emit("showPlayer",b)},c.prototype.initFooter=function(){this.footer.hideAll(),this.footer.showButton("exit","Назад")},b.exports=c},{"../config":39,"collections/films":"MRwP1A","collections/reviews":"RbgBjM","collections/series":"uboD1Q","components/button":"+xiQfc","components/hlist":"GEj0De","components/mclist":"mKkleD","components/vlist":"CJRc+3","lib/cpage":"B6eAZ7","lib/cpanel":"ySbxUr","lib/keys":"iIRFqq","lib/tools":"AjqgZI","modals/modal":"BjgSXc","models/film.info":"7L3aGG"}],"pages/details":[function(a,b){b.exports=a("PcF5dW")},{}],VmX1kv:[function(a,b){"use strict";function c(a){var b=this,c=[],h={activateItem:function(a){b.infoFilm.isActive()&&b.infoFilm.update(a)},showInfo:function(a){b.manager.showInfo(a)},enter:function(a){b.manager.showDetails(a)},request:function(){b._allReady!==!0&&b.startAction()},fetch:function(){b._allReady!==!0&&b.endAction()},activate:function(){b.infoFilm.isVisible()||b.footer.showButton("info")}},l={activate:function(){b.footer.hideButton("info")}},m={activate:function(){this.activeChild instanceof g?b.footer.showButton("info"):b.footer.hideButton("info")}};this.defaults={name:"GenrePage",active:!1,dynamic:!0,visible:!1,owner:null,model:{},events:{allReady:function(){b._allReady=!0},hide:function(){b._allReady=!1}},arrows:{previous:".arrow.vertical.top",next:".arrow.vertical.bottom"}},d.call(this,j.defaults(a,this.defaults)),this.on("show",function(){var a=this.model.get("genre"),b=this.model.get("category"),c="category_id";a?(a=i.genres.get(a),b=i.categories.get(a.get(c)),this.header.setTitle(b.get("title")+"/"+a.get("title"))):b&&this.header.setTitle(i.categories.get(b).get("title"))}),this.addComponent(new e({handle:document.getElementById("genre-new-panel"),active:!0,activated:!0,events:m,components:[this.newButton=new f({handle:document.getElementById("genre-new-link"),template:null,action:function(){b.manager.showSorted(j.defaults(b.newList.collection.params,{sort:"new"}))},events:l}),this.newList=new g({name:"NewList",active:!0,sort:"new",autoLoad:!1,collectionHandle:document.getElementById("genre-new-collection"),handle:document.getElementById("genre-new-list"),events:h})]})),this.newButton.on("deactivate",function(){k.show(b.arrows.previous)}),this.newButton.on("activate",function(){k.hide(b.arrows.previous)}),c.push(this.newList),this.addComponent(new e({handle:document.getElementById("genre-popular-panel"),active:!1,activated:!0,events:m,components:[new f({active:!0,handle:document.getElementById("genre-popular-link"),template:null,action:function(){b.manager.showSorted(j.defaults(b.popList.collection.params,{sort:"pop"}))},events:l}),this.popList=new g({name:"PopularList",autoLoad:!1,collectionHandle:document.getElementById("genre-popular-collection"),handle:document.getElementById("genre-popular-list"),events:h})]})),c.push(this.popList),this.addComponent(new e({handle:document.getElementById("genre-rating-panel"),active:!1,activated:!0,events:m,components:[this.ratingTitle=new f({active:!0,handle:document.getElementById("genre-rating-link"),template:!0,watch:!0,title:"КиноПоиск",action:function(){b.manager.showRatingSort(b.ratingList.collection.params.sort,function(a){b.ratingTitle.setTitle(a.get("title")),b.ratingList.sortBy(a.get("sort"))})},events:l}),this.ratingList=new g({name:"RatingList",sort:"kp",autoLoad:!1,collectionHandle:document.getElementById("genre-rating-collection"),handle:document.getElementById("genre-rating-list"),events:h})]})),c.push(this.ratingList),this.addComponent(new e({handle:document.getElementById("genre-budget-panel"),active:!1,activated:!0,events:m,components:[this.budgetTitle=new f({active:!0,handle:document.getElementById("genre-budget-link"),template:!0,watch:!0,title:"по бюджету",action:function(){b.manager.showBudgetSort(b.budgetList.collection.params.sort,function(a){b.budgetTitle.setTitle(a.get("title")),b.budgetList.sortBy(a.get("sort"))})},events:l}),this.budgetList=new g({name:"BoxOfficeList",sort:"budget",autoLoad:!1,collectionHandle:document.getElementById("genre-budget-collection"),handle:document.getElementById("genre-budget-list"),events:h})]})),this.budgetList.on("deactivate",function(){k.show(b.arrows.next)}),this.budgetList.on("activate",function(){k.hide(b.arrows.next)}),c.push(this.budgetList),this.lists=c,this.on("show",function(){this.lists[0].activate(),this.initFooter()})}var d=a("lib/cpage"),e=a("lib/cpanel"),f=a("components/button"),g=a("components/hflist"),h=a("lib/collection"),i=a("../dictionary"),j=a("lib/tools"),k=a("lib/dom");c.prototype=Object.create(d.prototype),c.prototype.constructor=c,c.prototype.prepare=function(a){var b;this.model.setAll(a);for(var c in this.lists)this.lists.hasOwnProperty(c)&&(b=this.lists[c].collection,j.extend(b.params,j.defaults(a,{category:null,genre:null,from:0,to:27,direction:1})),h.prototype.clear.call(b),b.fetch(),b.isEnd=!1,this.lists[c].activeChild=null)},c.prototype.initFooter=function(){this.footer.hideAll(),this.footer.showButton("exit","Назад"),this.footer.showButton("info","Подробней")},b.exports=c},{"../dictionary":40,"components/button":"+xiQfc","components/hflist":"qh3oth","lib/collection":"Ou0jNv","lib/cpage":"B6eAZ7","lib/cpanel":"ySbxUr","lib/dom":"CBUzS7","lib/tools":"AjqgZI"}],"pages/genre":[function(a,b){b.exports=a("VmX1kv")},{}],"pages/main":[function(a,b){b.exports=a("leTyfk")},{}],leTyfk:[function(a,b){"use strict";function c(a){var b=this,c={activateItem:function(a){b.infoFilm.isActive()&&b.infoFilm.update(a)},showInfo:function(a){b.manager.showInfo(a)},enter:function(a){b.manager.showDetails(a)},request:function(){b._allReady!==!0&&b.startAction()},fetch:function(){b._allReady!==!0&&b.endAction()},activate:function(){b.infoFilm.isVisible()||b.footer.showButton("info")}},l={activate:function(){b.footer.hideButton("info")}},o={activate:function(){this.activeChild instanceof h?b.footer.showButton("info"):b.footer.hideButton("info"),m.show(b.arrows.previous),m.show(b.arrows.next)}};this.defaults={name:"MainPage",active:!0,owner:null,dynamic:!0,events:{show:function(){this.header.setTitle(),this.initFooter(),this.manager.history=[]},allReady:function(){b._allReady=!0,b.dynamic=!1}},arrows:{previous:".arrow.vertical.top",next:".arrow.vertical.bottom"}},d.call(this,n.defaults(a,this.defaults)),this.addComponent(this.promoList=new g({name:"PromoList",active:!0,owner:this,collectionType:i,collectionHandle:document.getElementById("promo-collection"),handle:document.getElementById("promo-list"),events:{activate:function(){b.footer.hideButton("info"),m.hide(b.arrows.previous)},enter:function(a){b.manager.showDetails(a.get("content_id"))}}})),this.addComponent(this.historyPanel=new e({handle:document.getElementById("main-history-panel"),active:!1,visible:!1,activated:!1,events:o,components:[new f({handle:document.getElementById("main-history-link"),template:!1,activated:!0,active:!0,action:function(){b.manager.showUserData({tab:"history"})},events:l}),this.historyList=new h({name:"HistoryList",active:!1,activated:!0,autoLoad:!1,collection:{url:k.get("apiUrl")+"/watchhistory/",data:{session:j.get("session")}},events:c,collectionHandle:document.getElementById("history-collection"),handle:document.getElementById("history-list")})]})),j.on("authorized",function(){var a=b.historyList.collection;a.fullClear(),a.setParameter("session",j.get("session")),a.fetch(),b.historyPanel.activated=!0,a.once("fetch",function(){b.historyPanel.show()})}),j.on("logout",function(){b.historyPanel.isActive()&&b.promoList.activate(),b.historyPanel.hide(),b.historyList.clear(),b.historyPanel.activated=!1}),this.addComponent(new e({handle:document.getElementById("main-new-panel"),active:!1,activated:!0,events:o,components:[new f({handle:document.getElementById("main-new-link"),template:null,active:!0,action:function(){b.manager.showSorted({sort:"new",title:"Новинки"})},events:l}),new h({name:"NewList",sort:"new",collectionHandle:document.getElementById("films-new-collection"),handle:document.getElementById("films-new-list"),events:c})]})),this.addComponent(new e({handle:document.getElementById("main-popular-panel"),active:!1,activated:!0,events:o,components:[new f({active:!0,handle:document.getElementById("main-popular-link"),template:null,action:function(){b.manager.showSorted({sort:"pop",title:"Популярное"})},events:l}),new h({name:"PopularList",collectionHandle:document.getElementById("films-popular-collection"),handle:document.getElementById("films-popular-list"),events:c})]})),this.addComponent(new e({handle:document.getElementById("main-rating-panel"),active:!1,activated:!0,events:o,components:[this.ratingTitle=new f({active:!0,handle:document.getElementById("main-rating-link"),template:!0,watch:!0,title:"КиноПоиск",action:function(){b.manager.showRatingSort(b.ratingList.collection.params.sort,function(a){b.ratingTitle.setTitle(a.get("title")),b.ratingList.sortBy(a.get("sort"))})},events:l}),this.ratingList=new h({name:"RatingList",sort:"kp",collectionHandle:document.getElementById("films-rating-collection"),handle:document.getElementById("films-rating-list"),events:c})]})),this.addComponent(new e({handle:document.getElementById("main-budget-panel"),active:!1,activated:!0,events:o,components:[this.budgetTitle=new f({active:!0,handle:document.getElementById("main-budget-link"),template:!0,watch:!0,title:"по бюджету",action:function(){b.manager.showBudgetSort(b.budgetList.collection.params.sort,function(a){b.budgetTitle.setTitle(a.get("title")),b.budgetList.sortBy(a.get("sort"))})},events:l}),this.budgetList=new h({name:"BoxOfficeList",sort:"budget",collectionHandle:document.getElementById("films-budget-collection"),handle:document.getElementById("films-budget-list"),events:c})]})),this.budgetList.on("activate",function(){m.hide(b.arrows.next)}),this.initFooter()}var d=a("lib/cpage"),e=a("lib/cpanel"),f=a("components/button"),g=a("components/hlist"),h=a("components/hflist"),i=a("collections/promo"),j=a("models/user"),k=a("../config"),l=a("lib/keys"),m=a("lib/dom"),n=a("lib/tools");c.prototype=Object.create(d.prototype),c.prototype.constructor=c,c.prototype.initFooter=function(){this.footer.hideAll(),this.activeChild instanceof e&&this.activeChild.activeChild instanceof h&&this.footer.showButton("info","Подробнее"),this.footer.showButton("exit","Выход")},c.prototype.eventHandler=function(a){switch(a.code){case l.EXIT:return!1}return d.prototype.eventHandler.call(this,a)===!0},c.prototype.updateHistory=function(){this.historyList.reload()},b.exports=c},{"../config":39,"collections/promo":"7uhHY+","components/button":"+xiQfc","components/hflist":"qh3oth","components/hlist":"GEj0De","lib/cpage":"B6eAZ7","lib/cpanel":"ySbxUr","lib/dom":"CBUzS7","lib/keys":"iIRFqq","lib/tools":"AjqgZI","models/user":"QAloAk"}],"pages/player":[function(a,b){b.exports=a("JjW+Ru")},{}],"JjW+Ru":[function(a,b){"use strict";function c(a){var b=this;this.defaults={active:!1,dynamic:!0,visible:!1,panelHideInterval:5e3,posInterval:1e3,moveStep:6e4,changeTimeTimeout:500,reqParameters:{uid:l.get("uid"),site:l.get("site")},model:{data:{totalTime:48e4,currTimeTmp:28e4,watchedTime:0,panel:!0,advertising:!1,mute:!1,volume:!1,volumeLevel:g.getVolume()+"%"},events:{"currTimeTmp:set":function(a){var c,d;c=this.get("totalTime"),c&&a.value>c.getTime()?a.value=c.getTime()-1e3:a.value<0&&(a.value=0),a.value=new Date(a.value),d=Math.floor(a.value.getTime()/c.getTime()*100),this.set("currTimeTmpTxt",m.prepareTime(a.value)),this.set("currProgressTmp",d+"%"),b.inMove===!0&&b.setPosition(a.value.getTime())},"currTime:set":function(a){var c,d;c=this.get("totalTime"),c&&a.value>=c.getTime()?b.end():a.value<0&&(a.value=0),a.value=new Date(a.value),d=Math.floor(a.value.getTime()/c.getTime()*100),this.set("currTimeTxt",m.prepareTime(a.value)),this.set("currProgress",d+"%"),b.inMove!==!0&&this.set("currTimeTmp",a.value.getTime())},"totalTime:set":function(a){a.value=new Date(a.value),this.set("totalTimeTxt",m.prepareTime(a.value))}},view:{handle:a.handle,template:!0,watch:!0}},events:{show:function(){b.header.hide()},deactivate:function(){b.similarList.deactivate()}}},d.call(this,m.defaults(a,this.defaults)),this.addComponent(this.similarList=new h({name:"SimilarList",active:!1,visible:!1,handle:document.getElementById("similar-list"),collectionType:e,collection:{url:l.get("apiUrl")+"/video/related/",data:{count:30},events:{clear:function(){b.similarList.activeChild=null}}},collectionHandle:document.getElementById("similar-collection"),events:{activate:function(){b.showPanel(),this.show()},deactivate:function(){this.hide(),b.hidePanel(b.panelHideInterval)},enter:function(a){b.show(a,!1)},showInfo:function(){this.deactivate(),b.hidePanel()}},show:function(){this.handle.classList.remove("invisible")},hide:function(){this.handle.classList.add("invisible")}})),this.addComponent(this.seriesList=new h({name:"SeriesList",active:!1,visible:!1,handle:document.getElementById("series-list"),collectionType:f,collection:{events:{clear:function(){b.seriesList.activeChild=null}}},skip:function(a){return"divider"===a.get("type")},collectionHandle:document.getElementById("series-collection"),events:{activate:function(){b.showPanel(),this.show()},deactivate:function(){this.hide(),b.hidePanel(b.panelHideInterval)},enter:function(a){b.changeEpisode(a)},showInfo:function(){b.hidePanel(),this.deactivate()}},show:function(){this.handle.classList.remove("invisible")},hide:function(){this.handle.classList.add("invisible")}})),this.on("hide",function(){b.clear()}),g.on("end",function(){b.end()}),g.on("error",function(){b.clear(),b.emit("error","Во время воспроизведения возникла ошибка. Пожалуйста повторите попытку позже."),b.logger({server:"google",type:"Linkerror",videoId:b.loggerData.id+"."+(new Date).getTime(),serverId:b.loggerData.google_analytics_id})}),this.advModal=new i({owner:this,handle:document.getElementById("adv-modal"),list:new k,visible:!1,show:function(a){var c,d=0,e=0;if(this._advs=a,clearInterval(this.advTimer),a&&a.length){for(b.model.set("adv_total",a.length),b.model.set("adv_current",0),b.model.set("advertising",!0),this.currTime=g.getCurrentTime(),c=a.length;c;)e+=a[--c].get("duration")||15;g.once("playStart",function(){clearInterval(b.advModal.timeTimer),b.advModal.timeTimer=setInterval(function(){b.model.set("adv_time",--e),b.logger({server:"digital-logger",type:"advTimer",seconds:++d,advId2:["preroll","midroll","postroll"].indexOf(b.state)}),0>=e&&clearInterval(b.advModal.timeTimer)},1e3)}),this.play()}b.hidePanel(),i.prototype.show.call(this)},hide:function(){this.deactivate(),i.prototype.hide.call(this)},load:function(a,b){this.list.load(a,b)},play:function(){var a=b.model.get("adv_current");this._advs&&this._advs.length&&(b.model.set("adv_current",++a),this.adv=this._advs.pop(),this.list.remove(this.adv),this.adv.got(),g.stop(),b.setState(this.adv.get("type")),b.loggerData.watchedAdvs.push(this.adv.get("id")),b.logger({server:"google",type:this.adv.get("type"),videoId:b.loggerData.id+"."+(new Date).getTime(),serverId:b.loggerData.google_analytics_id}),g.start(this.adv.getFile()))},advInQueue:function(){return this._advs&&this._advs.length},end:function(){this.adv.watched(),this._advs&&this._advs.length?this.play():(b.advModal.setCurrent([]),this.hide(),b.play())},startTimer:function(a){var c=Math.floor(g.totalTime/(a.length+1)),d=function(){"playing"===b.state&&b.advModal.show([a.pop()]),a.length&&(b.advModal.midroleTimer=setTimeout(d,c))};a&&a.length&&(this.midroleTimer=setTimeout(d,c))},setCurrent:function(a){this._advs=a},eventHandler:function(a){return-1===[n.EXIT,n.VOLUME_DOWN,n.VOLUME_UP,n.MUTE,n.FRAME].indexOf(a.code)},clear:function(){this.list.abort(),clearTimeout(this.midroleTimer),clearInterval(this.timeTimer)}}),this.advModal.list.on("loaded",function(){b.start()}),this.advModal.list.on("loadError",function(){b.start()})}var d=a("lib/cpage"),e=a("collections/films"),f=a("collections/series"),g=a("lib/player"),h=a("components/hlist"),i=a("modals/modal"),j=a("models/user"),k=a("collections/adv"),l=a("../config"),m=a("lib/tools"),n=a("lib/keys");c.states=["preparing","playing","paused","watched","preroll","postroll","midroll","pauseroll"],c.prototype=Object.create(d.prototype),c.prototype.constructor=c,c.prototype.play=function(){var a,b,c=this,d=this.model.get("film"),e=Number(this.loggerData.credits_begin_time)||0,f=[5,15,60,e>150?e-60:150,e,g.totalTime/1e3],h=[1,3,5,60,5,60],i=this.state;switch(this.markerIndex=0,this.setState("preparing"),i){case"preparing":case"preroll":g.once("info",function(){c.model.set("totalTime",g.totalTime),c.markerTimer=setTimeout(function a(){var b=c.model.get("currTime").getTime()/1e3;b<g.totalTime/1e3?(b<f[c.markerIndex]?c.logger({server:"digital-logger",type:"contentTimer",contentid:c.model.get("film").get("id")}):c.markerIndex++,c.markerTimer=setTimeout(a,1e3*h[c.markerIndex])):c.logger({server:"digital-logger",type:"contentTimer",contentid:c.model.get("film").get("id")})
},1e3*h[c.markerIndex])}),g.once("playStart",function(){c.startTimer(),c.setState("playing"),c.showPanel(c.panelHideInterval),c.synchronizeTime(),c.trigger("contentStart")}),g.stop(),g.start(d.getFile()),c.logger({server:"google",type:"Start",videoId:c.loggerData.id+"."+(new Date).getTime(),serverId:c.loggerData.google_analytics_id}),c.logger({server:"tns-counter",type:"playstart",serverId:c.loggerData.tns_id}),c.logger({server:"digital-logger",type:"event",type_id:"WATCH_LOAD_START_TYPE_ID",videoId:c.loggerData.id}),c.logger({server:"digital-logger",type:"event",type_id:"WATCH_LOAD_BUFFERING_TYPE_ID",videoId:c.loggerData.id});break;case"paused":a=this.advModal.list.getByType("pauseroll"),b=a[0],b?this.advModal.show([b]):(this.setState("playing"),this.model.set("state","pause"),g.play(),this.hidePanel(this.panelHideInterval));break;case"pauseroll":case"midroll":g.stop(),g.once("playStart",function(){g.pause(),g.setPosition(c.advModal.currTime),c.setState("playing")}),g.start(d.getFile())}},c.prototype.pause=function(){this.setState("paused"),g.pause(),this.showPanel(),this.logger({server:"google",type:"Pause",videoId:this.loggerData.id+"."+(new Date).getTime(),serverId:this.loggerData.google_analytics_id})},c.prototype.setState=function(a){-1!==c.states.indexOf(a)&&(this.state=a)},c.prototype.prepare=function(a){var b,c,d,e=this,f=a.get("id"),h=a.get("episodes");this.startAction("prepare"),g.once("playStart",function(){e.endAction("prepare")}),this.setState("preparing"),this.model.reset(),h?(b=a.get("title")+" ( ",d=a,this.model.set("compilation",d),a=a.get("episode")||a,c=a.get("season"),c&&(b+=c+" сезон "),b+=" "+a.get("title")+" )",this.type="compilation",this.prepareCompilation(h,d.get("seasons_count")),this.seriesList.activated=!0,this.similarList.activated=!1,this.activeList=this.seriesList):(this.type="film",b=a.get("title"),this.similarList.collection.setParameter("id",f),this.similarList.collection.fetch(),this.seriesList.activated=!1,this.similarList.activated=!0,this.activeList=this.similarList),this.model.setAll({title:b,id:f,film:a,watchedTime:0,voluem:!1}),this.seriesList.hide(),this.similarList.hide(),this.advModal.hide(),this.watchId=this.getWatchId(f),a.inLoad=!0,this.advModal.list.inLoad=!0,this.loadFilm(a),this.advModal.load(a.get("id"),this.watchId)},c.prototype.changeEpisode=function(a){var b=this.model.get("compilation");this.startAction(),this.showPanel(),clearTimeout(this.hidePanelTimeout),b.set("episode",a),g.stop(),this.seriesList.deactivate(),this.prepare(b),this.endAction()},c.prototype.getEpisode=function(a){var b=this.seriesList.collection,c=this.model.get("film"),d=b.get(c.get("id")),e=b.indexOf(d);return b.at(e+a)},c.prototype.previousEpisode=function(){var a=this.getEpisode(-1);a&&this.changeEpisode(a)},c.prototype.nextEpisode=function(){var a=this.getEpisode(1);a?this.changeEpisode(a):this.exit()},c.prototype.prepareCompilation=function(a,b){if(b){var c,d=1;for(a.sort(function(a,b){return a.season-b.season||a.episode-b.episode}),a[0].type="first";c=a[d];)c.season!==a[d-1].season&&(c.type="first"),d++}this.seriesList.collection.models(a)},c.prototype.hidePanel=function(a){var b=this;clearTimeout(this.hidePanelTimeout),a&&this.activeList.isActive()||(this.hidePanelTimeout=setTimeout(function(){b.model.set("panel",!1),b.footer.hide()},a||0))},c.prototype.showPanel=function(a){clearTimeout(this.hidePanelTimeout),this.model.set("panel",!0),this.model.set("state",g.isPlaying()?"pause":"play"),this.footer.show(),a&&this.hidePanel(a)},c.prototype.loadFilm=function(a){var b=this;a.once("loaded",function(){b.start(),b.logger({server:"tns-counter",type:"player",serverId:b.loggerData.tns_id})}),a.once("loadError",function(){b.trigger("error","Ошибка связи. Попробуйте позже.")}),a.load(this.watchId)},c.prototype.filmWatched=function(){var a=this.model.get("film");a.watched()},c.prototype.startTimer=function(){var a,b=this;clearInterval(this.positionTimer),this.positionTimer=setInterval(function(){g.isPlaying()&&"playing"===b.state&&(a=b.model.get("currTime").getTime()+b.posInterval,b.model.set("currTime",a),a=b.model.get("watchedTime")+1,b.logTime())},this.posInterval)},c.prototype.getWatchId=function(a){return[a,l.get("uid"),Date.now()].join("_")},c.prototype.setPosition=function(a){var b=this;clearTimeout(this.changeTimeTimer),this.changeTimeTimer=setTimeout(function(){g.once("playStart",function(){"paused"===b.state&&g.pause(),b.synchronizeTime()}),g.setPosition(a)},this.changeTimeTimeout)},c.prototype.synchronizeTime=function(){var a=g.getCurrentTime();this.model.set("currTime",a),this.inMove=!1},c.prototype.end=function(){var a,b=this;switch(this.state){case"preroll":case"midroll":case"pauseroll":this.advModal.end();break;case"playing":a=this.advModal.list.getByType("postroll"),a&&a.length?this.advModal.show(a):"compilation"===this.type?this.nextEpisode(1):(this.logger({server:"google",type:"End",videoId:this.loggerData.id+"."+(new Date).getTime(),serverId:this.loggerData.google_analytics_id}),this.logger({server:"tns-counter",type:"playend",serverId:this.loggerData.tns_id}),this.logger({server:"digitalaccess",type:"content",videoId:this.loggerData.id+"."+(new Date).getTime()}),this.loggerData.watchedAdvs.forEach(function(a){b.logger({server:"digitalaccess",type:"adv",videoId:b.loggerData.id+"."+(new Date).getTime(),advId:b.loggerData.files[b.loggerData.qualityId].id,advId2:a})}),this.exit());break;case"preparing":this.play();break;case"postroll":this.advModal.advInQueue()?this.advModal.end():(this.filmWatched(),"compilation"===this.type?this.nextEpisode(1):this.exit())}},c.prototype.start=function(){var a,b,c,d=this,e=this.advModal.list,f=this.model.get("film");this.setState("preparing"),this.model.set("state","pause"),!f||f.inLoad||e.inLoad||(this.stop(),a=f.getFile(),a?(this.model.set("currTime",0),this.model.set("currTimeTmp",0),b=e.getByType("preroll"),Array.isArray(b)&&b.length?this.advModal.show(b):this.play(),c=this.advModal.list.getByType("midroll"),Array.isArray(c)&&c.length&&this.once("contentStart",function(){d.advModal.startTimer(c)})):this.trigger("error","Запрашиваемый контент не найден."))},c.prototype.stop=function(){clearInterval(this.positionTimer),g.stop()},c.prototype.moveLeft=function(a){var b=this,c=this.model.get("currTimeTmp").getTime()-this.moveStep*(a||1);clearTimeout(this.changeTimeTimer),clearTimeout(this.logRewindTimer),this.logRewindTimer=setTimeout(function(){b.markerIndex=0,b.logger({server:"digital-logger",type:"event",type_id:"WATCH_LOAD_REWIND_TYPE_ID",videoId:b.loggerData.id}),b.logger({server:"digital-logger",type:"event",type_id:"WATCH_LOAD_BUFFERING_TYPE_ID",videoId:b.loggerData.id})},2*this.changeTimeTimeout),this.showPanel(this.panelHideInterval),this.showTimeNotification(),this.inMove=!0,this.model.set("currTimeTmp",c)},c.prototype.moveRight=function(a){var b=this,c=this.model.get("currTimeTmp").getTime()+this.moveStep*(a||1);clearTimeout(this.changeTimeTimer),clearTimeout(this.logRewindTimer),this.logRewindTimer=setTimeout(function(){b.markerIndex=0,b.logger({server:"digital-logger",type:"event",type_id:"WATCH_LOAD_REWIND_TYPE_ID",videoId:b.loggerData.id}),b.logger({server:"digital-logger",type:"event",type_id:"WATCH_LOAD_BUFFERING_TYPE_ID",videoId:b.loggerData.id})},2*this.changeTimeTimeout),this.showPanel(this.panelHideInterval),this.showTimeNotification(),this.inMove=!0,this.model.set("currTimeTmp",c)},c.prototype.showTimeNotification=function(){var a=this;this.model.set("notifyShow",!0),clearTimeout(this.hideTimeNotification),this.hideTimeNotification=setTimeout(function(){a.model.set("notifyShow",!1)},1e3)},c.prototype.logTime=function(){var a,b=[],c=this.model.get("film"),d=this.model.get("watchedTime")+1,e={contentid:c.get("id"),watchid:encodeURIComponent(this.watchId),iviuid:j.get("id"),site:"s"+l.get("site"),uid:encodeURIComponent(l.get("uid")),fromstart:Math.floor(this.model.get("currTime").getTime()/1e3),seconds:d},f=Math.floor(g.totalTime/4/1e3);for(a in e)e.hasOwnProperty(a)&&b.push(a+"="+e[a]);(e.fromstart===f||e.fromstart===2*f||e.fromstart===3*f)&&self.logger({server:"google",type:String(25*e.fromstart/f),videoId:self.loggerData.id+"."+(new Date).getTime(),serverId:self.loggerData.google_analytics_id}),this.model.set("watchedTime",d)},c.prototype.mute=function(a){a&&this.model.set("volumeLevel","0%"),this.model.set("mute",g.mute(a))},c.prototype.changeVolume=function(a){var b=this;this.model.set("volume",!0),this.model.set("volumeLevel",g.changeVolume(a)+"%"),this.mute(!1),clearInterval(this.hideVolumeTimeout),this.hideVolumeTimeout=setTimeout(function(){b.model.set("volume",!1)},2e3)},c.prototype.clear=function(){var a=this.model.get("film");clearInterval(this.positionTimer),clearTimeout(this.changeTimeTimer),clearTimeout(this.hidePanelTimeout),this.header.show(),this.footer.show(),this.advModal.clear(),a&&!a.isWatched&&a.abort(),this.similarList.collection.abort(),this._startedActions=0,g.stop()},c.prototype.exit=function(){this.filmWatched(),this.trigger("updateHistory"),this.manager.back()},c.prototype.eventHandler=function(a){if(a.code!==n.EXIT&&d.prototype.eventHandler.call(this,a)===!0)return!0;if(a.code===n.INFO)return this.model.get("panel")?this.hidePanel():this.showPanel(this.panelHideInterval),!0;switch(a.code){case n.UP:this.activeList.activate();break;case n.DOWN:this.activeList.deactivate();break;case n.LEFT:this.moveLeft();break;case n.RIGHT:this.moveRight();break;case n.FORWARD:this.moveRight(5);break;case n.REWIND:this.moveLeft(5);break;case n.PAGE_UP:return"compilation"===this.type&&this.previousEpisode(),!0;case n.PAGE_DOWN:return"compilation"===this.type&&this.nextEpisode(),!0;case n.FRAME:return g.changeAspect(),!0;case n.MUTE:return this.mute(),!0;case n.VOLUME_UP:return this.changeVolume(5),!0;case n.VOLUME_DOWN:return this.changeVolume(-5),!0;case n.OK:case n.PLAY_PAUSE:g.isPlaying()?this.pause():(this.showPanel(this.panelHideInterval),this.play());break;case n.EXIT:return this.activeList.isActive()?(this.activeList.deactivate(),!0):(this.exit(),!0)}return!0},c.prototype.logger=function(a){var b,c={};switch(a.server){case"tns-counter":if(!a.serverId||"NaN"===a.serverId)return;c.url="http://www.tns-counter.ru/V13a****ivi_ru/ru/CP1251/tmsec="+a.serverId+"_"+a.type+"/",c.method="GET";break;case"google":var d,e=(new Date).getTime();a.type=a.type.charAt(0).toUpperCase()+a.type.substr(1),d="http://www.google-analytics.com/__utm.gif?utmwv=4.3as&utmn="+e+"&utmhn=localhost&utmt=event&utme=5(Video*"+a.type+")",d+="&utmcs=UTF-8&utmcs=UTF-8&utmsr="+screen.width+screen.height+"&utmsc=24-bit&utmul=ru&utmje=&utmfl=&utmdt=&utmhid=",d+=e+"&utmr=-&utmp=&utmac="+a.serverId+"&utmcc=__utma%3D"+a.videoId+"_"+e+"."+e+".29%3B%2B__utmz%3D",d+=a.videoId+"_"+e+"."+e+".1.1.utmcsr%3D(direct)%7Cutmccn%3D(direct)%7Cutmcmd%3D(none)%3B",c.url=d,c.method="GET";break;case"digitalaccess":c.data={method:"da.content.watched",params:[a.videoId,{contentid:a.videoId,watchid:a.videoId+""+(new Date).getTime(),site:"s"+l.get("site")}]},"adv"===a.type&&(c.data.method="da.adv.watched",b=c.data.params.shift(),c.data.params.unshift(b,a.advId),c.data.params[2].advwatchid=a.advId2+"."+(new Date).getTime(),c.data.params[2].watchid=a.videoId,c.data.params[2].advid=a.advId),c.url=l.get("contentApiUrl");break;case"digital-logger":"event"===a.type&&(c.data={seconds:this.model.get("watchedTime"),watchid:encodeURIComponent(this.watchId)+""+(new Date).getTime(),site:"s"+l.get("site"),app_version:l.get("app_version"),uid:encodeURIComponent(l.get("uid")),type_id:a.type_id,duration:1,content_format:"mp4-"+l.get("videoQuality"),fromstart:Math.floor(this.model.get("currTime").getTime()/1e3),contentid:a.videoId,device:l.get("deviceModel")},c.url=l.get("logApiUrl")+"content/load/"),"advTimer"===a.type&&(c.data="seconds="+a.seconds+"&watchid="+encodeURIComponent(this.watchId+""+(new Date).getTime()),c.data+="&site=s"+l.get("site")+"&app_version="+l.get("app_version")+"&uid="+encodeURIComponent(l.get("uid")),c.data+="&advwatchid="+this.loggerData.midroll[-1===a.advId2?0:a.advId2]+"."+(new Date).getTime(),c.url=l.get("logApiUrl")+"adv/time/",c.contentType="application/x-www-form-urlencoded"),"contentTimer"===a.type&&(c.data="seconds="+this.model.get("watchedTime")+"&watchid="+encodeURIComponent(this.watchId+""+(new Date).getTime()),c.data+="&site=s"+l.get("site")+"&app_version="+l.get("app_version"),c.data+="&uid="+encodeURIComponent(l.get("uid"))+"&contentid="+a.contentid,c.data+="&fromstart="+Math.floor(this.model.get("currTime").getTime()/1e3)+"&iviuid="+j.get("id"),c.url=l.get("logApiUrl")+"content/time/",c.contentType="application/x-www-form-urlencoded")}m.ajax({url:c.url,method:c.method||"POST",data:c.data,headers:{"Content-type":c.contentType||"application/json",charset:"utf-8"}})},b.exports=c},{"../config":39,"collections/adv":"4eSXXB","collections/films":"MRwP1A","collections/series":"uboD1Q","components/hlist":"GEj0De","lib/cpage":"B6eAZ7","lib/keys":"iIRFqq","lib/player":"LZDS0b","lib/tools":"AjqgZI","modals/modal":"BjgSXc","models/user":"QAloAk"}],B3R0cH:[function(a,b){"use strict";function c(a){var b=this,c={enter:function(a){b.manager.showDetails(a)},request:function(){b.startAction()},fetch:function(){b.endAction()}};this.defaults={name:"ProfilePage",active:!1,visible:!1,dynamic:!0,model:{view:{handle:a.handle,template:!0,watch:!0}}},e.call(this,j.defaults(a,this.defaults)),this.addComponent(this.tabsList=new g({name:"Profile tabs",active:!1,activated:!0,arrows:null,hItems:4,collection:{idName:"panel",data:[{title:"Очередь на просмотр",type:"focus-tab",panel:"queue"},{title:"История просмотров",type:"focus-tab",panel:"history"},{title:"Настройки",type:"focus-tab",panel:"settings"},{title:"Выход",type:"btn_tab",panel:"exit",action:function(){h.logout()}}]},events:{activateItem:function(a){var b=this.panels[a.get("panel")];b.show(),b.activate()},deactivateItem:function(a){var b=this.panels[a.get("panel")];b.hide()},enter:function(a){this.activateItem(a),a.get("action")&&a.get("action")()}},handle:document.getElementById("profile-tabs-list")})),this.addComponent(this.contentPanel=new f({name:"Content panel",visible:!0,owner:this,navigation:"horizontal",active:!1,activated:!0,handle:document.getElementById("profile-content")})),this.contentPanel.addComponent(this.queuePanel=new f({name:"Watch tab",activated:!0,visible:!0,handle:document.getElementById("profile-queue-panel"),components:[this.queueList=new d({name:"QueueList",active:!0,activated:!0,autoLoad:!1,collection:{url:i.get("apiUrl")+"/user/favourites/"},events:c,collectionHandle:document.getElementById("profile-queue-collection"),handle:document.getElementById("profile-queue-list")})],events:{activate:function(){b.queueList.trigger("activate")}}})),this.contentPanel.addComponent(this.historyPanel=new f({name:"Watch tab",activated:!0,visible:!1,handle:document.getElementById("profile-history-panel"),components:[this.historyList=new d({name:"HistoryList",active:!0,activated:!0,autoLoad:!1,collection:{url:i.get("apiUrl")+"/watchhistory/"},events:c,collectionHandle:document.getElementById("profile-history-collection"),handle:document.getElementById("profile-history-list")})],events:{activate:function(){b.historyList.trigger("activate")}}})),this.contentPanel.addComponent(this.settingsPanel=new f({name:"Settings tab",activated:!0,visible:!1,handle:document.getElementById("profile-settings-panel"),components:[this.qualityList=new g({name:"QualitySelector",active:!0,activated:!0,autoLoad:!1,arrows:null,collection:{idName:"quality",data:[{title:"Низкое",quality:"mobile",type:"btn_left"},{title:"Среднее",quality:"low"},{title:"Высокое",quality:"hi",type:"btn_right"}],view:{template:!0,watch:!0}},collectionHandle:document.getElementById("profile-quality-collection"),handle:document.getElementById("profile-quality-list")})]})),b.qualityList.activateItem(b.qualityList.collection.get(i.get("videoQuality"))),this.qualityList.on("activateItem",function(a){i.set("videoQuality",a.get("quality"))}),i.on("load",function(){b.qualityList.activateItem(b.qualityList.collection.get(i.get("videoQuality")))}),this.contentPanel.addComponent(this.exitPanel=new f({name:"Exit tab",activated:!0,visible:!1,handle:document.getElementById("profile-exit-panel")})),this.tabsList.panels={queue:this.queuePanel,history:this.historyPanel,settings:this.settingsPanel,exit:this.exitPanel},this.tabsList.activate(),h.on("logout",function(){b.manager.show(b.manager.main())}),this.on("show",function(){this.videoQuality=i.get("videoQuality")}),this.on("hide",function(){this.videoQuality!==i.get("videoQuality")&&i.save()})}var d=a("components/hflist"),e=a("lib/cpage"),f=a("lib/cpanel"),g=a("components/hlist"),h=a("models/user"),i=a("../config"),j=a("lib/tools");c.prototype=Object.create(e.prototype),c.prototype.constructor=c,c.prototype.prepare=function(a){this.startAction(),a&&a.tab&&this.showTab(a.tab),this.prepareList(this.historyList),this.prepareList(this.queueList),this.endAction()},c.prototype.updateHistory=function(){this.historyList.reload()},c.prototype.showTab=function(a){this.tabsList.activateItem(this.tabsList.collection.get(a))},c.prototype.prepareList=function(a){a.collection.fullClear(),a.collection.setParameter("session",h.get("session")),a.activeChild=null,a.collection.fetch()},b.exports=c},{"../config":39,"components/hflist":"qh3oth","components/hlist":"GEj0De","lib/cpage":"B6eAZ7","lib/cpanel":"ySbxUr","lib/tools":"AjqgZI","models/user":"QAloAk"}],"pages/profile":[function(a,b){b.exports=a("B3R0cH")},{}],sZ0N3q:[function(a,b){"use strict";function c(a){var b=this;this.defaults={name:"SearchPage",active:!1,visible:!1,input:document.getElementById("search-input"),listType:"tile",navigation:"horizontal"},d.call(this,m.defaults(a,this.defaults)),this.input=new g({name:"SearchBox",handle:this.input,activated:!1,events:{change:function(a){clearTimeout(b.changeTimeout),b.changeTimeout=setTimeout(function(){b.search(a)},500)}}}),this.addComponent(this.listPanel=new j({owner:this,handle:document.getElementById("search-list-panel"),active:!1,activated:!1,components:[this.multList=new e({name:"SearchMultiColumnList",arrows:null,active:!1,activated:!0,visible:!1,handle:document.getElementById("search-multicolumn-list"),collectionType:i,collection:{url:l.get("apiUrl")+"/search",params:{query:"",from:0,to:19,subsite:l.get("site")},events:{request:function(){this.setParameter("from",0),this.setParameter("to",19),b.multList.hide()},fetch:function(a){b.verticalList.collection.models(a),a.length>0?b.showList():b.hideList()}},clear:function(){h.prototype.clear.call(this),this.owner.activeChild=null}},collectionHandle:document.getElementById("search-multicolumn-collection"),events:{enter:function(a){b.manager.showDetails(a)}},show:function(){this.handle.classList.remove("invisible"),b.verticalList.hide(),this.activated=!0,this.activate()},hide:function(){this.handle.classList.add("invisible"),this.deactivate(),this.activated=!1},next:function(a,b){return this.activeChild.view.handle.offsetLeft>=this.itemWidth*(this.hItems-1)&&!b?null:e.prototype.next.call(this,a,b)}}),this.verticalList=new f({name:"SearchMultiColumnList",arrows:null,active:!1,activated:!1,visible:!1,handle:document.getElementById("search-vertical-list"),collectionType:i,collection:{url:l.get("apiUrl")+"/search",params:{query:"",subsite:l.get("site")},clear:function(){h.prototype.clear.call(this),this.owner.activeChild=null}},collectionHandle:document.getElementById("search-vertical-collection"),events:{enter:function(a){b.manager.showDetails(a)}},show:function(){this.handle.classList.remove("invisible"),b.multList.hide(),this.activated=!0,this.activate()},hide:function(){this.handle.classList.add("invisible"),this.deactivate(),this.activated=!1}})]})),this.addComponent(this.keyboard=new k({active:!0,input:this.input,handle:document.getElementById("search-keyboard")})),this.on("show",function(){this.header.setTitle("Поиск"),this.keyboard.activate(),this.input.focus(),this.initFooter()}),this.on("hide",function(){this.input.handle.value="",this.verticalList.hide(),this.multList.hide()})}var d=a("lib/cpage"),e=a("components/mclist"),f=a("components/vlist"),g=a("components/input"),h=a("lib/collection"),i=a("collections/films"),j=a("lib/cpanel"),k=a("components/keyboard"),l=a("../config"),m=a("lib/tools"),n=a("lib/keys");c.prototype=Object.create(d.prototype),c.prototype.constructor=c,c.prototype.search=function(a){a?(this.multList.collection.setParameter("query",encodeURIComponent(a)),this.multList.collection.fetch()):this.hideList()},c.prototype.showList=function(){return 0===this.multList.collection.length?(this.hideList(),void this.footer.hideButton("frame")):("tile"===this.listType?(this.multList.show(),this.footer.setTitle("frame","Показать текст")):(this.verticalList.show(),this.footer.setTitle("frame","Показать обложки")),this.listPanel.activated=!0,void this.footer.showButton("frame"))},c.prototype.initFooter=function(){this.footer.hideAll(),this.footer.showButton("exit","Назад")},c.prototype.hideList=function(){this.listPanel.activated=!1,this.multList.hide(),this.verticalList.hide(),this.footer.hideButton("frame")},c.prototype.eventHandler=function(a){if(d.prototype.eventHandler.call(this,a))return!0;switch(a.code){case n.FRAME:return this.listType="tile"===this.listType?"text":"tile",this.showList(),!0}return!1},b.exports=c},{"../config":39,"collections/films":"MRwP1A","components/input":"7zX6co","components/keyboard":"A64hEq","components/mclist":"mKkleD","components/vlist":"CJRc+3","lib/collection":"Ou0jNv","lib/cpage":"B6eAZ7","lib/cpanel":"ySbxUr","lib/keys":"iIRFqq","lib/tools":"AjqgZI"}],"pages/search":[function(a,b){b.exports=a("sZ0N3q")},{}],"pages/sorted":[function(a,b){b.exports=a("K/khU5")},{}],"K/khU5":[function(a,b){"use strict";function c(a){var b=this;this.defaults={name:"SortedPage",active:!1,visible:!1,modelType:e,dynamic:!0,model:{}},d.call(this,h.defaults(a,this.defaults)),this.addComponent(this.multList=new g({name:"SearchMultiColumnList",arrows:null,active:!0,handle:document.getElementById("sorted-multicolumn-list"),collectionType:f,collectionHandle:document.getElementById("sorted-multicolumn-collection"),events:{enter:function(a){b.manager.showDetails(a)},fetch:function(){b.endAction()},activateItem:function(a){b.quickInfo.update(a)}}})),this.on("show",function(){b.quickInfo.activated=!1,b.quickInfo.view.show(),this.header.setTitle(this.model.get("title"))}),this.on("hide",function(){b.quickInfo.hide(),b.quickInfo.activated=!0})}var d=a("lib/cpage"),e=a("models/film.info"),f=a("collections/films"),g=a("components/mcflist"),h=a("lib/tools");c.prototype=Object.create(d.prototype),c.prototype.constructor=c,c.prototype.prepare=function(a){this.startAction(),this.model.setAll(a),this.multList.collection.fullClear(),this.multList.activeChild=null,this.multList.collection.setParameters({indent:12,sort:a.sort}),this.header.setTitle(a.title),this.multList.collection.fetch()},b.exports=c},{"collections/films":"MRwP1A","components/mcflist":"gQ4GYy","lib/cpage":"B6eAZ7","lib/tools":"AjqgZI","models/film.info":"7L3aGG"}]},{},[41]);